import{aU as Bt,s as V,d as nt,aV as Ye,aW as sn,aX as an,aY as ln,aZ as un,a as Ue,a_ as ht,af as Ke,W as pe,a$ as Le,Z as cn,a0 as wt,b0 as Sn,al as Wt,a3 as dn,ac as bn,b1 as Xt,X as Ze,b2 as Rn,ai as Ct,b3 as Pt,b4 as fn,aF as xn,b5 as Qt,B as Rt,b6 as Tn,b7 as Bn,r as dt,aC as wn,an as Pn,b8 as En,ag as On,b9 as An,ba as In,I as Un,bb as Ln,bc as jn,aE as Fe,bd as Nn,aD as Fn,be as Jt,a8 as Mn,bf as Zt,ap as _n,j as zn,bg as Kn,a7 as Hn,l as $n,b as Dn,o as Vn,f as qn}from"./index-BX3CDTav.js";import{N as Gn,D as Wn,a as Xn}from"./Image-C7prWbZ-.js";import{D as Qn}from"./supabaseAction-CtZEhjoC.js";const Jn=Bt("attach",()=>V("svg",{viewBox:"0 0 16 16",version:"1.1",xmlns:"http://www.w3.org/2000/svg"},V("g",{stroke:"none","stroke-width":"1",fill:"none","fill-rule":"evenodd"},V("g",{fill:"currentColor","fill-rule":"nonzero"},V("path",{d:"M3.25735931,8.70710678 L7.85355339,4.1109127 C8.82986412,3.13460197 10.4127766,3.13460197 11.3890873,4.1109127 C12.365398,5.08722343 12.365398,6.67013588 11.3890873,7.64644661 L6.08578644,12.9497475 C5.69526215,13.3402718 5.06209717,13.3402718 4.67157288,12.9497475 C4.28104858,12.5592232 4.28104858,11.9260582 4.67157288,11.5355339 L9.97487373,6.23223305 C10.1701359,6.0369709 10.1701359,5.72038841 9.97487373,5.52512627 C9.77961159,5.32986412 9.4630291,5.32986412 9.26776695,5.52512627 L3.96446609,10.8284271 C3.18341751,11.6094757 3.18341751,12.8758057 3.96446609,13.6568542 C4.74551468,14.4379028 6.01184464,14.4379028 6.79289322,13.6568542 L12.0961941,8.35355339 C13.4630291,6.98671837 13.4630291,4.77064094 12.0961941,3.40380592 C10.7293591,2.0369709 8.51328163,2.0369709 7.14644661,3.40380592 L2.55025253,8 C2.35499039,8.19526215 2.35499039,8.51184464 2.55025253,8.70710678 C2.74551468,8.90236893 3.06209717,8.90236893 3.25735931,8.70710678 Z"}))))),Zn=Bt("cancel",()=>V("svg",{viewBox:"0 0 16 16",version:"1.1",xmlns:"http://www.w3.org/2000/svg"},V("g",{stroke:"none","stroke-width":"1",fill:"none","fill-rule":"evenodd"},V("g",{fill:"currentColor","fill-rule":"nonzero"},V("path",{d:"M2.58859116,2.7156945 L2.64644661,2.64644661 C2.82001296,2.47288026 3.08943736,2.45359511 3.2843055,2.58859116 L3.35355339,2.64644661 L8,7.293 L12.6464466,2.64644661 C12.8417088,2.45118446 13.1582912,2.45118446 13.3535534,2.64644661 C13.5488155,2.84170876 13.5488155,3.15829124 13.3535534,3.35355339 L8.707,8 L13.3535534,12.6464466 C13.5271197,12.820013 13.5464049,13.0894374 13.4114088,13.2843055 L13.3535534,13.3535534 C13.179987,13.5271197 12.9105626,13.5464049 12.7156945,13.4114088 L12.6464466,13.3535534 L8,8.707 L3.35355339,13.3535534 C3.15829124,13.5488155 2.84170876,13.5488155 2.64644661,13.3535534 C2.45118446,13.1582912 2.45118446,12.8417088 2.64644661,12.6464466 L7.293,8 L2.64644661,3.35355339 C2.47288026,3.17998704 2.45359511,2.91056264 2.58859116,2.7156945 L2.64644661,2.64644661 L2.58859116,2.7156945 Z"}))))),Yn=Bt("retry",()=>V("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},V("path",{d:"M320,146s24.36-12-64-12A160,160,0,1,0,416,294",style:"fill: none; stroke: currentcolor; stroke-linecap: round; stroke-miterlimit: 10; stroke-width: 32px;"}),V("polyline",{points:"256 58 336 138 256 218",style:"fill: none; stroke: currentcolor; stroke-linecap: round; stroke-linejoin: round; stroke-width: 32px;"}))),er=Bt("trash",()=>V("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},V("path",{d:"M432,144,403.33,419.74A32,32,0,0,1,371.55,448H140.46a32,32,0,0,1-31.78-28.26L80,144",style:"fill: none; stroke: currentcolor; stroke-linecap: round; stroke-linejoin: round; stroke-width: 32px;"}),V("rect",{x:"32",y:"64",width:"448",height:"80",rx:"16",ry:"16",style:"fill: none; stroke: currentcolor; stroke-linecap: round; stroke-linejoin: round; stroke-width: 32px;"}),V("line",{x1:"312",y1:"240",x2:"200",y2:"352",style:"fill: none; stroke: currentcolor; stroke-linecap: round; stroke-linejoin: round; stroke-width: 32px;"}),V("line",{x1:"312",y1:"352",x2:"200",y2:"240",style:"fill: none; stroke: currentcolor; stroke-linecap: round; stroke-linejoin: round; stroke-width: 32px;"}))),tr={success:V(un,null),error:V(ln,null),warning:V(an,null),info:V(sn,null)},nr=nt({name:"ProgressCircle",props:{clsPrefix:{type:String,required:!0},status:{type:String,required:!0},strokeWidth:{type:Number,required:!0},fillColor:[String,Object],railColor:String,railStyle:[String,Object],percentage:{type:Number,default:0},offsetDegree:{type:Number,default:0},showIndicator:{type:Boolean,required:!0},indicatorTextColor:String,unit:String,viewBoxWidth:{type:Number,required:!0},gapDegree:{type:Number,required:!0},gapOffsetDegree:{type:Number,default:0}},setup(B,{slots:G}){function U(k,R,m,A){const{gapDegree:w,viewBoxWidth:O,strokeWidth:r}=B,h=50,f=0,S=h,d=0,p=2*h,T=50+r/2,E=`M ${T},${T} m ${f},${S}
      a ${h},${h} 0 1 1 ${d},-100
      a ${h},${h} 0 1 1 0,${p}`,L=Math.PI*2*h,N={stroke:A==="rail"?m:typeof B.fillColor=="object"?"url(#gradient)":m,strokeDasharray:`${k/100*(L-w)}px ${O*8}px`,strokeDashoffset:`-${w/2}px`,transformOrigin:R?"center":void 0,transform:R?`rotate(${R}deg)`:void 0};return{pathString:E,pathStyle:N}}const K=()=>{const k=typeof B.fillColor=="object",R=k?B.fillColor.stops[0]:"",m=k?B.fillColor.stops[1]:"";return k&&V("defs",null,V("linearGradient",{id:"gradient",x1:"0%",y1:"100%",x2:"100%",y2:"0%"},V("stop",{offset:"0%","stop-color":R}),V("stop",{offset:"100%","stop-color":m})))};return()=>{const{fillColor:k,railColor:R,strokeWidth:m,offsetDegree:A,status:w,percentage:O,showIndicator:r,indicatorTextColor:h,unit:f,gapOffsetDegree:S,clsPrefix:d}=B,{pathString:p,pathStyle:T}=U(100,0,R,"rail"),{pathString:E,pathStyle:L}=U(O,A,k,"fill"),N=100+m;return V("div",{class:`${d}-progress-content`,role:"none"},V("div",{class:`${d}-progress-graph`,"aria-hidden":!0},V("div",{class:`${d}-progress-graph-circle`,style:{transform:S?`rotate(${S}deg)`:void 0}},V("svg",{viewBox:`0 0 ${N} ${N}`},K(),V("g",null,V("path",{class:`${d}-progress-graph-circle-rail`,d:p,"stroke-width":m,"stroke-linecap":"round",fill:"none",style:T})),V("g",null,V("path",{class:[`${d}-progress-graph-circle-fill`,O===0&&`${d}-progress-graph-circle-fill--empty`],d:E,"stroke-width":m,"stroke-linecap":"round",fill:"none",style:L}))))),r?V("div",null,G.default?V("div",{class:`${d}-progress-custom-content`,role:"none"},G.default()):w!=="default"?V("div",{class:`${d}-progress-icon`,"aria-hidden":!0},V(Ye,{clsPrefix:d},{default:()=>tr[w]})):V("div",{class:`${d}-progress-text`,style:{color:h},role:"none"},V("span",{class:`${d}-progress-text__percentage`},O),V("span",{class:`${d}-progress-text__unit`},f))):null)}}}),rr={success:V(un,null),error:V(ln,null),warning:V(an,null),info:V(sn,null)},or=nt({name:"ProgressLine",props:{clsPrefix:{type:String,required:!0},percentage:{type:Number,default:0},railColor:String,railStyle:[String,Object],fillColor:[String,Object],status:{type:String,required:!0},indicatorPlacement:{type:String,required:!0},indicatorTextColor:String,unit:{type:String,default:"%"},processing:{type:Boolean,required:!0},showIndicator:{type:Boolean,required:!0},height:[String,Number],railBorderRadius:[String,Number],fillBorderRadius:[String,Number]},setup(B,{slots:G}){const U=Ue(()=>ht(B.height)),K=Ue(()=>{var m,A;return typeof B.fillColor=="object"?`linear-gradient(to right, ${(m=B.fillColor)===null||m===void 0?void 0:m.stops[0]} , ${(A=B.fillColor)===null||A===void 0?void 0:A.stops[1]})`:B.fillColor}),k=Ue(()=>B.railBorderRadius!==void 0?ht(B.railBorderRadius):B.height!==void 0?ht(B.height,{c:.5}):""),R=Ue(()=>B.fillBorderRadius!==void 0?ht(B.fillBorderRadius):B.railBorderRadius!==void 0?ht(B.railBorderRadius):B.height!==void 0?ht(B.height,{c:.5}):"");return()=>{const{indicatorPlacement:m,railColor:A,railStyle:w,percentage:O,unit:r,indicatorTextColor:h,status:f,showIndicator:S,processing:d,clsPrefix:p}=B;return V("div",{class:`${p}-progress-content`,role:"none"},V("div",{class:`${p}-progress-graph`,"aria-hidden":!0},V("div",{class:[`${p}-progress-graph-line`,{[`${p}-progress-graph-line--indicator-${m}`]:!0}]},V("div",{class:`${p}-progress-graph-line-rail`,style:[{backgroundColor:A,height:U.value,borderRadius:k.value},w]},V("div",{class:[`${p}-progress-graph-line-fill`,d&&`${p}-progress-graph-line-fill--processing`],style:{maxWidth:`${B.percentage}%`,background:K.value,height:U.value,lineHeight:U.value,borderRadius:R.value}},m==="inside"?V("div",{class:`${p}-progress-graph-line-indicator`,style:{color:h}},G.default?G.default():`${O}${r}`):null)))),S&&m==="outside"?V("div",null,G.default?V("div",{class:`${p}-progress-custom-content`,style:{color:h},role:"none"},G.default()):f==="default"?V("div",{role:"none",class:`${p}-progress-icon ${p}-progress-icon--as-text`,style:{color:h}},O,r):V("div",{class:`${p}-progress-icon`,"aria-hidden":!0},V(Ye,{clsPrefix:p},{default:()=>rr[f]}))):null)}}});function Yt(B,G,U=100){return`m ${U/2} ${U/2-B} a ${B} ${B} 0 1 1 0 ${2*B} a ${B} ${B} 0 1 1 0 -${2*B}`}const ir=nt({name:"ProgressMultipleCircle",props:{clsPrefix:{type:String,required:!0},viewBoxWidth:{type:Number,required:!0},percentage:{type:Array,default:[0]},strokeWidth:{type:Number,required:!0},circleGap:{type:Number,required:!0},showIndicator:{type:Boolean,required:!0},fillColor:{type:Array,default:()=>[]},railColor:{type:Array,default:()=>[]},railStyle:{type:Array,default:()=>[]}},setup(B,{slots:G}){const U=Ue(()=>B.percentage.map((R,m)=>`${Math.PI*R/100*(B.viewBoxWidth/2-B.strokeWidth/2*(1+2*m)-B.circleGap*m)*2}, ${B.viewBoxWidth*8}`)),K=(k,R)=>{const m=B.fillColor[R],A=typeof m=="object"?m.stops[0]:"",w=typeof m=="object"?m.stops[1]:"";return typeof B.fillColor[R]=="object"&&V("linearGradient",{id:`gradient-${R}`,x1:"100%",y1:"0%",x2:"0%",y2:"100%"},V("stop",{offset:"0%","stop-color":A}),V("stop",{offset:"100%","stop-color":w}))};return()=>{const{viewBoxWidth:k,strokeWidth:R,circleGap:m,showIndicator:A,fillColor:w,railColor:O,railStyle:r,percentage:h,clsPrefix:f}=B;return V("div",{class:`${f}-progress-content`,role:"none"},V("div",{class:`${f}-progress-graph`,"aria-hidden":!0},V("div",{class:`${f}-progress-graph-circle`},V("svg",{viewBox:`0 0 ${k} ${k}`},V("defs",null,h.map((S,d)=>K(S,d))),h.map((S,d)=>V("g",{key:d},V("path",{class:`${f}-progress-graph-circle-rail`,d:Yt(k/2-R/2*(1+2*d)-m*d,R,k),"stroke-width":R,"stroke-linecap":"round",fill:"none",style:[{strokeDashoffset:0,stroke:O[d]},r[d]]}),V("path",{class:[`${f}-progress-graph-circle-fill`,S===0&&`${f}-progress-graph-circle-fill--empty`],d:Yt(k/2-R/2*(1+2*d)-m*d,R,k),"stroke-width":R,"stroke-linecap":"round",fill:"none",style:{strokeDasharray:U.value[d],strokeDashoffset:0,stroke:typeof w[d]=="object"?`url(#gradient-${d})`:w[d]}})))))),A&&G.default?V("div",null,V("div",{class:`${f}-progress-text`},G.default())):null)}}}),sr=Ke([pe("progress",{display:"inline-block"},[pe("progress-icon",`
 color: var(--n-icon-color);
 transition: color .3s var(--n-bezier);
 `),Le("line",`
 width: 100%;
 display: block;
 `,[pe("progress-content",`
 display: flex;
 align-items: center;
 `,[pe("progress-graph",{flex:1})]),pe("progress-custom-content",{marginLeft:"14px"}),pe("progress-icon",`
 width: 30px;
 padding-left: 14px;
 height: var(--n-icon-size-line);
 line-height: var(--n-icon-size-line);
 font-size: var(--n-icon-size-line);
 `,[Le("as-text",`
 color: var(--n-text-color-line-outer);
 text-align: center;
 width: 40px;
 font-size: var(--n-font-size);
 padding-left: 4px;
 transition: color .3s var(--n-bezier);
 `)])]),Le("circle, dashboard",{width:"120px"},[pe("progress-custom-content",`
 position: absolute;
 left: 50%;
 top: 50%;
 transform: translateX(-50%) translateY(-50%);
 display: flex;
 align-items: center;
 justify-content: center;
 `),pe("progress-text",`
 position: absolute;
 left: 50%;
 top: 50%;
 transform: translateX(-50%) translateY(-50%);
 display: flex;
 align-items: center;
 color: inherit;
 font-size: var(--n-font-size-circle);
 color: var(--n-text-color-circle);
 font-weight: var(--n-font-weight-circle);
 transition: color .3s var(--n-bezier);
 white-space: nowrap;
 `),pe("progress-icon",`
 position: absolute;
 left: 50%;
 top: 50%;
 transform: translateX(-50%) translateY(-50%);
 display: flex;
 align-items: center;
 color: var(--n-icon-color);
 font-size: var(--n-icon-size-circle);
 `)]),Le("multiple-circle",`
 width: 200px;
 color: inherit;
 `,[pe("progress-text",`
 font-weight: var(--n-font-weight-circle);
 color: var(--n-text-color-circle);
 position: absolute;
 left: 50%;
 top: 50%;
 transform: translateX(-50%) translateY(-50%);
 display: flex;
 align-items: center;
 justify-content: center;
 transition: color .3s var(--n-bezier);
 `)]),pe("progress-content",{position:"relative"}),pe("progress-graph",{position:"relative"},[pe("progress-graph-circle",[Ke("svg",{verticalAlign:"bottom"}),pe("progress-graph-circle-fill",`
 stroke: var(--n-fill-color);
 transition:
 opacity .3s var(--n-bezier),
 stroke .3s var(--n-bezier),
 stroke-dasharray .3s var(--n-bezier);
 `,[Le("empty",{opacity:0})]),pe("progress-graph-circle-rail",`
 transition: stroke .3s var(--n-bezier);
 overflow: hidden;
 stroke: var(--n-rail-color);
 `)]),pe("progress-graph-line",[Le("indicator-inside",[pe("progress-graph-line-rail",`
 height: 16px;
 line-height: 16px;
 border-radius: 10px;
 `,[pe("progress-graph-line-fill",`
 height: inherit;
 border-radius: 10px;
 `),pe("progress-graph-line-indicator",`
 background: #0000;
 white-space: nowrap;
 text-align: right;
 margin-left: 14px;
 margin-right: 14px;
 height: inherit;
 font-size: 12px;
 color: var(--n-text-color-line-inner);
 transition: color .3s var(--n-bezier);
 `)])]),Le("indicator-inside-label",`
 height: 16px;
 display: flex;
 align-items: center;
 `,[pe("progress-graph-line-rail",`
 flex: 1;
 transition: background-color .3s var(--n-bezier);
 `),pe("progress-graph-line-indicator",`
 background: var(--n-fill-color);
 font-size: 12px;
 transform: translateZ(0);
 display: flex;
 vertical-align: middle;
 height: 16px;
 line-height: 16px;
 padding: 0 10px;
 border-radius: 10px;
 position: absolute;
 white-space: nowrap;
 color: var(--n-text-color-line-inner);
 transition:
 right .2s var(--n-bezier),
 color .3s var(--n-bezier),
 background-color .3s var(--n-bezier);
 `)]),pe("progress-graph-line-rail",`
 position: relative;
 overflow: hidden;
 height: var(--n-rail-height);
 border-radius: 5px;
 background-color: var(--n-rail-color);
 transition: background-color .3s var(--n-bezier);
 `,[pe("progress-graph-line-fill",`
 background: var(--n-fill-color);
 position: relative;
 border-radius: 5px;
 height: inherit;
 width: 100%;
 max-width: 0%;
 transition:
 background-color .3s var(--n-bezier),
 max-width .2s var(--n-bezier);
 `,[Le("processing",[Ke("&::after",`
 content: "";
 background-image: var(--n-line-bg-processing);
 animation: progress-processing-animation 2s var(--n-bezier) infinite;
 `)])])])])])]),Ke("@keyframes progress-processing-animation",`
 0% {
 position: absolute;
 left: 0;
 top: 0;
 bottom: 0;
 right: 100%;
 opacity: 1;
 }
 66% {
 position: absolute;
 left: 0;
 top: 0;
 bottom: 0;
 right: 0;
 opacity: 0;
 }
 100% {
 position: absolute;
 left: 0;
 top: 0;
 bottom: 0;
 right: 0;
 opacity: 0;
 }
 `)]),ar=Object.assign(Object.assign({},wt.props),{processing:Boolean,type:{type:String,default:"line"},gapDegree:Number,gapOffsetDegree:Number,status:{type:String,default:"default"},railColor:[String,Array],railStyle:[String,Array],color:[String,Array,Object],viewBoxWidth:{type:Number,default:100},strokeWidth:{type:Number,default:7},percentage:[Number,Array],unit:{type:String,default:"%"},showIndicator:{type:Boolean,default:!0},indicatorPosition:{type:String,default:"outside"},indicatorPlacement:{type:String,default:"outside"},indicatorTextColor:String,circleGap:{type:Number,default:1},height:Number,borderRadius:[String,Number],fillBorderRadius:[String,Number],offsetDegree:Number}),lr=nt({name:"Progress",props:ar,setup(B){const G=Ue(()=>B.indicatorPlacement||B.indicatorPosition),U=Ue(()=>{if(B.gapDegree||B.gapDegree===0)return B.gapDegree;if(B.type==="dashboard")return 75}),{mergedClsPrefixRef:K,inlineThemeDisabled:k}=cn(B),R=wt("Progress","-progress",sr,Sn,B,K),m=Ue(()=>{const{status:w}=B,{common:{cubicBezierEaseInOut:O},self:{fontSize:r,fontSizeCircle:h,railColor:f,railHeight:S,iconSizeCircle:d,iconSizeLine:p,textColorCircle:T,textColorLineInner:E,textColorLineOuter:L,lineBgProcessing:N,fontWeightCircle:D,[Wt("iconColor",w)]:j,[Wt("fillColor",w)]:c}}=R.value;return{"--n-bezier":O,"--n-fill-color":c,"--n-font-size":r,"--n-font-size-circle":h,"--n-font-weight-circle":D,"--n-icon-color":j,"--n-icon-size-circle":d,"--n-icon-size-line":p,"--n-line-bg-processing":N,"--n-rail-color":f,"--n-rail-height":S,"--n-text-color-circle":T,"--n-text-color-line-inner":E,"--n-text-color-line-outer":L}}),A=k?dn("progress",Ue(()=>B.status[0]),m,B):void 0;return{mergedClsPrefix:K,mergedIndicatorPlacement:G,gapDeg:U,cssVars:k?void 0:m,themeClass:A==null?void 0:A.themeClass,onRender:A==null?void 0:A.onRender}},render(){const{type:B,cssVars:G,indicatorTextColor:U,showIndicator:K,status:k,railColor:R,railStyle:m,color:A,percentage:w,viewBoxWidth:O,strokeWidth:r,mergedIndicatorPlacement:h,unit:f,borderRadius:S,fillBorderRadius:d,height:p,processing:T,circleGap:E,mergedClsPrefix:L,gapDeg:N,gapOffsetDegree:D,themeClass:j,$slots:c,onRender:a}=this;return a==null||a(),V("div",{class:[j,`${L}-progress`,`${L}-progress--${B}`,`${L}-progress--${k}`],style:G,"aria-valuemax":100,"aria-valuemin":0,"aria-valuenow":w,role:B==="circle"||B==="line"||B==="dashboard"?"progressbar":"none"},B==="circle"||B==="dashboard"?V(nr,{clsPrefix:L,status:k,showIndicator:K,indicatorTextColor:U,railColor:R,fillColor:A,railStyle:m,offsetDegree:this.offsetDegree,percentage:w,viewBoxWidth:O,strokeWidth:r,gapDegree:N===void 0?B==="dashboard"?75:0:N,gapOffsetDegree:D,unit:f},c):B==="line"?V(or,{clsPrefix:L,status:k,showIndicator:K,indicatorTextColor:U,railColor:R,fillColor:A,railStyle:m,percentage:w,processing:T,indicatorPlacement:h,unit:f,fillBorderRadius:d,railBorderRadius:S,height:p},c):B==="multiple-circle"?V(ir,{clsPrefix:L,strokeWidth:r,railColor:R,fillColor:A,railStyle:m,viewBoxWidth:O,percentage:w,showIndicator:K,circleGap:E},c):null)}}),pt=bn("n-upload"),ur=Ke([pe("upload","width: 100%;",[Le("dragger-inside",[pe("upload-trigger",`
 display: block;
 `)]),Le("drag-over",[pe("upload-dragger",`
 border: var(--n-dragger-border-hover);
 `)])]),pe("upload-dragger",`
 cursor: pointer;
 box-sizing: border-box;
 width: 100%;
 text-align: center;
 border-radius: var(--n-border-radius);
 padding: 24px;
 opacity: 1;
 transition:
 opacity .3s var(--n-bezier),
 border-color .3s var(--n-bezier),
 background-color .3s var(--n-bezier);
 background-color: var(--n-dragger-color);
 border: var(--n-dragger-border);
 `,[Ke("&:hover",`
 border: var(--n-dragger-border-hover);
 `),Le("disabled",`
 cursor: not-allowed;
 `)]),pe("upload-trigger",`
 display: inline-block;
 box-sizing: border-box;
 opacity: 1;
 transition: opacity .3s var(--n-bezier);
 `,[Ke("+",[pe("upload-file-list","margin-top: 8px;")]),Le("disabled",`
 opacity: var(--n-item-disabled-opacity);
 cursor: not-allowed;
 `),Le("image-card",`
 width: 96px;
 height: 96px;
 `,[pe("base-icon",`
 font-size: 24px;
 `),pe("upload-dragger",`
 padding: 0;
 height: 100%;
 width: 100%;
 display: flex;
 align-items: center;
 justify-content: center;
 `)])]),pe("upload-file-list",`
 line-height: var(--n-line-height);
 opacity: 1;
 transition: opacity .3s var(--n-bezier);
 `,[Ke("a, img","outline: none;"),Le("disabled",`
 opacity: var(--n-item-disabled-opacity);
 cursor: not-allowed;
 `,[pe("upload-file","cursor: not-allowed;")]),Le("grid",`
 display: grid;
 grid-template-columns: repeat(auto-fill, 96px);
 grid-gap: 8px;
 margin-top: 0;
 `),pe("upload-file",`
 display: block;
 box-sizing: border-box;
 cursor: default;
 padding: 0px 12px 0 6px;
 transition: background-color .3s var(--n-bezier);
 border-radius: var(--n-border-radius);
 `,[Xt(),pe("progress",[Xt({foldPadding:!0})]),Ke("&:hover",`
 background-color: var(--n-item-color-hover);
 `,[pe("upload-file-info",[Ze("action",`
 opacity: 1;
 `)])]),Le("image-type",`
 border-radius: var(--n-border-radius);
 text-decoration: underline;
 text-decoration-color: #0000;
 `,[pe("upload-file-info",`
 padding-top: 0px;
 padding-bottom: 0px;
 width: 100%;
 height: 100%;
 display: flex;
 justify-content: space-between;
 align-items: center;
 padding: 6px 0;
 `,[pe("progress",`
 padding: 2px 0;
 margin-bottom: 0;
 `),Ze("name",`
 padding: 0 8px;
 `),Ze("thumbnail",`
 width: 32px;
 height: 32px;
 font-size: 28px;
 display: flex;
 justify-content: center;
 align-items: center;
 `,[Ke("img",`
 width: 100%;
 `)])])]),Le("text-type",[pe("progress",`
 box-sizing: border-box;
 padding-bottom: 6px;
 margin-bottom: 6px;
 `)]),Le("image-card-type",`
 position: relative;
 width: 96px;
 height: 96px;
 border: var(--n-item-border-image-card);
 border-radius: var(--n-border-radius);
 padding: 0;
 display: flex;
 align-items: center;
 justify-content: center;
 transition: border-color .3s var(--n-bezier), background-color .3s var(--n-bezier);
 border-radius: var(--n-border-radius);
 overflow: hidden;
 `,[pe("progress",`
 position: absolute;
 left: 8px;
 bottom: 8px;
 right: 8px;
 width: unset;
 `),pe("upload-file-info",`
 padding: 0;
 width: 100%;
 height: 100%;
 `,[Ze("thumbnail",`
 width: 100%;
 height: 100%;
 display: flex;
 flex-direction: column;
 align-items: center;
 justify-content: center;
 font-size: 36px;
 `,[Ke("img",`
 width: 100%;
 `)])]),Ke("&::before",`
 position: absolute;
 z-index: 1;
 left: 0;
 right: 0;
 top: 0;
 bottom: 0;
 border-radius: inherit;
 opacity: 0;
 transition: opacity .2s var(--n-bezier);
 content: "";
 `),Ke("&:hover",[Ke("&::before","opacity: 1;"),pe("upload-file-info",[Ze("thumbnail","opacity: .12;")])])]),Le("error-status",[Ke("&:hover",`
 background-color: var(--n-item-color-hover-error);
 `),pe("upload-file-info",[Ze("name","color: var(--n-item-text-color-error);"),Ze("thumbnail","color: var(--n-item-text-color-error);")]),Le("image-card-type",`
 border: var(--n-item-border-image-card-error);
 `)]),Le("with-url",`
 cursor: pointer;
 `,[pe("upload-file-info",[Ze("name",`
 color: var(--n-item-text-color-success);
 text-decoration-color: var(--n-item-text-color-success);
 `,[Ke("a",`
 text-decoration: underline;
 `)])])]),pe("upload-file-info",`
 position: relative;
 padding-top: 6px;
 padding-bottom: 6px;
 display: flex;
 flex-wrap: nowrap;
 `,[Ze("thumbnail",`
 font-size: 18px;
 opacity: 1;
 transition: opacity .2s var(--n-bezier);
 color: var(--n-item-icon-color);
 `,[pe("base-icon",`
 margin-right: 2px;
 vertical-align: middle;
 transition: color .3s var(--n-bezier);
 `)]),Ze("action",`
 padding-top: inherit;
 padding-bottom: inherit;
 position: absolute;
 right: 0;
 top: 0;
 bottom: 0;
 width: 80px;
 display: flex;
 align-items: center;
 transition: opacity .2s var(--n-bezier);
 justify-content: flex-end;
 opacity: 0;
 `,[pe("button",[Ke("&:not(:last-child)",{marginRight:"4px"}),pe("base-icon",[Ke("svg",[Rn()])])]),Le("image-type",`
 position: relative;
 max-width: 80px;
 width: auto;
 `),Le("image-card-type",`
 z-index: 2;
 position: absolute;
 width: 100%;
 height: 100%;
 left: 0;
 right: 0;
 bottom: 0;
 top: 0;
 display: flex;
 justify-content: center;
 align-items: center;
 `)]),Ze("name",`
 color: var(--n-item-text-color);
 flex: 1;
 display: flex;
 justify-content: center;
 text-overflow: ellipsis;
 overflow: hidden;
 flex-direction: column;
 text-decoration-color: #0000;
 font-size: var(--n-font-size);
 transition:
 color .3s var(--n-bezier),
 text-decoration-color .3s var(--n-bezier); 
 `,[Ke("a",`
 color: inherit;
 text-decoration: underline;
 `)])])])]),pe("upload-file-input",`
 display: none;
 width: 0;
 height: 0;
 opacity: 0;
 `)]),gn="__UPLOAD_DRAGGER__",cr=nt({name:"UploadDragger",[gn]:!0,setup(B,{slots:G}){const U=Ct(pt,null);return U||Pt("upload-dragger","`n-upload-dragger` must be placed inside `n-upload`."),()=>{const{mergedClsPrefixRef:{value:K},mergedDisabledRef:{value:k},maxReachedRef:{value:R}}=U;return V("div",{class:[`${K}-upload-dragger`,(k||R)&&`${K}-upload-dragger--disabled`]},G)}}}),dr=V("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 28 28"},V("g",{fill:"none"},V("path",{d:"M21.75 3A3.25 3.25 0 0 1 25 6.25v15.5A3.25 3.25 0 0 1 21.75 25H6.25A3.25 3.25 0 0 1 3 21.75V6.25A3.25 3.25 0 0 1 6.25 3h15.5zm.583 20.4l-7.807-7.68a.75.75 0 0 0-.968-.07l-.084.07l-7.808 7.68c.183.065.38.1.584.1h15.5c.204 0 .4-.035.583-.1l-7.807-7.68l7.807 7.68zM21.75 4.5H6.25A1.75 1.75 0 0 0 4.5 6.25v15.5c0 .208.036.408.103.593l7.82-7.692a2.25 2.25 0 0 1 3.026-.117l.129.117l7.82 7.692c.066-.185.102-.385.102-.593V6.25a1.75 1.75 0 0 0-1.75-1.75zm-3.25 3a2.5 2.5 0 1 1 0 5a2.5 2.5 0 0 1 0-5zm0 1.5a1 1 0 1 0 0 2a1 1 0 0 0 0-2z",fill:"currentColor"}))),fr=V("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 28 28"},V("g",{fill:"none"},V("path",{d:"M6.4 2A2.4 2.4 0 0 0 4 4.4v19.2A2.4 2.4 0 0 0 6.4 26h15.2a2.4 2.4 0 0 0 2.4-2.4V11.578c0-.729-.29-1.428-.805-1.944l-6.931-6.931A2.4 2.4 0 0 0 14.567 2H6.4zm-.9 2.4a.9.9 0 0 1 .9-.9H14V10a2 2 0 0 0 2 2h6.5v11.6a.9.9 0 0 1-.9.9H6.4a.9.9 0 0 1-.9-.9V4.4zm16.44 6.1H16a.5.5 0 0 1-.5-.5V4.06l6.44 6.44z",fill:"currentColor"}))),gr=nt({name:"UploadProgress",props:{show:Boolean,percentage:{type:Number,required:!0},status:{type:String,required:!0}},setup(){return{mergedTheme:Ct(pt).mergedThemeRef}},render(){return V(fn,null,{default:()=>this.show?V(lr,{type:"line",showIndicator:!1,percentage:this.percentage,status:this.status,height:2,theme:this.mergedTheme.peers.Progress,themeOverrides:this.mergedTheme.peerOverrides.Progress}):null})}});var Ht=function(B,G,U,K){function k(R){return R instanceof U?R:new U(function(m){m(R)})}return new(U||(U=Promise))(function(R,m){function A(r){try{O(K.next(r))}catch(h){m(h)}}function w(r){try{O(K.throw(r))}catch(h){m(h)}}function O(r){r.done?R(r.value):k(r.value).then(A,w)}O((K=K.apply(B,G||[])).next())})};function hn(B){return B.includes("image/")}function en(B=""){const G=B.split("/"),K=G[G.length-1].split(/#|\?/)[0];return(/\.[^./\\]*$/.exec(K)||[""])[0]}const tn=/(webp|svg|png|gif|jpg|jpeg|jfif|bmp|dpg|ico)$/i,pn=B=>{if(B.type)return hn(B.type);const G=en(B.name||"");if(tn.test(G))return!0;const U=B.thumbnailUrl||B.url||"",K=en(U);return!!(/^data:image\//.test(U)||tn.test(K))};function hr(B){return Ht(this,void 0,void 0,function*(){return yield new Promise(G=>{if(!B.type||!hn(B.type)){G("");return}G(window.URL.createObjectURL(B))})})}const pr=xn&&window.FileReader&&window.File;function vr(B){return B.isDirectory}function yr(B){return B.isFile}function Cr(B,G){return Ht(this,void 0,void 0,function*(){const U=[];function K(k){return Ht(this,void 0,void 0,function*(){for(const R of k)if(R){if(G&&vr(R)){const m=R.createReader();let A=[],w;try{do w=yield new Promise((O,r)=>{m.readEntries(O,r)}),A=A.concat(w);while(w.length>0)}catch(O){Qt("upload","error happens when handling directory upload",O)}yield K(A)}else if(yr(R))try{const m=yield new Promise((A,w)=>{R.file(A,w)});U.push({file:m,entry:R,source:"dnd"})}catch(m){Qt("upload","error happens when handling file upload",m)}}})}return yield K(B),U})}function yt(B){const{id:G,name:U,percentage:K,status:k,url:R,file:m,thumbnailUrl:A,type:w,fullPath:O,batchId:r}=B;return{id:G,name:U,percentage:K??null,status:k,url:R??null,file:m??null,thumbnailUrl:A??null,type:w??null,fullPath:O??null,batchId:r??null}}function mr(B,G,U){return B=B.toLowerCase(),G=G.toLocaleLowerCase(),U=U.toLocaleLowerCase(),U.split(",").map(k=>k.trim()).filter(Boolean).some(k=>{if(k.startsWith(".")){if(B.endsWith(k))return!0}else if(k.includes("/")){const[R,m]=G.split("/"),[A,w]=k.split("/");if((A==="*"||R&&A&&A===R)&&(w==="*"||m&&w&&w===m))return!0}else return!0;return!1})}var nn=function(B,G,U,K){function k(R){return R instanceof U?R:new U(function(m){m(R)})}return new(U||(U=Promise))(function(R,m){function A(r){try{O(K.next(r))}catch(h){m(h)}}function w(r){try{O(K.throw(r))}catch(h){m(h)}}function O(r){r.done?R(r.value):k(r.value).then(A,w)}O((K=K.apply(B,G||[])).next())})};const xt={paddingMedium:"0 3px",heightMedium:"24px",iconSizeMedium:"18px"},kr=nt({name:"UploadFile",props:{clsPrefix:{type:String,required:!0},file:{type:Object,required:!0},listType:{type:String,required:!0},index:{type:Number,required:!0}},setup(B){const G=Ct(pt),U=dt(null),K=dt(""),k=Ue(()=>{const{file:j}=B;return j.status==="finished"?"success":j.status==="error"?"error":"info"}),R=Ue(()=>{const{file:j}=B;if(j.status==="error")return"error"}),m=Ue(()=>{const{file:j}=B;return j.status==="uploading"}),A=Ue(()=>{if(!G.showCancelButtonRef.value)return!1;const{file:j}=B;return["uploading","pending","error"].includes(j.status)}),w=Ue(()=>{if(!G.showRemoveButtonRef.value)return!1;const{file:j}=B;return["finished"].includes(j.status)}),O=Ue(()=>{if(!G.showDownloadButtonRef.value)return!1;const{file:j}=B;return["finished"].includes(j.status)}),r=Ue(()=>{if(!G.showRetryButtonRef.value)return!1;const{file:j}=B;return["error"].includes(j.status)}),h=wn(()=>K.value||B.file.thumbnailUrl||B.file.url),f=Ue(()=>{if(!G.showPreviewButtonRef.value)return!1;const{file:{status:j},listType:c}=B;return["finished"].includes(j)&&h.value&&c==="image-card"});function S(){return nn(this,void 0,void 0,function*(){const j=G.onRetryRef.value;j&&(yield j({file:B.file}))===!1||G.submit(B.file.id)})}function d(j){j.preventDefault();const{file:c}=B;["finished","pending","error"].includes(c.status)?T(c):["uploading"].includes(c.status)?L(c):En("upload","The button clicked type is unknown.")}function p(j){j.preventDefault(),E(B.file)}function T(j){const{xhrMap:c,doChange:a,onRemoveRef:{value:b},mergedFileListRef:{value:i}}=G;Promise.resolve(b?b({file:Object.assign({},j),fileList:i,index:B.index}):!0).then(n=>{if(n===!1)return;const t=Object.assign({},j,{status:"removed"});c.delete(j.id),a(t,void 0,{remove:!0})})}function E(j){const{onDownloadRef:{value:c}}=G;Promise.resolve(c?c(Object.assign({},j)):!0).then(a=>{a!==!1&&Qn(j.url,j.name)})}function L(j){const{xhrMap:c}=G,a=c.get(j.id);a==null||a.abort(),T(Object.assign({},j))}function N(j){const{onPreviewRef:{value:c}}=G;if(c)c(B.file,{event:j});else if(B.listType==="image-card"){const{value:a}=U;if(!a)return;a.click()}}const D=()=>nn(this,void 0,void 0,function*(){const{listType:j}=B;j!=="image"&&j!=="image-card"||G.shouldUseThumbnailUrlRef.value(B.file)&&(K.value=yield G.getFileThumbnailUrlResolver(B.file))});return Pn(()=>{D()}),{mergedTheme:G.mergedThemeRef,progressStatus:k,buttonType:R,showProgress:m,disabled:G.mergedDisabledRef,showCancelButton:A,showRemoveButton:w,showDownloadButton:O,showRetryButton:r,showPreviewButton:f,mergedThumbnailUrl:h,shouldUseThumbnailUrl:G.shouldUseThumbnailUrlRef,renderIcon:G.renderIconRef,imageRef:U,handleRemoveOrCancelClick:d,handleDownloadClick:p,handleRetryClick:S,handlePreviewClick:N}},render(){const{clsPrefix:B,mergedTheme:G,listType:U,file:K,renderIcon:k}=this;let R;const m=U==="image";m||U==="image-card"?R=!this.shouldUseThumbnailUrl(K)||!this.mergedThumbnailUrl?V("span",{class:`${B}-upload-file-info__thumbnail`},k?k(K):pn(K)?V(Ye,{clsPrefix:B},{default:dr}):V(Ye,{clsPrefix:B},{default:fr})):V("a",{rel:"noopener noreferer",target:"_blank",href:K.url||void 0,class:`${B}-upload-file-info__thumbnail`,onClick:this.handlePreviewClick},U==="image-card"?V(Gn,{src:this.mergedThumbnailUrl||void 0,previewSrc:K.url||void 0,alt:K.name,ref:"imageRef"}):V("img",{src:this.mergedThumbnailUrl||void 0,alt:K.name})):R=V("span",{class:`${B}-upload-file-info__thumbnail`},k?k(K):V(Ye,{clsPrefix:B},{default:()=>V(Jn,null)}));const w=V(gr,{show:this.showProgress,percentage:K.percentage||0,status:this.progressStatus}),O=U==="text"||U==="image";return V("div",{class:[`${B}-upload-file`,`${B}-upload-file--${this.progressStatus}-status`,K.url&&K.status!=="error"&&U!=="image-card"&&`${B}-upload-file--with-url`,`${B}-upload-file--${U}-type`]},V("div",{class:`${B}-upload-file-info`},R,V("div",{class:`${B}-upload-file-info__name`},O&&(K.url&&K.status!=="error"?V("a",{rel:"noopener noreferer",target:"_blank",href:K.url||void 0,onClick:this.handlePreviewClick},K.name):V("span",{onClick:this.handlePreviewClick},K.name)),m&&w),V("div",{class:[`${B}-upload-file-info__action`,`${B}-upload-file-info__action--${U}-type`]},this.showPreviewButton?V(Rt,{key:"preview",quaternary:!0,type:this.buttonType,onClick:this.handlePreviewClick,theme:G.peers.Button,themeOverrides:G.peerOverrides.Button,builtinThemeOverrides:xt},{icon:()=>V(Ye,{clsPrefix:B},{default:()=>V(Tn,null)})}):null,(this.showRemoveButton||this.showCancelButton)&&!this.disabled&&V(Rt,{key:"cancelOrTrash",theme:G.peers.Button,themeOverrides:G.peerOverrides.Button,quaternary:!0,builtinThemeOverrides:xt,type:this.buttonType,onClick:this.handleRemoveOrCancelClick},{icon:()=>V(Bn,null,{default:()=>this.showRemoveButton?V(Ye,{clsPrefix:B,key:"trash"},{default:()=>V(er,null)}):V(Ye,{clsPrefix:B,key:"cancel"},{default:()=>V(Zn,null)})})}),this.showRetryButton&&!this.disabled&&V(Rt,{key:"retry",quaternary:!0,type:this.buttonType,onClick:this.handleRetryClick,theme:G.peers.Button,themeOverrides:G.peerOverrides.Button,builtinThemeOverrides:xt},{icon:()=>V(Ye,{clsPrefix:B},{default:()=>V(Yn,null)})}),this.showDownloadButton?V(Rt,{key:"download",quaternary:!0,type:this.buttonType,onClick:this.handleDownloadClick,theme:G.peers.Button,themeOverrides:G.peerOverrides.Button,builtinThemeOverrides:xt},{icon:()=>V(Ye,{clsPrefix:B},{default:()=>V(Wn,null)})}):null)),!m&&w)}}),vn=nt({name:"UploadTrigger",props:{abstract:Boolean},slots:Object,setup(B,{slots:G}){const U=Ct(pt,null);U||Pt("upload-trigger","`n-upload-trigger` must be placed inside `n-upload`.");const{mergedClsPrefixRef:K,mergedDisabledRef:k,maxReachedRef:R,listTypeRef:m,dragOverRef:A,openOpenFileDialog:w,draggerInsideRef:O,handleFileAddition:r,mergedDirectoryDndRef:h,triggerClassRef:f,triggerStyleRef:S}=U,d=Ue(()=>m.value==="image-card");function p(){k.value||R.value||w()}function T(D){D.preventDefault(),A.value=!0}function E(D){D.preventDefault(),A.value=!0}function L(D){D.preventDefault(),A.value=!1}function N(D){var j;if(D.preventDefault(),!O.value||k.value||R.value){A.value=!1;return}const c=(j=D.dataTransfer)===null||j===void 0?void 0:j.items;c!=null&&c.length?Cr(Array.from(c).map(a=>a.webkitGetAsEntry()),h.value).then(a=>{r(a)}).finally(()=>{A.value=!1}):A.value=!1}return()=>{var D;const{value:j}=K;return B.abstract?(D=G.default)===null||D===void 0?void 0:D.call(G,{handleClick:p,handleDrop:N,handleDragOver:T,handleDragEnter:E,handleDragLeave:L}):V("div",{class:[`${j}-upload-trigger`,(k.value||R.value)&&`${j}-upload-trigger--disabled`,d.value&&`${j}-upload-trigger--image-card`,f.value],style:S.value,onClick:p,onDrop:N,onDragover:T,onDragenter:E,onDragleave:L},d.value?V(cr,null,{default:()=>On(G.default,()=>[V(Ye,{clsPrefix:j},{default:()=>V(An,null)})])}):G)}}}),Sr=nt({name:"UploadFileList",setup(B,{slots:G}){const U=Ct(pt,null);U||Pt("upload-file-list","`n-upload-file-list` must be placed inside `n-upload`.");const{abstractRef:K,mergedClsPrefixRef:k,listTypeRef:R,mergedFileListRef:m,fileListClassRef:A,fileListStyleRef:w,cssVarsRef:O,themeClassRef:r,maxReachedRef:h,showTriggerRef:f,imageGroupPropsRef:S}=U,d=Ue(()=>R.value==="image-card"),p=()=>m.value.map((E,L)=>V(kr,{clsPrefix:k.value,key:E.id,file:E,index:L,listType:R.value})),T=()=>d.value?V(Xn,Object.assign({},S.value),{default:p}):V(fn,{group:!0},{default:p});return()=>{const{value:E}=k,{value:L}=K;return V("div",{class:[`${E}-upload-file-list`,d.value&&`${E}-upload-file-list--grid`,L?r==null?void 0:r.value:void 0,A.value],style:[L&&O?O.value:"",w.value]},T(),f.value&&!h.value&&d.value&&V(vn,null,G))}}});var rn=function(B,G,U,K){function k(R){return R instanceof U?R:new U(function(m){m(R)})}return new(U||(U=Promise))(function(R,m){function A(r){try{O(K.next(r))}catch(h){m(h)}}function w(r){try{O(K.throw(r))}catch(h){m(h)}}function O(r){r.done?R(r.value):k(r.value).then(A,w)}O((K=K.apply(B,G||[])).next())})};function br(B,G,U){const{doChange:K,xhrMap:k}=B;let R=0;function m(w){var O;let r=Object.assign({},G,{status:"error",percentage:R});k.delete(G.id),r=yt(((O=B.onError)===null||O===void 0?void 0:O.call(B,{file:r,event:w}))||r),K(r,w)}function A(w){var O;if(B.isErrorState){if(B.isErrorState(U)){m(w);return}}else if(U.status<200||U.status>=300){m(w);return}let r=Object.assign({},G,{status:"finished",percentage:R});k.delete(G.id),r=yt(((O=B.onFinish)===null||O===void 0?void 0:O.call(B,{file:r,event:w}))||r),K(r,w)}return{handleXHRLoad:A,handleXHRError:m,handleXHRAbort(w){const O=Object.assign({},G,{status:"removed",file:null,percentage:R});k.delete(G.id),K(O,w)},handleXHRProgress(w){const O=Object.assign({},G,{status:"uploading"});if(w.lengthComputable){const r=Math.ceil(w.loaded/w.total*100);O.percentage=r,R=r}K(O,w)}}}function Rr(B){const{inst:G,file:U,data:K,headers:k,withCredentials:R,action:m,customRequest:A}=B,{doChange:w}=B.inst;let O=0;A({file:U,data:K,headers:k,withCredentials:R,action:m,onProgress(r){const h=Object.assign({},U,{status:"uploading"}),f=r.percent;h.percentage=f,O=f,w(h)},onFinish(){var r;let h=Object.assign({},U,{status:"finished",percentage:O});h=yt(((r=G.onFinish)===null||r===void 0?void 0:r.call(G,{file:h}))||h),w(h)},onError(){var r;let h=Object.assign({},U,{status:"error",percentage:O});h=yt(((r=G.onError)===null||r===void 0?void 0:r.call(G,{file:h}))||h),w(h)}})}function xr(B,G,U){const K=br(B,G,U);U.onabort=K.handleXHRAbort,U.onerror=K.handleXHRError,U.onload=K.handleXHRLoad,U.upload&&(U.upload.onprogress=K.handleXHRProgress)}function yn(B,G){return typeof B=="function"?B({file:G}):B||{}}function Tr(B,G,U){const K=yn(G,U);K&&Object.keys(K).forEach(k=>{B.setRequestHeader(k,K[k])})}function Br(B,G,U){const K=yn(G,U);K&&Object.keys(K).forEach(k=>{B.append(k,K[k])})}function wr(B,G,U,{method:K,action:k,withCredentials:R,responseType:m,headers:A,data:w}){const O=new XMLHttpRequest;O.responseType=m,B.xhrMap.set(U.id,O),O.withCredentials=R;const r=new FormData;if(Br(r,w,U),U.file!==null&&r.append(G,U.file),xr(B,U,O),k!==void 0){O.open(K.toUpperCase(),k),Tr(O,A,U),O.send(r);const h=Object.assign({},U,{status:"uploading"});B.doChange(h)}}const Pr=Object.assign(Object.assign({},wt.props),{name:{type:String,default:"file"},accept:String,action:String,customRequest:Function,directory:Boolean,directoryDnd:{type:Boolean,default:void 0},method:{type:String,default:"POST"},multiple:Boolean,showFileList:{type:Boolean,default:!0},data:[Object,Function],headers:[Object,Function],withCredentials:Boolean,responseType:{type:String,default:""},disabled:{type:Boolean,default:void 0},onChange:Function,onRemove:Function,onFinish:Function,onError:Function,onRetry:Function,onBeforeUpload:Function,isErrorState:Function,onDownload:Function,defaultUpload:{type:Boolean,default:!0},fileList:Array,"onUpdate:fileList":[Function,Array],onUpdateFileList:[Function,Array],fileListClass:String,fileListStyle:[String,Object],defaultFileList:{type:Array,default:()=>[]},showCancelButton:{type:Boolean,default:!0},showRemoveButton:{type:Boolean,default:!0},showDownloadButton:Boolean,showRetryButton:{type:Boolean,default:!0},showPreviewButton:{type:Boolean,default:!0},listType:{type:String,default:"text"},onPreview:Function,shouldUseThumbnailUrl:{type:Function,default:B=>pr?pn(B):!1},createThumbnailUrl:Function,abstract:Boolean,max:Number,showTrigger:{type:Boolean,default:!0},imageGroupProps:Object,inputProps:Object,triggerClass:String,triggerStyle:[String,Object],renderIcon:Function}),Er=nt({name:"Upload",props:Pr,setup(B){B.abstract&&B.listType==="image-card"&&Pt("upload","when the list-type is image-card, abstract is not supported.");const{mergedClsPrefixRef:G,inlineThemeDisabled:U}=cn(B),K=wt("Upload","-upload",ur,Ln,B,G),k=jn(B),R=dt(B.defaultFileList),m=Fe(B,"fileList"),A=dt(null),w={value:!1},O=dt(!1),r=new Map,h=Nn(m,R),f=Ue(()=>h.value.map(yt)),S=Ue(()=>{const{max:i}=B;return i!==void 0?f.value.length>=i:!1});function d(){var i;(i=A.value)===null||i===void 0||i.click()}function p(i){const n=i.target;N(n.files?Array.from(n.files).map(t=>({file:t,entry:null,source:"input"})):null,i),n.value=""}function T(i){const{"onUpdate:fileList":n,onUpdateFileList:t}=B;n&&Zt(n,i),t&&Zt(t,i),R.value=i}const E=Ue(()=>B.multiple||B.directory),L=(i,n,t={append:!1,remove:!1})=>{const{append:s,remove:l}=t,v=Array.from(f.value),M=v.findIndex(x=>x.id===i.id);if(s||l||~M){s?v.push(i):l?v.splice(M,1):v.splice(M,1,i);const{onChange:x}=B;x&&x({file:i,fileList:v,event:n}),T(v)}};function N(i,n){if(!i||i.length===0)return;const{onBeforeUpload:t}=B;i=E.value?i:[i[0]];const{max:s,accept:l}=B;i=i.filter(({file:M,source:x})=>x==="dnd"&&(l!=null&&l.trim())?mr(M.name,M.type,l):!0),s&&(i=i.slice(0,s-f.value.length));const v=Jt();Promise.all(i.map(M=>rn(this,[M],void 0,function*({file:x,entry:H}){var $;const Y={id:Jt(),batchId:v,name:x.name,status:"pending",percentage:0,file:x,url:null,type:x.type,thumbnailUrl:null,fullPath:($=H==null?void 0:H.fullPath)!==null&&$!==void 0?$:`/${x.webkitRelativePath||x.name}`};return!t||(yield t({file:Y,fileList:f.value}))!==!1?Y:null}))).then(M=>rn(this,void 0,void 0,function*(){let x=Promise.resolve();M.forEach(H=>{x=x.then(Mn).then(()=>{H&&L(H,n,{append:!0})})}),yield x})).then(()=>{B.defaultUpload&&D()})}function D(i){const{method:n,action:t,withCredentials:s,headers:l,data:v,name:M}=B,x=i!==void 0?f.value.filter($=>$.id===i):f.value,H=i!==void 0;x.forEach($=>{const{status:Y}=$;(Y==="pending"||Y==="error"&&H)&&(B.customRequest?Rr({inst:{doChange:L,xhrMap:r,onFinish:B.onFinish,onError:B.onError},file:$,action:t,withCredentials:s,headers:l,data:v,customRequest:B.customRequest}):wr({doChange:L,xhrMap:r,onFinish:B.onFinish,onError:B.onError,isErrorState:B.isErrorState},M,$,{method:n,action:t,withCredentials:s,responseType:B.responseType,headers:l,data:v}))})}function j(i){var n;if(i.thumbnailUrl)return i.thumbnailUrl;const{createThumbnailUrl:t}=B;return t?(n=t(i.file,i))!==null&&n!==void 0?n:i.url||"":i.url?i.url:i.file?hr(i.file):""}const c=Ue(()=>{const{common:{cubicBezierEaseInOut:i},self:{draggerColor:n,draggerBorder:t,draggerBorderHover:s,itemColorHover:l,itemColorHoverError:v,itemTextColorError:M,itemTextColorSuccess:x,itemTextColor:H,itemIconColor:$,itemDisabledOpacity:Y,lineHeight:ee,borderRadius:re,fontSize:ie,itemBorderImageCardError:me,itemBorderImageCard:de}}=K.value;return{"--n-bezier":i,"--n-border-radius":re,"--n-dragger-border":t,"--n-dragger-border-hover":s,"--n-dragger-color":n,"--n-font-size":ie,"--n-item-color-hover":l,"--n-item-color-hover-error":v,"--n-item-disabled-opacity":Y,"--n-item-icon-color":$,"--n-item-text-color":H,"--n-item-text-color-error":M,"--n-item-text-color-success":x,"--n-line-height":ee,"--n-item-border-image-card-error":me,"--n-item-border-image-card":de}}),a=U?dn("upload",void 0,c,B):void 0;Fn(pt,{mergedClsPrefixRef:G,mergedThemeRef:K,showCancelButtonRef:Fe(B,"showCancelButton"),showDownloadButtonRef:Fe(B,"showDownloadButton"),showRemoveButtonRef:Fe(B,"showRemoveButton"),showRetryButtonRef:Fe(B,"showRetryButton"),onRemoveRef:Fe(B,"onRemove"),onDownloadRef:Fe(B,"onDownload"),mergedFileListRef:f,triggerClassRef:Fe(B,"triggerClass"),triggerStyleRef:Fe(B,"triggerStyle"),shouldUseThumbnailUrlRef:Fe(B,"shouldUseThumbnailUrl"),renderIconRef:Fe(B,"renderIcon"),xhrMap:r,submit:D,doChange:L,showPreviewButtonRef:Fe(B,"showPreviewButton"),onPreviewRef:Fe(B,"onPreview"),getFileThumbnailUrlResolver:j,listTypeRef:Fe(B,"listType"),dragOverRef:O,openOpenFileDialog:d,draggerInsideRef:w,handleFileAddition:N,mergedDisabledRef:k.mergedDisabledRef,maxReachedRef:S,fileListClassRef:Fe(B,"fileListClass"),fileListStyleRef:Fe(B,"fileListStyle"),abstractRef:Fe(B,"abstract"),acceptRef:Fe(B,"accept"),cssVarsRef:U?void 0:c,themeClassRef:a==null?void 0:a.themeClass,onRender:a==null?void 0:a.onRender,showTriggerRef:Fe(B,"showTrigger"),imageGroupPropsRef:Fe(B,"imageGroupProps"),mergedDirectoryDndRef:Ue(()=>{var i;return(i=B.directoryDnd)!==null&&i!==void 0?i:B.directory}),onRetryRef:Fe(B,"onRetry")});const b={clear:()=>{R.value=[]},submit:D,openOpenFileDialog:d};return Object.assign({mergedClsPrefix:G,draggerInsideRef:w,inputElRef:A,mergedTheme:K,dragOver:O,mergedMultiple:E,cssVars:U?void 0:c,themeClass:a==null?void 0:a.themeClass,onRender:a==null?void 0:a.onRender,handleFileInputChange:p},b)},render(){var B,G;const{draggerInsideRef:U,mergedClsPrefix:K,$slots:k,directory:R,onRender:m}=this;if(k.default&&!this.abstract){const w=k.default()[0];!((B=w==null?void 0:w.type)===null||B===void 0)&&B[gn]&&(U.value=!0)}const A=V("input",Object.assign({},this.inputProps,{ref:"inputElRef",type:"file",class:`${K}-upload-file-input`,accept:this.accept,multiple:this.mergedMultiple,onChange:this.handleFileInputChange,webkitdirectory:R||void 0,directory:R||void 0}));return this.abstract?V(Un,null,(G=k.default)===null||G===void 0?void 0:G.call(k),V(In,{to:"body"},A)):(m==null||m(),V("div",{class:[`${K}-upload`,U.value&&`${K}-upload--dragger-inside`,this.dragOver&&`${K}-upload--drag-over`,this.themeClass],style:this.cssVars},A,this.showTrigger&&this.listType!=="image-card"&&V(vn,null,k),this.showFileList&&V(Sr,null,k)))}});var Tt={exports:{}},Or=Tt.exports,on;function Ar(){return on||(on=1,function(B,G){(function(K,k){B.exports=k()})(Or,function(){return function(U){var K={};function k(R){if(K[R])return K[R].exports;var m=K[R]={i:R,l:!1,exports:{}};return U[R].call(m.exports,m,m.exports,k),m.l=!0,m.exports}return k.m=U,k.c=K,k.d=function(R,m,A){k.o(R,m)||Object.defineProperty(R,m,{enumerable:!0,get:A})},k.r=function(R){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(R,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(R,"__esModule",{value:!0})},k.t=function(R,m){if(m&1&&(R=k(R)),m&8||m&4&&typeof R=="object"&&R&&R.__esModule)return R;var A=Object.create(null);if(k.r(A),Object.defineProperty(A,"default",{enumerable:!0,value:R}),m&2&&typeof R!="string")for(var w in R)k.d(A,w,(function(O){return R[O]}).bind(null,w));return A},k.n=function(R){var m=R&&R.__esModule?function(){return R.default}:function(){return R};return k.d(m,"a",m),m},k.o=function(R,m){return Object.prototype.hasOwnProperty.call(R,m)},k.p="/dist/",k(k.s="./index.js")}({"./index.js":function(U,K,k){var R=k("./src/cos.js");U.exports=R},"./lib/base64.js":function(U,K){var k=function(R){R=R||{};var m=R.Base64,A="2.1.9",w="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",O=function(s){for(var l={},v=0,M=s.length;v<M;v++)l[s.charAt(v)]=v;return l}(w),r=String.fromCharCode,h=function(l){if(l.length<2){var v=l.charCodeAt(0);return v<128?l:v<2048?r(192|v>>>6)+r(128|v&63):r(224|v>>>12&15)+r(128|v>>>6&63)+r(128|v&63)}else{var v=65536+(l.charCodeAt(0)-55296)*1024+(l.charCodeAt(1)-56320);return r(240|v>>>18&7)+r(128|v>>>12&63)+r(128|v>>>6&63)+r(128|v&63)}},f=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,S=function(l){return l.replace(f,h)},d=function(l){var v=[0,2,1][l.length%3],M=l.charCodeAt(0)<<16|(l.length>1?l.charCodeAt(1):0)<<8|(l.length>2?l.charCodeAt(2):0),x=[w.charAt(M>>>18),w.charAt(M>>>12&63),v>=2?"=":w.charAt(M>>>6&63),v>=1?"=":w.charAt(M&63)];return x.join("")},p=R.btoa?function(s){return R.btoa(s)}:function(s){return s.replace(/[\s\S]{1,3}/g,d)},T=function(s){return p(S(s))},E=function(l,v){return v?T(String(l)).replace(/[+\/]/g,function(M){return M=="+"?"-":"_"}).replace(/=/g,""):T(String(l))},L=function(l){return E(l,!0)},N=new RegExp(["[À-ß][-¿]","[à-ï][-¿]{2}","[ð-÷][-¿]{3}"].join("|"),"g"),D=function(l){switch(l.length){case 4:var v=(7&l.charCodeAt(0))<<18|(63&l.charCodeAt(1))<<12|(63&l.charCodeAt(2))<<6|63&l.charCodeAt(3),M=v-65536;return r((M>>>10)+55296)+r((M&1023)+56320);case 3:return r((15&l.charCodeAt(0))<<12|(63&l.charCodeAt(1))<<6|63&l.charCodeAt(2));default:return r((31&l.charCodeAt(0))<<6|63&l.charCodeAt(1))}},j=function(l){return l.replace(N,D)},c=function(l){var v=l.length,M=v%4,x=(v>0?O[l.charAt(0)]<<18:0)|(v>1?O[l.charAt(1)]<<12:0)|(v>2?O[l.charAt(2)]<<6:0)|(v>3?O[l.charAt(3)]:0),H=[r(x>>>16),r(x>>>8&255),r(x&255)];return H.length-=[0,0,2,1][M],H.join("")},a=R.atob?function(s){return R.atob(s)}:function(s){return s.replace(/[\s\S]{1,4}/g,c)},b=function(s){return j(a(s))},i=function(l){return b(String(l).replace(/[-_]/g,function(v){return v=="-"?"+":"/"}).replace(/[^A-Za-z0-9\+\/]/g,""))},n=function(){var l=R.Base64;return R.Base64=m,l},t={VERSION:A,atob:a,btoa:p,fromBase64:i,toBase64:E,utob:S,encode:E,encodeURI:L,btou:j,decode:i,noConflict:n};return t}();U.exports=k},"./lib/crypto.js":function(U,K,k){(function(R){var m=k("./node_modules/@babel/runtime/helpers/typeof.js"),A=A||function(w,O){var r={},h=r.lib={},f=function(){},S=h.Base={extend:function(c){f.prototype=this;var a=new f;return c&&a.mixIn(c),a.hasOwnProperty("init")||(a.init=function(){a.$super.init.apply(this,arguments)}),a.init.prototype=a,a.$super=this,a},create:function(){var c=this.extend();return c.init.apply(c,arguments),c},init:function(){},mixIn:function(c){for(var a in c)c.hasOwnProperty(a)&&(this[a]=c[a]);c.hasOwnProperty("toString")&&(this.toString=c.toString)},clone:function(){return this.init.prototype.extend(this)}},d=h.WordArray=S.extend({init:function(c,a){c=this.words=c||[],this.sigBytes=a!=O?a:4*c.length},toString:function(c){return(c||T).stringify(this)},concat:function(c){var a=this.words,b=c.words,i=this.sigBytes;if(c=c.sigBytes,this.clamp(),i%4)for(var n=0;n<c;n++)a[i+n>>>2]|=(b[n>>>2]>>>24-8*(n%4)&255)<<24-8*((i+n)%4);else if(65535<b.length)for(n=0;n<c;n+=4)a[i+n>>>2]=b[n>>>2];else a.push.apply(a,b);return this.sigBytes+=c,this},clamp:function(){var c=this.words,a=this.sigBytes;c[a>>>2]&=4294967295<<32-8*(a%4),c.length=w.ceil(a/4)},clone:function(){var c=S.clone.call(this);return c.words=this.words.slice(0),c},random:function(c){for(var a=[],b=0;b<c;b+=4)a.push(4294967296*w.random()|0);return new d.init(a,c)}}),p=r.enc={},T=p.Hex={stringify:function(c){var a=c.words;c=c.sigBytes;for(var b=[],i=0;i<c;i++){var n=a[i>>>2]>>>24-8*(i%4)&255;b.push((n>>>4).toString(16)),b.push((n&15).toString(16))}return b.join("")},parse:function(c){for(var a=c.length,b=[],i=0;i<a;i+=2)b[i>>>3]|=parseInt(c.substr(i,2),16)<<24-4*(i%8);return new d.init(b,a/2)}},E=p.Latin1={stringify:function(c){var a=c.words;c=c.sigBytes;for(var b=[],i=0;i<c;i++)b.push(String.fromCharCode(a[i>>>2]>>>24-8*(i%4)&255));return b.join("")},parse:function(c){for(var a=c.length,b=[],i=0;i<a;i++)b[i>>>2]|=(c.charCodeAt(i)&255)<<24-8*(i%4);return new d.init(b,a)}},L=p.Utf8={stringify:function(c){try{return decodeURIComponent(escape(E.stringify(c)))}catch{throw Error("Malformed UTF-8 data")}},parse:function(c){return E.parse(unescape(encodeURIComponent(c)))}},N=h.BufferedBlockAlgorithm=S.extend({reset:function(){this._data=new d.init,this._nDataBytes=0},_append:function(c){typeof c=="string"&&(c=L.parse(c)),this._data.concat(c),this._nDataBytes+=c.sigBytes},_process:function(c){var a=this._data,b=a.words,i=a.sigBytes,n=this.blockSize,t=i/(4*n),t=c?w.ceil(t):w.max((t|0)-this._minBufferSize,0);if(c=t*n,i=w.min(4*c,i),c){for(var s=0;s<c;s+=n)this._doProcessBlock(b,s);s=b.splice(0,c),a.sigBytes-=i}return new d.init(s,i)},clone:function(){var c=S.clone.call(this);return c._data=this._data.clone(),c},_minBufferSize:0});h.Hasher=N.extend({cfg:S.extend(),init:function(c){this.cfg=this.cfg.extend(c),this.reset()},reset:function(){N.reset.call(this),this._doReset()},update:function(c){return this._append(c),this._process(),this},finalize:function(c){return c&&this._append(c),this._doFinalize()},blockSize:16,_createHelper:function(c){return function(a,b){return new c.init(b).finalize(a)}},_createHmacHelper:function(c){return function(a,b){return new D.HMAC.init(c,b).finalize(a)}}});var D=r.algo={};return r}(Math);(function(){var w=A,f=w.lib,O=f.WordArray,r=f.Hasher,h=[],f=w.algo.SHA1=r.extend({_doReset:function(){this._hash=new O.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(d,p){for(var T=this._hash.words,E=T[0],L=T[1],N=T[2],D=T[3],j=T[4],c=0;80>c;c++){if(16>c)h[c]=d[p+c]|0;else{var a=h[c-3]^h[c-8]^h[c-14]^h[c-16];h[c]=a<<1|a>>>31}a=(E<<5|E>>>27)+j+h[c],a=20>c?a+((L&N|~L&D)+1518500249):40>c?a+((L^N^D)+1859775393):60>c?a+((L&N|L&D|N&D)-1894007588):a+((L^N^D)-899497514),j=D,D=N,N=L<<30|L>>>2,L=E,E=a}T[0]=T[0]+E|0,T[1]=T[1]+L|0,T[2]=T[2]+N|0,T[3]=T[3]+D|0,T[4]=T[4]+j|0},_doFinalize:function(){var d=this._data,p=d.words,T=8*this._nDataBytes,E=8*d.sigBytes;return p[E>>>5]|=128<<24-E%32,p[(E+64>>>9<<4)+14]=Math.floor(T/4294967296),p[(E+64>>>9<<4)+15]=T,d.sigBytes=4*p.length,this._process(),this._hash},clone:function(){var d=r.clone.call(this);return d._hash=this._hash.clone(),d}});w.SHA1=r._createHelper(f),w.HmacSHA1=r._createHmacHelper(f)})(),function(){var w=A,O=w.enc.Utf8;w.algo.HMAC=w.lib.Base.extend({init:function(h,f){h=this._hasher=new h.init,typeof f=="string"&&(f=O.parse(f));var S=h.blockSize,d=4*S;f.sigBytes>d&&(f=h.finalize(f)),f.clamp();for(var p=this._oKey=f.clone(),T=this._iKey=f.clone(),E=p.words,L=T.words,N=0;N<S;N++)E[N]^=1549556828,L[N]^=909522486;p.sigBytes=T.sigBytes=d,this.reset()},reset:function(){var h=this._hasher;h.reset(),h.update(this._iKey)},update:function(h){return this._hasher.update(h),this},finalize:function(h){var f=this._hasher;return h=f.finalize(h),f.reset(),f.finalize(this._oKey.clone().concat(h))}})}(),function(){var w=A,O=w.lib,r=O.WordArray,h=w.enc;h.Base64={stringify:function(S){var d=S.words,p=S.sigBytes,T=this._map;S.clamp();for(var E=[],L=0;L<p;L+=3)for(var N=d[L>>>2]>>>24-L%4*8&255,D=d[L+1>>>2]>>>24-(L+1)%4*8&255,j=d[L+2>>>2]>>>24-(L+2)%4*8&255,c=N<<16|D<<8|j,a=0;a<4&&L+a*.75<p;a++)E.push(T.charAt(c>>>6*(3-a)&63));var b=T.charAt(64);if(b)for(;E.length%4;)E.push(b);return E.join("")},parse:function(S){var d=S.length,p=this._map,T=p.charAt(64);if(T){var E=S.indexOf(T);E!=-1&&(d=E)}for(var L=[],N=0,D=0;D<d;D++)if(D%4){var j=p.indexOf(S.charAt(D-1))<<D%4*2,c=p.indexOf(S.charAt(D))>>>6-D%4*2;L[N>>>2]|=(j|c)<<24-N%4*8,N++}return r.create(L,N)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),m(R)==="object"?R.exports=A:window.CryptoJS=A}).call(this,k("./node_modules/webpack/buildin/module.js")(U))},"./lib/md5.js":function(U,K,k){(function(R){var m,A=k("./node_modules/@babel/runtime/helpers/typeof.js");(function(){var w=(typeof window>"u"?"undefined":A(window))==="object",O=w?window:{};O.JS_MD5_NO_WINDOW&&(w=!1);var r=!w&&(typeof self>"u"?"undefined":A(self))==="object";r&&(O=self);var h=!O.JS_MD5_NO_COMMON_JS&&A(R)==="object"&&R.exports,f=k("./node_modules/webpack/buildin/amd-options.js"),S=!O.JS_MD5_NO_ARRAY_BUFFER&&typeof ArrayBuffer<"u",d="0123456789abcdef".split(""),p=[128,32768,8388608,-2147483648],T=[0,8,16,24],E=["hex","array","digest","buffer","arrayBuffer","base64"],L="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),N=[],D;if(S){var j=new ArrayBuffer(68);D=new Uint8Array(j),N=new Uint32Array(j)}(O.JS_MD5_NO_NODE_JS||!Array.isArray)&&(Array.isArray=function(n){return Object.prototype.toString.call(n)==="[object Array]"}),S&&(O.JS_MD5_NO_ARRAY_BUFFER_IS_VIEW||!ArrayBuffer.isView)&&(ArrayBuffer.isView=function(n){return A(n)==="object"&&n.buffer&&n.buffer.constructor===ArrayBuffer});var c=function(t){return function(s,l){return new b(!0).update(s,l)[t]()}},a=function(){var t=c("hex");t.getCtx=t.create=function(){return new b},t.update=function(v){return t.create().update(v)};for(var s=0;s<E.length;++s){var l=E[s];t[l]=c(l)}return t};function b(n){if(n)N[0]=N[16]=N[1]=N[2]=N[3]=N[4]=N[5]=N[6]=N[7]=N[8]=N[9]=N[10]=N[11]=N[12]=N[13]=N[14]=N[15]=0,this.blocks=N,this.buffer8=D;else if(S){var t=new ArrayBuffer(68);this.buffer8=new Uint8Array(t),this.blocks=new Uint32Array(t)}else this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];this.h0=this.h1=this.h2=this.h3=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}b.prototype.update=function(n,t){if(!this.finalized){for(var s,l=0,v,M=n.length,x=this.blocks,H=this.buffer8;l<M;){if(this.hashed&&(this.hashed=!1,x[0]=x[16],x[16]=x[1]=x[2]=x[3]=x[4]=x[5]=x[6]=x[7]=x[8]=x[9]=x[10]=x[11]=x[12]=x[13]=x[14]=x[15]=0),S)for(v=this.start;l<M&&v<64;++l)s=n.charCodeAt(l),t||s<128?H[v++]=s:s<2048?(H[v++]=192|s>>6,H[v++]=128|s&63):s<55296||s>=57344?(H[v++]=224|s>>12,H[v++]=128|s>>6&63,H[v++]=128|s&63):(s=65536+((s&1023)<<10|n.charCodeAt(++l)&1023),H[v++]=240|s>>18,H[v++]=128|s>>12&63,H[v++]=128|s>>6&63,H[v++]=128|s&63);else for(v=this.start;l<M&&v<64;++l)s=n.charCodeAt(l),t||s<128?x[v>>2]|=s<<T[v++&3]:s<2048?(x[v>>2]|=(192|s>>6)<<T[v++&3],x[v>>2]|=(128|s&63)<<T[v++&3]):s<55296||s>=57344?(x[v>>2]|=(224|s>>12)<<T[v++&3],x[v>>2]|=(128|s>>6&63)<<T[v++&3],x[v>>2]|=(128|s&63)<<T[v++&3]):(s=65536+((s&1023)<<10|n.charCodeAt(++l)&1023),x[v>>2]|=(240|s>>18)<<T[v++&3],x[v>>2]|=(128|s>>12&63)<<T[v++&3],x[v>>2]|=(128|s>>6&63)<<T[v++&3],x[v>>2]|=(128|s&63)<<T[v++&3]);this.lastByteIndex=v,this.bytes+=v-this.start,v>=64?(this.start=v-64,this.hash(),this.hashed=!0):this.start=v}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}},b.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var n=this.blocks,t=this.lastByteIndex;n[t>>2]|=p[t&3],t>=56&&(this.hashed||this.hash(),n[0]=n[16],n[16]=n[1]=n[2]=n[3]=n[4]=n[5]=n[6]=n[7]=n[8]=n[9]=n[10]=n[11]=n[12]=n[13]=n[14]=n[15]=0),n[14]=this.bytes<<3,n[15]=this.hBytes<<3|this.bytes>>>29,this.hash()}},b.prototype.hash=function(){var n,t,s,l,v,M,x=this.blocks;this.first?(n=x[0]-680876937,n=(n<<7|n>>>25)-271733879<<0,l=(-1732584194^n&2004318071)+x[1]-117830708,l=(l<<12|l>>>20)+n<<0,s=(-271733879^l&(n^-271733879))+x[2]-1126478375,s=(s<<17|s>>>15)+l<<0,t=(n^s&(l^n))+x[3]-1316259209,t=(t<<22|t>>>10)+s<<0):(n=this.h0,t=this.h1,s=this.h2,l=this.h3,n+=(l^t&(s^l))+x[0]-680876936,n=(n<<7|n>>>25)+t<<0,l+=(s^n&(t^s))+x[1]-389564586,l=(l<<12|l>>>20)+n<<0,s+=(t^l&(n^t))+x[2]+606105819,s=(s<<17|s>>>15)+l<<0,t+=(n^s&(l^n))+x[3]-1044525330,t=(t<<22|t>>>10)+s<<0),n+=(l^t&(s^l))+x[4]-176418897,n=(n<<7|n>>>25)+t<<0,l+=(s^n&(t^s))+x[5]+1200080426,l=(l<<12|l>>>20)+n<<0,s+=(t^l&(n^t))+x[6]-1473231341,s=(s<<17|s>>>15)+l<<0,t+=(n^s&(l^n))+x[7]-45705983,t=(t<<22|t>>>10)+s<<0,n+=(l^t&(s^l))+x[8]+1770035416,n=(n<<7|n>>>25)+t<<0,l+=(s^n&(t^s))+x[9]-1958414417,l=(l<<12|l>>>20)+n<<0,s+=(t^l&(n^t))+x[10]-42063,s=(s<<17|s>>>15)+l<<0,t+=(n^s&(l^n))+x[11]-1990404162,t=(t<<22|t>>>10)+s<<0,n+=(l^t&(s^l))+x[12]+1804603682,n=(n<<7|n>>>25)+t<<0,l+=(s^n&(t^s))+x[13]-40341101,l=(l<<12|l>>>20)+n<<0,s+=(t^l&(n^t))+x[14]-1502002290,s=(s<<17|s>>>15)+l<<0,t+=(n^s&(l^n))+x[15]+1236535329,t=(t<<22|t>>>10)+s<<0,n+=(s^l&(t^s))+x[1]-165796510,n=(n<<5|n>>>27)+t<<0,l+=(t^s&(n^t))+x[6]-1069501632,l=(l<<9|l>>>23)+n<<0,s+=(n^t&(l^n))+x[11]+643717713,s=(s<<14|s>>>18)+l<<0,t+=(l^n&(s^l))+x[0]-373897302,t=(t<<20|t>>>12)+s<<0,n+=(s^l&(t^s))+x[5]-701558691,n=(n<<5|n>>>27)+t<<0,l+=(t^s&(n^t))+x[10]+38016083,l=(l<<9|l>>>23)+n<<0,s+=(n^t&(l^n))+x[15]-660478335,s=(s<<14|s>>>18)+l<<0,t+=(l^n&(s^l))+x[4]-405537848,t=(t<<20|t>>>12)+s<<0,n+=(s^l&(t^s))+x[9]+568446438,n=(n<<5|n>>>27)+t<<0,l+=(t^s&(n^t))+x[14]-1019803690,l=(l<<9|l>>>23)+n<<0,s+=(n^t&(l^n))+x[3]-187363961,s=(s<<14|s>>>18)+l<<0,t+=(l^n&(s^l))+x[8]+1163531501,t=(t<<20|t>>>12)+s<<0,n+=(s^l&(t^s))+x[13]-1444681467,n=(n<<5|n>>>27)+t<<0,l+=(t^s&(n^t))+x[2]-51403784,l=(l<<9|l>>>23)+n<<0,s+=(n^t&(l^n))+x[7]+1735328473,s=(s<<14|s>>>18)+l<<0,t+=(l^n&(s^l))+x[12]-1926607734,t=(t<<20|t>>>12)+s<<0,v=t^s,n+=(v^l)+x[5]-378558,n=(n<<4|n>>>28)+t<<0,l+=(v^n)+x[8]-2022574463,l=(l<<11|l>>>21)+n<<0,M=l^n,s+=(M^t)+x[11]+1839030562,s=(s<<16|s>>>16)+l<<0,t+=(M^s)+x[14]-35309556,t=(t<<23|t>>>9)+s<<0,v=t^s,n+=(v^l)+x[1]-1530992060,n=(n<<4|n>>>28)+t<<0,l+=(v^n)+x[4]+1272893353,l=(l<<11|l>>>21)+n<<0,M=l^n,s+=(M^t)+x[7]-155497632,s=(s<<16|s>>>16)+l<<0,t+=(M^s)+x[10]-1094730640,t=(t<<23|t>>>9)+s<<0,v=t^s,n+=(v^l)+x[13]+681279174,n=(n<<4|n>>>28)+t<<0,l+=(v^n)+x[0]-358537222,l=(l<<11|l>>>21)+n<<0,M=l^n,s+=(M^t)+x[3]-722521979,s=(s<<16|s>>>16)+l<<0,t+=(M^s)+x[6]+76029189,t=(t<<23|t>>>9)+s<<0,v=t^s,n+=(v^l)+x[9]-640364487,n=(n<<4|n>>>28)+t<<0,l+=(v^n)+x[12]-421815835,l=(l<<11|l>>>21)+n<<0,M=l^n,s+=(M^t)+x[15]+530742520,s=(s<<16|s>>>16)+l<<0,t+=(M^s)+x[2]-995338651,t=(t<<23|t>>>9)+s<<0,n+=(s^(t|~l))+x[0]-198630844,n=(n<<6|n>>>26)+t<<0,l+=(t^(n|~s))+x[7]+1126891415,l=(l<<10|l>>>22)+n<<0,s+=(n^(l|~t))+x[14]-1416354905,s=(s<<15|s>>>17)+l<<0,t+=(l^(s|~n))+x[5]-57434055,t=(t<<21|t>>>11)+s<<0,n+=(s^(t|~l))+x[12]+1700485571,n=(n<<6|n>>>26)+t<<0,l+=(t^(n|~s))+x[3]-1894986606,l=(l<<10|l>>>22)+n<<0,s+=(n^(l|~t))+x[10]-1051523,s=(s<<15|s>>>17)+l<<0,t+=(l^(s|~n))+x[1]-2054922799,t=(t<<21|t>>>11)+s<<0,n+=(s^(t|~l))+x[8]+1873313359,n=(n<<6|n>>>26)+t<<0,l+=(t^(n|~s))+x[15]-30611744,l=(l<<10|l>>>22)+n<<0,s+=(n^(l|~t))+x[6]-1560198380,s=(s<<15|s>>>17)+l<<0,t+=(l^(s|~n))+x[13]+1309151649,t=(t<<21|t>>>11)+s<<0,n+=(s^(t|~l))+x[4]-145523070,n=(n<<6|n>>>26)+t<<0,l+=(t^(n|~s))+x[11]-1120210379,l=(l<<10|l>>>22)+n<<0,s+=(n^(l|~t))+x[2]+718787259,s=(s<<15|s>>>17)+l<<0,t+=(l^(s|~n))+x[9]-343485551,t=(t<<21|t>>>11)+s<<0,this.first?(this.h0=n+1732584193<<0,this.h1=t-271733879<<0,this.h2=s-1732584194<<0,this.h3=l+271733878<<0,this.first=!1):(this.h0=this.h0+n<<0,this.h1=this.h1+t<<0,this.h2=this.h2+s<<0,this.h3=this.h3+l<<0)},b.prototype.hex=function(){this.finalize();var n=this.h0,t=this.h1,s=this.h2,l=this.h3;return d[n>>4&15]+d[n&15]+d[n>>12&15]+d[n>>8&15]+d[n>>20&15]+d[n>>16&15]+d[n>>28&15]+d[n>>24&15]+d[t>>4&15]+d[t&15]+d[t>>12&15]+d[t>>8&15]+d[t>>20&15]+d[t>>16&15]+d[t>>28&15]+d[t>>24&15]+d[s>>4&15]+d[s&15]+d[s>>12&15]+d[s>>8&15]+d[s>>20&15]+d[s>>16&15]+d[s>>28&15]+d[s>>24&15]+d[l>>4&15]+d[l&15]+d[l>>12&15]+d[l>>8&15]+d[l>>20&15]+d[l>>16&15]+d[l>>28&15]+d[l>>24&15]},b.prototype.toString=b.prototype.hex,b.prototype.digest=function(n){if(n==="hex")return this.hex();this.finalize();var t=this.h0,s=this.h1,l=this.h2,v=this.h3,M=[t&255,t>>8&255,t>>16&255,t>>24&255,s&255,s>>8&255,s>>16&255,s>>24&255,l&255,l>>8&255,l>>16&255,l>>24&255,v&255,v>>8&255,v>>16&255,v>>24&255];return M},b.prototype.array=b.prototype.digest,b.prototype.arrayBuffer=function(){this.finalize();var n=new ArrayBuffer(16),t=new Uint32Array(n);return t[0]=this.h0,t[1]=this.h1,t[2]=this.h2,t[3]=this.h3,n},b.prototype.buffer=b.prototype.arrayBuffer,b.prototype.base64=function(){for(var n,t,s,l="",v=this.array(),M=0;M<15;)n=v[M++],t=v[M++],s=v[M++],l+=L[n>>>2]+L[(n<<4|t>>>4)&63]+L[(t<<2|s>>>6)&63]+L[s&63];return n=v[M],l+=L[n>>>2]+L[n<<4&63]+"==",l};var i=a();h?R.exports=i:(O.md5=i,f&&(m=(function(){return i}).call(i,k,i,R),m!==void 0&&(R.exports=m)))})()}).call(this,k("./node_modules/webpack/buildin/module.js")(U))},"./lib/request.js":function(U,K,k){var R=k("./node_modules/@babel/runtime/helpers/typeof.js"),m=function(f){switch(R(f)){case"string":return f;case"boolean":return f?"true":"false";case"number":return isFinite(f)?f:"";default:return""}},A=function(f,S,d,p){return S=S||"&",d=d||"=",f===null&&(f=void 0),R(f)==="object"?Object.keys(f).map(function(T){var E=encodeURIComponent(m(T))+d;return Array.isArray(f[T])?f[T].map(function(L){return E+encodeURIComponent(m(L))}).join(S):E+encodeURIComponent(m(f[T]))}).filter(Boolean).join(S):""},w=function(f,S,d){var p={},T=S.getAllResponseHeaders();return T&&T.length>0&&T.trim().split(`
`).forEach(function(E){if(E){var L=E.indexOf(":"),N=E.substr(0,L).trim().toLowerCase(),D=E.substr(L+1).trim();p[N]=D}}),{error:f,statusCode:S.status,statusMessage:S.statusText,headers:p,body:d}},O=function(f,S){return!S&&S==="text"?f.responseText:f.response},r=function(f,S){var d=(f.method||"GET").toUpperCase(),p=f.url;if(f.qs){var T=A(f.qs);T&&(p+=(p.indexOf("?")===-1?"?":"&")+T)}var E=new XMLHttpRequest;if(E.open(d,p,!0),E.responseType=f.dataType||"text",f.xhrFields)for(var L in f.xhrFields)E[L]=f.xhrFields[L];var N=f.headers;if(N)for(var D in N)N.hasOwnProperty(D)&&D.toLowerCase()!=="content-length"&&D.toLowerCase()!=="user-agent"&&D.toLowerCase()!=="origin"&&D.toLowerCase()!=="host"&&E.setRequestHeader(D,N[D]);return f.onProgress&&E.upload&&(E.upload.onprogress=f.onProgress),f.onDownloadProgress&&(E.onprogress=f.onDownloadProgress),f.timeout&&(E.timeout=f.timeout),E.ontimeout=function(j){var c=new Error("timeout");S(w(c,E))},E.onload=function(){S(w(null,E,O(E,f.dataType)))},E.onerror=function(j){var c=O(E,f.dataType);if(c)S(w(null,E,c));else{var a=E.statusText;!a&&E.status===0&&(a=new Error("CORS blocked or network error")),S(w(a,E,c))}},E.send(f.body||""),E};U.exports=r},"./node_modules/@babel/runtime/helpers/classCallCheck.js":function(U,K){function k(R,m){if(!(R instanceof m))throw new TypeError("Cannot call a class as a function")}U.exports=k,U.exports.__esModule=!0,U.exports.default=U.exports},"./node_modules/@babel/runtime/helpers/createClass.js":function(U,K,k){var R=k("./node_modules/@babel/runtime/helpers/toPropertyKey.js");function m(w,O){for(var r=0;r<O.length;r++){var h=O[r];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(w,R(h.key),h)}}function A(w,O,r){return O&&m(w.prototype,O),r&&m(w,r),Object.defineProperty(w,"prototype",{writable:!1}),w}U.exports=A,U.exports.__esModule=!0,U.exports.default=U.exports},"./node_modules/@babel/runtime/helpers/defineProperty.js":function(U,K,k){var R=k("./node_modules/@babel/runtime/helpers/toPropertyKey.js");function m(A,w,O){return(w=R(w))in A?Object.defineProperty(A,w,{value:O,enumerable:!0,configurable:!0,writable:!0}):A[w]=O,A}U.exports=m,U.exports.__esModule=!0,U.exports.default=U.exports},"./node_modules/@babel/runtime/helpers/toPrimitive.js":function(U,K,k){var R=k("./node_modules/@babel/runtime/helpers/typeof.js").default;function m(A,w){if(R(A)!="object"||!A)return A;var O=A[Symbol.toPrimitive];if(O!==void 0){var r=O.call(A,w||"default");if(R(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(w==="string"?String:Number)(A)}U.exports=m,U.exports.__esModule=!0,U.exports.default=U.exports},"./node_modules/@babel/runtime/helpers/toPropertyKey.js":function(U,K,k){var R=k("./node_modules/@babel/runtime/helpers/typeof.js").default,m=k("./node_modules/@babel/runtime/helpers/toPrimitive.js");function A(w){var O=m(w,"string");return R(O)=="symbol"?O:O+""}U.exports=A,U.exports.__esModule=!0,U.exports.default=U.exports},"./node_modules/@babel/runtime/helpers/typeof.js":function(U,K){function k(R){"@babel/helpers - typeof";return U.exports=k=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(m){return typeof m}:function(m){return m&&typeof Symbol=="function"&&m.constructor===Symbol&&m!==Symbol.prototype?"symbol":typeof m},U.exports.__esModule=!0,U.exports.default=U.exports,k(R)}U.exports=k,U.exports.__esModule=!0,U.exports.default=U.exports},"./node_modules/fast-xml-parser/src/fxp.js":function(U,K,k){const R=k("./node_modules/fast-xml-parser/src/validator.js"),m=k("./node_modules/fast-xml-parser/src/xmlparser/XMLParser.js"),A=k("./node_modules/fast-xml-parser/src/xmlbuilder/json2xml.js");U.exports={XMLParser:m,XMLValidator:R,XMLBuilder:A}},"./node_modules/fast-xml-parser/src/ignoreAttributes.js":function(U,K){function k(R){return typeof R=="function"?R:Array.isArray(R)?m=>{for(const A of R)if(typeof A=="string"&&m===A||A instanceof RegExp&&A.test(m))return!0}:()=>!1}U.exports=k},"./node_modules/fast-xml-parser/src/util.js":function(U,K,k){const R=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",m=R+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040",A="["+R+"]["+m+"]*",w=new RegExp("^"+A+"$"),O=function(h,f){const S=[];let d=f.exec(h);for(;d;){const p=[];p.startIndex=f.lastIndex-d[0].length;const T=d.length;for(let E=0;E<T;E++)p.push(d[E]);S.push(p),d=f.exec(h)}return S},r=function(h){const f=w.exec(h);return!(f===null||typeof f>"u")};K.isExist=function(h){return typeof h<"u"},K.isEmptyObject=function(h){return Object.keys(h).length===0},K.merge=function(h,f,S){if(f){const d=Object.keys(f),p=d.length;for(let T=0;T<p;T++)S==="strict"?h[d[T]]=[f[d[T]]]:h[d[T]]=f[d[T]]}},K.getValue=function(h){return K.isExist(h)?h:""},K.isName=r,K.getAllMatches=O,K.nameRegexp=A},"./node_modules/fast-xml-parser/src/validator.js":function(U,K,k){const R=k("./node_modules/fast-xml-parser/src/util.js"),m={allowBooleanAttributes:!1,unpairedTags:[]};K.validate=function(c,a){a=Object.assign({},m,a);const b=[];let i=!1,n=!1;c[0]==="\uFEFF"&&(c=c.substr(1));for(let t=0;t<c.length;t++)if(c[t]==="<"&&c[t+1]==="?"){if(t+=2,t=w(c,t),t.err)return t}else if(c[t]==="<"){let s=t;if(t++,c[t]==="!"){t=O(c,t);continue}else{let l=!1;c[t]==="/"&&(l=!0,t++);let v="";for(;t<c.length&&c[t]!==">"&&c[t]!==" "&&c[t]!=="	"&&c[t]!==`
`&&c[t]!=="\r";t++)v+=c[t];if(v=v.trim(),v[v.length-1]==="/"&&(v=v.substring(0,v.length-1),t--),!N(v)){let H;return v.trim().length===0?H="Invalid space after '<'.":H="Tag '"+v+"' is an invalid name.",E("InvalidTag",H,D(c,t))}const M=f(c,t);if(M===!1)return E("InvalidAttr","Attributes for '"+v+"' have open quote.",D(c,t));let x=M.value;if(t=M.index,x[x.length-1]==="/"){const H=t-x.length;x=x.substring(0,x.length-1);const $=d(x,a);if($===!0)i=!0;else return E($.err.code,$.err.msg,D(c,H+$.err.line))}else if(l)if(M.tagClosed){if(x.trim().length>0)return E("InvalidTag","Closing tag '"+v+"' can't have attributes or invalid starting.",D(c,s));if(b.length===0)return E("InvalidTag","Closing tag '"+v+"' has not been opened.",D(c,s));{const H=b.pop();if(v!==H.tagName){let $=D(c,H.tagStartPos);return E("InvalidTag","Expected closing tag '"+H.tagName+"' (opened in line "+$.line+", col "+$.col+") instead of closing tag '"+v+"'.",D(c,s))}b.length==0&&(n=!0)}}else return E("InvalidTag","Closing tag '"+v+"' doesn't have proper closing.",D(c,t));else{const H=d(x,a);if(H!==!0)return E(H.err.code,H.err.msg,D(c,t-x.length+H.err.line));if(n===!0)return E("InvalidXml","Multiple possible root nodes found.",D(c,t));a.unpairedTags.indexOf(v)!==-1||b.push({tagName:v,tagStartPos:s}),i=!0}for(t++;t<c.length;t++)if(c[t]==="<")if(c[t+1]==="!"){t++,t=O(c,t);continue}else if(c[t+1]==="?"){if(t=w(c,++t),t.err)return t}else break;else if(c[t]==="&"){const H=T(c,t);if(H==-1)return E("InvalidChar","char '&' is not expected.",D(c,t));t=H}else if(n===!0&&!A(c[t]))return E("InvalidXml","Extra text at the end",D(c,t));c[t]==="<"&&t--}}else{if(A(c[t]))continue;return E("InvalidChar","char '"+c[t]+"' is not expected.",D(c,t))}if(i){if(b.length==1)return E("InvalidTag","Unclosed tag '"+b[0].tagName+"'.",D(c,b[0].tagStartPos));if(b.length>0)return E("InvalidXml","Invalid '"+JSON.stringify(b.map(t=>t.tagName),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1})}else return E("InvalidXml","Start tag expected.",1);return!0};function A(c){return c===" "||c==="	"||c===`
`||c==="\r"}function w(c,a){const b=a;for(;a<c.length;a++)if(c[a]=="?"||c[a]==" "){const i=c.substr(b,a-b);if(a>5&&i==="xml")return E("InvalidXml","XML declaration allowed only at the start of the document.",D(c,a));if(c[a]=="?"&&c[a+1]==">"){a++;break}else continue}return a}function O(c,a){if(c.length>a+5&&c[a+1]==="-"&&c[a+2]==="-"){for(a+=3;a<c.length;a++)if(c[a]==="-"&&c[a+1]==="-"&&c[a+2]===">"){a+=2;break}}else if(c.length>a+8&&c[a+1]==="D"&&c[a+2]==="O"&&c[a+3]==="C"&&c[a+4]==="T"&&c[a+5]==="Y"&&c[a+6]==="P"&&c[a+7]==="E"){let b=1;for(a+=8;a<c.length;a++)if(c[a]==="<")b++;else if(c[a]===">"&&(b--,b===0))break}else if(c.length>a+9&&c[a+1]==="["&&c[a+2]==="C"&&c[a+3]==="D"&&c[a+4]==="A"&&c[a+5]==="T"&&c[a+6]==="A"&&c[a+7]==="["){for(a+=8;a<c.length;a++)if(c[a]==="]"&&c[a+1]==="]"&&c[a+2]===">"){a+=2;break}}return a}const r='"',h="'";function f(c,a){let b="",i="",n=!1;for(;a<c.length;a++){if(c[a]===r||c[a]===h)i===""?i=c[a]:i!==c[a]||(i="");else if(c[a]===">"&&i===""){n=!0;break}b+=c[a]}return i!==""?!1:{value:b,index:a,tagClosed:n}}const S=new RegExp(`(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['"])(([\\s\\S])*?)\\5)?`,"g");function d(c,a){const b=R.getAllMatches(c,S),i={};for(let n=0;n<b.length;n++){if(b[n][1].length===0)return E("InvalidAttr","Attribute '"+b[n][2]+"' has no space in starting.",j(b[n]));if(b[n][3]!==void 0&&b[n][4]===void 0)return E("InvalidAttr","Attribute '"+b[n][2]+"' is without value.",j(b[n]));if(b[n][3]===void 0&&!a.allowBooleanAttributes)return E("InvalidAttr","boolean attribute '"+b[n][2]+"' is not allowed.",j(b[n]));const t=b[n][2];if(!L(t))return E("InvalidAttr","Attribute '"+t+"' is an invalid name.",j(b[n]));if(!i.hasOwnProperty(t))i[t]=1;else return E("InvalidAttr","Attribute '"+t+"' is repeated.",j(b[n]))}return!0}function p(c,a){let b=/\d/;for(c[a]==="x"&&(a++,b=/[\da-fA-F]/);a<c.length;a++){if(c[a]===";")return a;if(!c[a].match(b))break}return-1}function T(c,a){if(a++,c[a]===";")return-1;if(c[a]==="#")return a++,p(c,a);let b=0;for(;a<c.length;a++,b++)if(!(c[a].match(/\w/)&&b<20)){if(c[a]===";")break;return-1}return a}function E(c,a,b){return{err:{code:c,msg:a,line:b.line||b,col:b.col}}}function L(c){return R.isName(c)}function N(c){return R.isName(c)}function D(c,a){const b=c.substring(0,a).split(/\r?\n/);return{line:b.length,col:b[b.length-1].length+1}}function j(c){return c.startIndex+c[1].length}},"./node_modules/fast-xml-parser/src/xmlbuilder/json2xml.js":function(U,K,k){const R=k("./node_modules/fast-xml-parser/src/xmlbuilder/orderedJs2Xml.js"),m=k("./node_modules/fast-xml-parser/src/ignoreAttributes.js"),A={attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataPropName:!1,format:!1,indentBy:"  ",suppressEmptyNode:!1,suppressUnpairedNode:!0,suppressBooleanAttributes:!0,tagValueProcessor:function(f,S){return S},attributeValueProcessor:function(f,S){return S},preserveOrder:!1,commentPropName:!1,unpairedTags:[],entities:[{regex:new RegExp("&","g"),val:"&amp;"},{regex:new RegExp(">","g"),val:"&gt;"},{regex:new RegExp("<","g"),val:"&lt;"},{regex:new RegExp("'","g"),val:"&apos;"},{regex:new RegExp('"',"g"),val:"&quot;"}],processEntities:!0,stopNodes:[],oneListGroup:!1};function w(f){this.options=Object.assign({},A,f),this.options.ignoreAttributes===!0||this.options.attributesGroupName?this.isAttribute=function(){return!1}:(this.ignoreAttributesFn=m(this.options.ignoreAttributes),this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=h),this.processTextOrObjNode=O,this.options.format?(this.indentate=r,this.tagEndChar=`>
`,this.newLine=`
`):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine="")}w.prototype.build=function(f){return this.options.preserveOrder?R(f,this.options):(Array.isArray(f)&&this.options.arrayNodeName&&this.options.arrayNodeName.length>1&&(f={[this.options.arrayNodeName]:f}),this.j2x(f,0,[]).val)},w.prototype.j2x=function(f,S,d){let p="",T="";const E=d.join(".");for(let L in f)if(Object.prototype.hasOwnProperty.call(f,L))if(typeof f[L]>"u")this.isAttribute(L)&&(T+="");else if(f[L]===null)this.isAttribute(L)?T+="":L[0]==="?"?T+=this.indentate(S)+"<"+L+"?"+this.tagEndChar:T+=this.indentate(S)+"<"+L+"/"+this.tagEndChar;else if(f[L]instanceof Date)T+=this.buildTextValNode(f[L],L,"",S);else if(typeof f[L]!="object"){const N=this.isAttribute(L);if(N&&!this.ignoreAttributesFn(N,E))p+=this.buildAttrPairStr(N,""+f[L]);else if(!N)if(L===this.options.textNodeName){let D=this.options.tagValueProcessor(L,""+f[L]);T+=this.replaceEntitiesValue(D)}else T+=this.buildTextValNode(f[L],L,"",S)}else if(Array.isArray(f[L])){const N=f[L].length;let D="",j="";for(let c=0;c<N;c++){const a=f[L][c];if(!(typeof a>"u"))if(a===null)L[0]==="?"?T+=this.indentate(S)+"<"+L+"?"+this.tagEndChar:T+=this.indentate(S)+"<"+L+"/"+this.tagEndChar;else if(typeof a=="object")if(this.options.oneListGroup){const b=this.j2x(a,S+1,d.concat(L));D+=b.val,this.options.attributesGroupName&&a.hasOwnProperty(this.options.attributesGroupName)&&(j+=b.attrStr)}else D+=this.processTextOrObjNode(a,L,S,d);else if(this.options.oneListGroup){let b=this.options.tagValueProcessor(L,a);b=this.replaceEntitiesValue(b),D+=b}else D+=this.buildTextValNode(a,L,"",S)}this.options.oneListGroup&&(D=this.buildObjectNode(D,L,j,S)),T+=D}else if(this.options.attributesGroupName&&L===this.options.attributesGroupName){const N=Object.keys(f[L]),D=N.length;for(let j=0;j<D;j++)p+=this.buildAttrPairStr(N[j],""+f[L][N[j]])}else T+=this.processTextOrObjNode(f[L],L,S,d);return{attrStr:p,val:T}},w.prototype.buildAttrPairStr=function(f,S){return S=this.options.attributeValueProcessor(f,""+S),S=this.replaceEntitiesValue(S),this.options.suppressBooleanAttributes&&S==="true"?" "+f:" "+f+'="'+S+'"'};function O(f,S,d,p){const T=this.j2x(f,d+1,p.concat(S));return f[this.options.textNodeName]!==void 0&&Object.keys(f).length===1?this.buildTextValNode(f[this.options.textNodeName],S,T.attrStr,d):this.buildObjectNode(T.val,S,T.attrStr,d)}w.prototype.buildObjectNode=function(f,S,d,p){if(f==="")return S[0]==="?"?this.indentate(p)+"<"+S+d+"?"+this.tagEndChar:this.indentate(p)+"<"+S+d+this.closeTag(S)+this.tagEndChar;{let T="</"+S+this.tagEndChar,E="";return S[0]==="?"&&(E="?",T=""),(d||d==="")&&f.indexOf("<")===-1?this.indentate(p)+"<"+S+d+E+">"+f+T:this.options.commentPropName!==!1&&S===this.options.commentPropName&&E.length===0?this.indentate(p)+`<!--${f}-->`+this.newLine:this.indentate(p)+"<"+S+d+E+this.tagEndChar+f+this.indentate(p)+T}},w.prototype.closeTag=function(f){let S="";return this.options.unpairedTags.indexOf(f)!==-1?this.options.suppressUnpairedNode||(S="/"):this.options.suppressEmptyNode?S="/":S=`></${f}`,S},w.prototype.buildTextValNode=function(f,S,d,p){if(this.options.cdataPropName!==!1&&S===this.options.cdataPropName)return this.indentate(p)+`<![CDATA[${f}]]>`+this.newLine;if(this.options.commentPropName!==!1&&S===this.options.commentPropName)return this.indentate(p)+`<!--${f}-->`+this.newLine;if(S[0]==="?")return this.indentate(p)+"<"+S+d+"?"+this.tagEndChar;{let T=this.options.tagValueProcessor(S,f);return T=this.replaceEntitiesValue(T),T===""?this.indentate(p)+"<"+S+d+this.closeTag(S)+this.tagEndChar:this.indentate(p)+"<"+S+d+">"+T+"</"+S+this.tagEndChar}},w.prototype.replaceEntitiesValue=function(f){if(f&&f.length>0&&this.options.processEntities)for(let S=0;S<this.options.entities.length;S++){const d=this.options.entities[S];f=f.replace(d.regex,d.val)}return f};function r(f){return this.options.indentBy.repeat(f)}function h(f){return f.startsWith(this.options.attributeNamePrefix)&&f!==this.options.textNodeName?f.substr(this.attrPrefixLen):!1}U.exports=w},"./node_modules/fast-xml-parser/src/xmlbuilder/orderedJs2Xml.js":function(U,K){const k=`
`;function R(h,f){let S="";return f.format&&f.indentBy.length>0&&(S=k),m(h,f,"",S)}function m(h,f,S,d){let p="",T=!1;for(let E=0;E<h.length;E++){const L=h[E],N=A(L);if(N===void 0)continue;let D="";if(S.length===0?D=N:D=`${S}.${N}`,N===f.textNodeName){let i=L[N];O(D,f)||(i=f.tagValueProcessor(N,i),i=r(i,f)),T&&(p+=d),p+=i,T=!1;continue}else if(N===f.cdataPropName){T&&(p+=d),p+=`<![CDATA[${L[N][0][f.textNodeName]}]]>`,T=!1;continue}else if(N===f.commentPropName){p+=d+`<!--${L[N][0][f.textNodeName]}-->`,T=!0;continue}else if(N[0]==="?"){const i=w(L[":@"],f),n=N==="?xml"?"":d;let t=L[N][0][f.textNodeName];t=t.length!==0?" "+t:"",p+=n+`<${N}${t}${i}?>`,T=!0;continue}let j=d;j!==""&&(j+=f.indentBy);const c=w(L[":@"],f),a=d+`<${N}${c}`,b=m(L[N],f,D,j);f.unpairedTags.indexOf(N)!==-1?f.suppressUnpairedNode?p+=a+">":p+=a+"/>":(!b||b.length===0)&&f.suppressEmptyNode?p+=a+"/>":b&&b.endsWith(">")?p+=a+`>${b}${d}</${N}>`:(p+=a+">",b&&d!==""&&(b.includes("/>")||b.includes("</"))?p+=d+f.indentBy+b+d:p+=b,p+=`</${N}>`),T=!0}return p}function A(h){const f=Object.keys(h);for(let S=0;S<f.length;S++){const d=f[S];if(h.hasOwnProperty(d)&&d!==":@")return d}}function w(h,f){let S="";if(h&&!f.ignoreAttributes)for(let d in h){if(!h.hasOwnProperty(d))continue;let p=f.attributeValueProcessor(d,h[d]);p=r(p,f),p===!0&&f.suppressBooleanAttributes?S+=` ${d.substr(f.attributeNamePrefix.length)}`:S+=` ${d.substr(f.attributeNamePrefix.length)}="${p}"`}return S}function O(h,f){h=h.substr(0,h.length-f.textNodeName.length-1);let S=h.substr(h.lastIndexOf(".")+1);for(let d in f.stopNodes)if(f.stopNodes[d]===h||f.stopNodes[d]==="*."+S)return!0;return!1}function r(h,f){if(h&&h.length>0&&f.processEntities)for(let S=0;S<f.entities.length;S++){const d=f.entities[S];h=h.replace(d.regex,d.val)}return h}U.exports=R},"./node_modules/fast-xml-parser/src/xmlparser/DocTypeReader.js":function(U,K,k){const R=k("./node_modules/fast-xml-parser/src/util.js");function m(d,p){const T={};if(d[p+3]==="O"&&d[p+4]==="C"&&d[p+5]==="T"&&d[p+6]==="Y"&&d[p+7]==="P"&&d[p+8]==="E"){p=p+9;let E=1,L=!1,N=!1,D="";for(;p<d.length;p++)if(d[p]==="<"&&!N){if(L&&O(d,p))p+=7,[entityName,val,p]=A(d,p+1),val.indexOf("&")===-1&&(T[S(entityName)]={regx:RegExp(`&${entityName};`,"g"),val});else if(L&&r(d,p))p+=8;else if(L&&h(d,p))p+=8;else if(L&&f(d,p))p+=9;else if(w)N=!0;else throw new Error("Invalid DOCTYPE");E++,D=""}else if(d[p]===">"){if(N?d[p-1]==="-"&&d[p-2]==="-"&&(N=!1,E--):E--,E===0)break}else d[p]==="["?L=!0:D+=d[p];if(E!==0)throw new Error("Unclosed DOCTYPE")}else throw new Error("Invalid Tag instead of DOCTYPE");return{entities:T,i:p}}function A(d,p){let T="";for(;p<d.length&&d[p]!=="'"&&d[p]!=='"';p++)T+=d[p];if(T=T.trim(),T.indexOf(" ")!==-1)throw new Error("External entites are not supported");const E=d[p++];let L="";for(;p<d.length&&d[p]!==E;p++)L+=d[p];return[T,L,p]}function w(d,p){return d[p+1]==="!"&&d[p+2]==="-"&&d[p+3]==="-"}function O(d,p){return d[p+1]==="!"&&d[p+2]==="E"&&d[p+3]==="N"&&d[p+4]==="T"&&d[p+5]==="I"&&d[p+6]==="T"&&d[p+7]==="Y"}function r(d,p){return d[p+1]==="!"&&d[p+2]==="E"&&d[p+3]==="L"&&d[p+4]==="E"&&d[p+5]==="M"&&d[p+6]==="E"&&d[p+7]==="N"&&d[p+8]==="T"}function h(d,p){return d[p+1]==="!"&&d[p+2]==="A"&&d[p+3]==="T"&&d[p+4]==="T"&&d[p+5]==="L"&&d[p+6]==="I"&&d[p+7]==="S"&&d[p+8]==="T"}function f(d,p){return d[p+1]==="!"&&d[p+2]==="N"&&d[p+3]==="O"&&d[p+4]==="T"&&d[p+5]==="A"&&d[p+6]==="T"&&d[p+7]==="I"&&d[p+8]==="O"&&d[p+9]==="N"}function S(d){if(R.isName(d))return d;throw new Error(`Invalid entity name ${d}`)}U.exports=m},"./node_modules/fast-xml-parser/src/xmlparser/OptionsBuilder.js":function(U,K){const k={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0,eNotation:!0},tagValueProcessor:function(m,A){return A},attributeValueProcessor:function(m,A){return A},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1,transformTagName:!1,transformAttributeName:!1,updateTag:function(m,A,w){return m}},R=function(m){return Object.assign({},k,m)};K.buildOptions=R,K.defaultOptions=k},"./node_modules/fast-xml-parser/src/xmlparser/OrderedObjParser.js":function(U,K,k){const R=k("./node_modules/fast-xml-parser/src/util.js"),m=k("./node_modules/fast-xml-parser/src/xmlparser/xmlNode.js"),A=k("./node_modules/fast-xml-parser/src/xmlparser/DocTypeReader.js"),w=k("./node_modules/strnum/strnum.js"),O=k("./node_modules/fast-xml-parser/src/ignoreAttributes.js");class r{constructor(t){this.options=t,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.ampEntity={regex:/&(amp|#38|#x26);/g,val:"&"},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:"¢"},pound:{regex:/&(pound|#163);/g,val:"£"},yen:{regex:/&(yen|#165);/g,val:"¥"},euro:{regex:/&(euro|#8364);/g,val:"€"},copyright:{regex:/&(copy|#169);/g,val:"©"},reg:{regex:/&(reg|#174);/g,val:"®"},inr:{regex:/&(inr|#8377);/g,val:"₹"},num_dec:{regex:/&#([0-9]{1,7});/g,val:(s,l)=>String.fromCharCode(Number.parseInt(l,10))},num_hex:{regex:/&#x([0-9a-fA-F]{1,6});/g,val:(s,l)=>String.fromCharCode(Number.parseInt(l,16))}},this.addExternalEntities=h,this.parseXml=T,this.parseTextData=f,this.resolveNameSpace=S,this.buildAttributesMap=p,this.isItStopNode=D,this.replaceEntitiesValue=L,this.readStopNodeData=b,this.saveTextToParentTag=N,this.addChild=E,this.ignoreAttributesFn=O(this.options.ignoreAttributes)}}function h(n){const t=Object.keys(n);for(let s=0;s<t.length;s++){const l=t[s];this.lastEntities[l]={regex:new RegExp("&"+l+";","g"),val:n[l]}}}function f(n,t,s,l,v,M,x){if(n!==void 0&&(this.options.trimValues&&!l&&(n=n.trim()),n.length>0)){x||(n=this.replaceEntitiesValue(n));const H=this.options.tagValueProcessor(t,n,s,v,M);return H==null?n:typeof H!=typeof n||H!==n?H:this.options.trimValues?i(n,this.options.parseTagValue,this.options.numberParseOptions):n.trim()===n?i(n,this.options.parseTagValue,this.options.numberParseOptions):n}}function S(n){if(this.options.removeNSPrefix){const t=n.split(":"),s=n.charAt(0)==="/"?"/":"";if(t[0]==="xmlns")return"";t.length===2&&(n=s+t[1])}return n}const d=new RegExp(`([^\\s=]+)\\s*(=\\s*(['"])([\\s\\S]*?)\\3)?`,"gm");function p(n,t,s){if(this.options.ignoreAttributes!==!0&&typeof n=="string"){const l=R.getAllMatches(n,d),v=l.length,M={};for(let x=0;x<v;x++){const H=this.resolveNameSpace(l[x][1]);if(this.ignoreAttributesFn(H,t))continue;let $=l[x][4],Y=this.options.attributeNamePrefix+H;if(H.length)if(this.options.transformAttributeName&&(Y=this.options.transformAttributeName(Y)),Y==="__proto__"&&(Y="#__proto__"),$!==void 0){this.options.trimValues&&($=$.trim()),$=this.replaceEntitiesValue($);const ee=this.options.attributeValueProcessor(H,$,t);ee==null?M[Y]=$:typeof ee!=typeof $||ee!==$?M[Y]=ee:M[Y]=i($,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(M[Y]=!0)}if(!Object.keys(M).length)return;if(this.options.attributesGroupName){const x={};return x[this.options.attributesGroupName]=M,x}return M}}const T=function(n){const t=new m("!xml");let s=t,l="",v="";for(let M=0;M<n.length;M++)if(n[M]==="<")if(n[M+1]==="/"){const H=c(n,">",M,"Closing Tag is not closed.");let $=n.substring(M+2,H).trim();if(this.options.removeNSPrefix){const re=$.indexOf(":");re!==-1&&($=$.substr(re+1))}this.options.transformTagName&&($=this.options.transformTagName($)),s&&(l=this.saveTextToParentTag(l,s,v));const Y=v.substring(v.lastIndexOf(".")+1);if($&&this.options.unpairedTags.indexOf($)!==-1)throw new Error(`Unpaired tag can not be used as closing tag: </${$}>`);let ee=0;Y&&this.options.unpairedTags.indexOf(Y)!==-1?(ee=v.lastIndexOf(".",v.lastIndexOf(".")-1),this.tagsNodeStack.pop()):ee=v.lastIndexOf("."),v=v.substring(0,ee),s=this.tagsNodeStack.pop(),l="",M=H}else if(n[M+1]==="?"){let H=a(n,M,!1,"?>");if(!H)throw new Error("Pi Tag is not closed.");if(l=this.saveTextToParentTag(l,s,v),!(this.options.ignoreDeclaration&&H.tagName==="?xml"||this.options.ignorePiTags)){const $=new m(H.tagName);$.add(this.options.textNodeName,""),H.tagName!==H.tagExp&&H.attrExpPresent&&($[":@"]=this.buildAttributesMap(H.tagExp,v,H.tagName)),this.addChild(s,$,v)}M=H.closeIndex+1}else if(n.substr(M+1,3)==="!--"){const H=c(n,"-->",M+4,"Comment is not closed.");if(this.options.commentPropName){const $=n.substring(M+4,H-2);l=this.saveTextToParentTag(l,s,v),s.add(this.options.commentPropName,[{[this.options.textNodeName]:$}])}M=H}else if(n.substr(M+1,2)==="!D"){const H=A(n,M);this.docTypeEntities=H.entities,M=H.i}else if(n.substr(M+1,2)==="!["){const H=c(n,"]]>",M,"CDATA is not closed.")-2,$=n.substring(M+9,H);l=this.saveTextToParentTag(l,s,v);let Y=this.parseTextData($,s.tagname,v,!0,!1,!0,!0);Y==null&&(Y=""),this.options.cdataPropName?s.add(this.options.cdataPropName,[{[this.options.textNodeName]:$}]):s.add(this.options.textNodeName,Y),M=H+2}else{let H=a(n,M,this.options.removeNSPrefix),$=H.tagName;const Y=H.rawTagName;let ee=H.tagExp,re=H.attrExpPresent,ie=H.closeIndex;this.options.transformTagName&&($=this.options.transformTagName($)),s&&l&&s.tagname!=="!xml"&&(l=this.saveTextToParentTag(l,s,v,!1));const me=s;if(me&&this.options.unpairedTags.indexOf(me.tagname)!==-1&&(s=this.tagsNodeStack.pop(),v=v.substring(0,v.lastIndexOf("."))),$!==t.tagname&&(v+=v?"."+$:$),this.isItStopNode(this.options.stopNodes,v,$)){let de="";if(ee.length>0&&ee.lastIndexOf("/")===ee.length-1)$[$.length-1]==="/"?($=$.substr(0,$.length-1),v=v.substr(0,v.length-1),ee=$):ee=ee.substr(0,ee.length-1),M=H.closeIndex;else if(this.options.unpairedTags.indexOf($)!==-1)M=H.closeIndex;else{const ne=this.readStopNodeData(n,Y,ie+1);if(!ne)throw new Error(`Unexpected end of ${Y}`);M=ne.i,de=ne.tagContent}const le=new m($);$!==ee&&re&&(le[":@"]=this.buildAttributesMap(ee,v,$)),de&&(de=this.parseTextData(de,$,v,!0,re,!0,!0)),v=v.substr(0,v.lastIndexOf(".")),le.add(this.options.textNodeName,de),this.addChild(s,le,v)}else{if(ee.length>0&&ee.lastIndexOf("/")===ee.length-1){$[$.length-1]==="/"?($=$.substr(0,$.length-1),v=v.substr(0,v.length-1),ee=$):ee=ee.substr(0,ee.length-1),this.options.transformTagName&&($=this.options.transformTagName($));const de=new m($);$!==ee&&re&&(de[":@"]=this.buildAttributesMap(ee,v,$)),this.addChild(s,de,v),v=v.substr(0,v.lastIndexOf("."))}else{const de=new m($);this.tagsNodeStack.push(s),$!==ee&&re&&(de[":@"]=this.buildAttributesMap(ee,v,$)),this.addChild(s,de,v),s=de}l="",M=ie}}else l+=n[M];return t.child};function E(n,t,s){const l=this.options.updateTag(t.tagname,s,t[":@"]);l===!1||(typeof l=="string"&&(t.tagname=l),n.addChild(t))}const L=function(n){if(this.options.processEntities){for(let t in this.docTypeEntities){const s=this.docTypeEntities[t];n=n.replace(s.regx,s.val)}for(let t in this.lastEntities){const s=this.lastEntities[t];n=n.replace(s.regex,s.val)}if(this.options.htmlEntities)for(let t in this.htmlEntities){const s=this.htmlEntities[t];n=n.replace(s.regex,s.val)}n=n.replace(this.ampEntity.regex,this.ampEntity.val)}return n};function N(n,t,s,l){return n&&(l===void 0&&(l=Object.keys(t.child).length===0),n=this.parseTextData(n,t.tagname,s,!1,t[":@"]?Object.keys(t[":@"]).length!==0:!1,l),n!==void 0&&n!==""&&t.add(this.options.textNodeName,n),n=""),n}function D(n,t,s){const l="*."+s;for(const v in n){const M=n[v];if(l===M||t===M)return!0}return!1}function j(n,t,s=">"){let l,v="";for(let M=t;M<n.length;M++){let x=n[M];if(l)x===l&&(l="");else if(x==='"'||x==="'")l=x;else if(x===s[0])if(s[1]){if(n[M+1]===s[1])return{data:v,index:M}}else return{data:v,index:M};else x==="	"&&(x=" ");v+=x}}function c(n,t,s,l){const v=n.indexOf(t,s);if(v===-1)throw new Error(l);return v+t.length-1}function a(n,t,s,l=">"){const v=j(n,t+1,l);if(!v)return;let M=v.data;const x=v.index,H=M.search(/\s/);let $=M,Y=!0;H!==-1&&($=M.substring(0,H),M=M.substring(H+1).trimStart());const ee=$;if(s){const re=$.indexOf(":");re!==-1&&($=$.substr(re+1),Y=$!==v.data.substr(re+1))}return{tagName:$,tagExp:M,closeIndex:x,attrExpPresent:Y,rawTagName:ee}}function b(n,t,s){const l=s;let v=1;for(;s<n.length;s++)if(n[s]==="<")if(n[s+1]==="/"){const M=c(n,">",s,`${t} is not closed`);if(n.substring(s+2,M).trim()===t&&(v--,v===0))return{tagContent:n.substring(l,s),i:M};s=M}else if(n[s+1]==="?")s=c(n,"?>",s+1,"StopNode is not closed.");else if(n.substr(s+1,3)==="!--")s=c(n,"-->",s+3,"StopNode is not closed.");else if(n.substr(s+1,2)==="![")s=c(n,"]]>",s,"StopNode is not closed.")-2;else{const M=a(n,s,">");M&&((M&&M.tagName)===t&&M.tagExp[M.tagExp.length-1]!=="/"&&v++,s=M.closeIndex)}}function i(n,t,s){if(t&&typeof n=="string"){const l=n.trim();return l==="true"?!0:l==="false"?!1:w(n,s)}else return R.isExist(n)?n:""}U.exports=r},"./node_modules/fast-xml-parser/src/xmlparser/XMLParser.js":function(U,K,k){const{buildOptions:R}=k("./node_modules/fast-xml-parser/src/xmlparser/OptionsBuilder.js"),m=k("./node_modules/fast-xml-parser/src/xmlparser/OrderedObjParser.js"),{prettify:A}=k("./node_modules/fast-xml-parser/src/xmlparser/node2json.js"),w=k("./node_modules/fast-xml-parser/src/validator.js");class O{constructor(h){this.externalEntities={},this.options=R(h)}parse(h,f){if(typeof h!="string")if(h.toString)h=h.toString();else throw new Error("XML data is accepted in String or Bytes[] form.");if(f){f===!0&&(f={});const p=w.validate(h,f);if(p!==!0)throw Error(`${p.err.msg}:${p.err.line}:${p.err.col}`)}const S=new m(this.options);S.addExternalEntities(this.externalEntities);const d=S.parseXml(h);return this.options.preserveOrder||d===void 0?d:A(d,this.options)}addEntity(h,f){if(f.indexOf("&")!==-1)throw new Error("Entity value can't have '&'");if(h.indexOf("&")!==-1||h.indexOf(";")!==-1)throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");if(f==="&")throw new Error("An entity with value '&' is not permitted");this.externalEntities[h]=f}}U.exports=O},"./node_modules/fast-xml-parser/src/xmlparser/node2json.js":function(U,K,k){function R(r,h){return m(r,h)}function m(r,h,f){let S;const d={};for(let p=0;p<r.length;p++){const T=r[p],E=A(T);let L="";if(f===void 0?L=E:L=f+"."+E,E===h.textNodeName)S===void 0?S=T[E]:S+=""+T[E];else{if(E===void 0)continue;if(T[E]){let N=m(T[E],h,L);const D=O(N,h);T[":@"]?w(N,T[":@"],L,h):Object.keys(N).length===1&&N[h.textNodeName]!==void 0&&!h.alwaysCreateTextNode?N=N[h.textNodeName]:Object.keys(N).length===0&&(h.alwaysCreateTextNode?N[h.textNodeName]="":N=""),d[E]!==void 0&&d.hasOwnProperty(E)?(Array.isArray(d[E])||(d[E]=[d[E]]),d[E].push(N)):h.isArray(E,L,D)?d[E]=[N]:d[E]=N}}}return typeof S=="string"?S.length>0&&(d[h.textNodeName]=S):S!==void 0&&(d[h.textNodeName]=S),d}function A(r){const h=Object.keys(r);for(let f=0;f<h.length;f++){const S=h[f];if(S!==":@")return S}}function w(r,h,f,S){if(h){const d=Object.keys(h),p=d.length;for(let T=0;T<p;T++){const E=d[T];S.isArray(E,f+"."+E,!0,!0)?r[E]=[h[E]]:r[E]=h[E]}}}function O(r,h){const{textNodeName:f}=h,S=Object.keys(r).length;return!!(S===0||S===1&&(r[f]||typeof r[f]=="boolean"||r[f]===0))}K.prettify=R},"./node_modules/fast-xml-parser/src/xmlparser/xmlNode.js":function(U,K,k){class R{constructor(A){this.tagname=A,this.child=[],this[":@"]={}}add(A,w){A==="__proto__"&&(A="#__proto__"),this.child.push({[A]:w})}addChild(A){A.tagname==="__proto__"&&(A.tagname="#__proto__"),A[":@"]&&Object.keys(A[":@"]).length>0?this.child.push({[A.tagname]:A.child,":@":A[":@"]}):this.child.push({[A.tagname]:A.child})}}U.exports=R},"./node_modules/process/browser.js":function(U,K){var k=U.exports={},R,m;function A(){throw new Error("setTimeout has not been defined")}function w(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?R=setTimeout:R=A}catch{R=A}try{typeof clearTimeout=="function"?m=clearTimeout:m=w}catch{m=w}})();function O(N){if(R===setTimeout)return setTimeout(N,0);if((R===A||!R)&&setTimeout)return R=setTimeout,setTimeout(N,0);try{return R(N,0)}catch{try{return R.call(null,N,0)}catch{return R.call(this,N,0)}}}function r(N){if(m===clearTimeout)return clearTimeout(N);if((m===w||!m)&&clearTimeout)return m=clearTimeout,clearTimeout(N);try{return m(N)}catch{try{return m.call(null,N)}catch{return m.call(this,N)}}}var h=[],f=!1,S,d=-1;function p(){!f||!S||(f=!1,S.length?h=S.concat(h):d=-1,h.length&&T())}function T(){if(!f){var N=O(p);f=!0;for(var D=h.length;D;){for(S=h,h=[];++d<D;)S&&S[d].run();d=-1,D=h.length}S=null,f=!1,r(N)}}k.nextTick=function(N){var D=new Array(arguments.length-1);if(arguments.length>1)for(var j=1;j<arguments.length;j++)D[j-1]=arguments[j];h.push(new E(N,D)),h.length===1&&!f&&O(T)};function E(N,D){this.fun=N,this.array=D}E.prototype.run=function(){this.fun.apply(null,this.array)},k.title="browser",k.browser=!0,k.env={},k.argv=[],k.version="",k.versions={};function L(){}k.on=L,k.addListener=L,k.once=L,k.off=L,k.removeListener=L,k.removeAllListeners=L,k.emit=L,k.prependListener=L,k.prependOnceListener=L,k.listeners=function(N){return[]},k.binding=function(N){throw new Error("process.binding is not supported")},k.cwd=function(){return"/"},k.chdir=function(N){throw new Error("process.chdir is not supported")},k.umask=function(){return 0}},"./node_modules/strnum/strnum.js":function(U,K){const k=/^[-+]?0x[a-fA-F0-9]+$/,R=/^([\-\+])?(0*)([0-9]*(\.[0-9]*)?)$/,m={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};function A(r,h={}){if(h=Object.assign({},m,h),!r||typeof r!="string")return r;let f=r.trim();if(h.skipLike!==void 0&&h.skipLike.test(f))return r;if(r==="0")return 0;if(h.hex&&k.test(f))return O(f,16);if(f.search(/[eE]/)!==-1){const S=f.match(/^([-\+])?(0*)([0-9]*(\.[0-9]*)?[eE][-\+]?[0-9]+)$/);if(S){if(h.leadingZeros)f=(S[1]||"")+S[3];else if(!(S[2]==="0"&&S[3][0]==="."))return r;return h.eNotation?Number(f):r}else return r}else{const S=R.exec(f);if(S){const d=S[1],p=S[2];let T=w(S[3]);if(!h.leadingZeros&&p.length>0&&d&&f[2]!==".")return r;if(!h.leadingZeros&&p.length>0&&!d&&f[1]!==".")return r;if(h.leadingZeros&&p===r)return 0;{const E=Number(f),L=""+E;return L.search(/[eE]/)!==-1?h.eNotation?E:r:f.indexOf(".")!==-1?L==="0"&&T===""||L===T||d&&L==="-"+T?E:r:p?T===L||d+T===L?E:r:f===L||f===d+L?E:r}}else return r}}function w(r){return r&&r.indexOf(".")!==-1&&(r=r.replace(/0+$/,""),r==="."?r="0":r[0]==="."?r="0"+r:r[r.length-1]==="."&&(r=r.substr(0,r.length-1))),r}function O(r,h){if(parseInt)return parseInt(r,h);if(Number.parseInt)return Number.parseInt(r,h);if(window&&window.parseInt)return window.parseInt(r,h);throw new Error("parseInt, Number.parseInt, window.parseInt are not supported")}U.exports=A},"./node_modules/webpack/buildin/amd-options.js":function(U,K){(function(k){U.exports=k}).call(this,{})},"./node_modules/webpack/buildin/module.js":function(U,K){U.exports=function(k){return k.webpackPolyfill||(k.deprecate=function(){},k.paths=[],k.children||(k.children=[]),Object.defineProperty(k,"loaded",{enumerable:!0,get:function(){return k.l}}),Object.defineProperty(k,"id",{enumerable:!0,get:function(){return k.i}}),k.webpackPolyfill=1),k}},"./package.json":function(U){U.exports=JSON.parse('{"name":"cos-js-sdk-v5","version":"1.10.1","description":"JavaScript SDK for [腾讯云对象存储](https://cloud.tencent.com/product/cos)","main":"dist/cos-js-sdk-v5.js","types":"index.d.ts","scripts":{"prettier":"prettier --write src demo/demo.js demo/CIDemos/*.js test/test.js server/sts.js lib/request.js index.d.ts","server":"node server/sts.js","dev":"cross-env NODE_ENV=development webpack -w --mode=development","build":"cross-env NODE_ENV=production webpack --mode=production","cos-auth.min.js":"uglifyjs ./demo/common/cos-auth.js -o ./demo/common/cos-auth.min.js -c -m","test":"jest --runInBand --coverage","postinstall":"node scripts/patch-check.js"},"repository":{"type":"git","url":"git+https://github.com/tencentyun/cos-js-sdk-v5.git"},"keywords":[],"author":"carsonxu","license":"ISC","bugs":{"url":"https://github.com/tencentyun/cos-js-sdk-v5/issues"},"homepage":"https://github.com/tencentyun/cos-js-sdk-v5#readme","dependencies":{"fast-xml-parser":"4.5.0"},"devDependencies":{"@babel/core":"7.17.9","@babel/plugin-transform-runtime":"7.18.10","@babel/preset-env":"7.16.11","babel-loader":"8.2.5","body-parser":"^1.18.3","cross-env":"^5.2.0","express":"^4.16.4","jest":"29.7.0","jest-environment-jsdom":"29.7.0","patch-package":"^8.0.0","prettier":"^3.0.1","qcloud-cos-sts":"^3.0.2","request":"^2.87.0","terser-webpack-plugin":"4.2.3","uglifyjs":"^2.4.11","webpack":"4.46.0","webpack-cli":"4.10.0"}}')},"./src/advance.js":function(U,K,k){var R=k("./node_modules/@babel/runtime/helpers/typeof.js"),m=k("./src/session.js"),A=k("./src/async.js"),w=k("./src/event.js").EventProxy,O=k("./src/util.js"),r=k("./src/tracker.js");function h(i,n){var t=this,s=new w,l=i.TaskId,v=i.Bucket,M=i.Region,x=i.Key,H=i.Body,$=i.ChunkSize||i.SliceSize||t.options.ChunkSize,Y=i.AsyncLimit,ee=i.StorageClass,re=i.ServerSideEncryption,ie,me,de=i.onHashProgress,le=i.tracker;le&&le.setParams({chunkSize:$}),t.logger.info({cate:"PROCESS",tag:"upload",msg:"[key=".concat(i.Key,"] 分块上传开始")}),s.on("error",function(ne){if(t._isRunningTask(l))return i.UploadData.UploadId&&m.removeUsing(i.UploadData.UploadId),ne.UploadId=i.UploadData.UploadId||"",t.logger.error({cate:"RESULT",tag:"upload",msg:"[key=".concat(i.Key,"] 分块上传失败: ").concat(JSON.stringify(ne))}),n(ne)}),s.on("upload_complete",function(ne){var Q=O.extend({UploadId:i.UploadData.UploadId||""},ne);n(null,Q)}),s.on("upload_slice_complete",function(ne){var Q={};O.each(i.Headers,function(oe,ge){var he=ge.toLowerCase();(he.indexOf("x-cos-meta-")===0||["pic-operations","x-cos-callback","x-cos-callback-var","x-cos-return-body"].includes(he))&&(Q[ge]=oe)}),t.logger.info({cate:"PROCESS",tag:"upload",msg:"[key=".concat(i.Key,"] 开始完成分块请求")}),E.call(t,{Bucket:v,Region:M,Key:x,UploadId:ne.UploadId,SliceList:ne.SliceList,Headers:Q,tracker:le},function(oe,ge){if(t._isRunningTask(l)){if(m.removeUsing(ne.UploadId),oe)return me(null,!0),t.logger.error({cate:"RESULT",tag:"upload",msg:"[key=".concat(i.Key,"] 完成分块请求失败")}),s.emit("error",oe);m.removeUploadId.call(t,ne.UploadId),me({loaded:ie,total:ie},!0),t.logger.info({cate:"RESULT",tag:"upload",msg:"[key=".concat(i.Key,"] 完成分块请求成功")}),s.emit("upload_complete",ge)}})}),s.on("get_upload_data_finish",function(ne){var Q=m.getFileId(H,i.ChunkSize,v,x);Q&&m.saveUploadId.call(t,Q,ne.UploadId,t.options.UploadIdCacheLimit),m.setUsing(ne.UploadId),me(null,!0),t.logger.info({cate:"PROCESS",tag:"upload",msg:"[key=".concat(i.Key,"] 开始上传各个分块")}),p.call(t,{TaskId:l,Bucket:v,Region:M,Key:x,Body:H,FileSize:ie,SliceSize:$,AsyncLimit:Y,ServerSideEncryption:re,UploadData:ne,Headers:i.Headers,onProgress:me,tracker:le},function(oe,ge){if(t._isRunningTask(l)){if(oe)return me(null,!0),t.logger.error({cate:"PROCESS",tag:"upload",msg:"[key=".concat(i.Key,"] 分块上传失败")}),s.emit("error",oe);t.logger.info({cate:"PROCESS",tag:"upload",msg:"[key=".concat(i.Key,"] 所有分块上传完成")}),s.emit("upload_slice_complete",ge)}})}),s.on("get_file_size_finish",function(){if(me=O.throttleOnProgress.call(t,ie,i.onProgress),i.UploadData.UploadId)t.logger.info({cate:"PROCESS",tag:"upload",msg:"[key=".concat(i.Key,"] 已经获取到 uploadId, ").concat(i.UploadData.UploadId)}),s.emit("get_upload_data_finish",i.UploadData);else{var ne=O.extend({TaskId:l,Bucket:v,Region:M,Key:x,Headers:i.Headers,StorageClass:ee,Body:H,FileSize:ie,SliceSize:$,onHashProgress:de,tracker:le},i);t.logger.info({cate:"PROCESS",tag:"upload",msg:"[key=".concat(i.Key,"] 去获取 uploadId")}),f.call(t,ne,function(Q,oe){if(t._isRunningTask(l)){if(Q)return s.emit("error",Q);i.UploadData.UploadId=oe.UploadId,i.UploadData.PartList=oe.PartList,t.logger.info({cate:"PROCESS",tag:"upload",msg:"[key=".concat(i.Key,"] 获取到 uploadId, ").concat(i.UploadData.UploadId)}),s.emit("get_upload_data_finish",i.UploadData)}})}}),ie=i.ContentLength,delete i.ContentLength,!i.Headers&&(i.Headers={}),O.each(i.Headers,function(ne,Q){Q.toLowerCase()==="content-length"&&delete i.Headers[Q]}),function(){for(var ne=[1,2,4,8,16,32,64,128,256,512,1024,2048,4096,5120],Q=1024*1024,oe=0;oe<ne.length&&(Q=ne[oe]*1024*1024,!(ie/Q<=t.options.MaxPartNumber));oe++);i.ChunkSize=i.SliceSize=$=Math.max($,Q)}(),ie===0?(i.Body="",i.ContentLength=0,i.SkipTask=!0,t.logger.info({cate:"PROCESS",tag:"upload",msg:"[key=".concat(i.Key,"] 文件大小为 0，执行简单上传")}),t.putObject(i,n)):s.emit("get_file_size_finish")}function f(i,n){var t=i.TaskId,s=i.Bucket,l=i.Region,v=i.Key,M=i.StorageClass,x=this,H={},$=i.FileSize,Y=i.SliceSize,ee=Math.ceil($/Y),re=0,ie=O.throttleOnProgress.call(x,$,i.onHashProgress),me=function(Q,oe){var ge=Y*(Q-1),he=Math.min(ge+Y,$),se=he-ge;H[Q]?oe(null,{PartNumber:Q,ETag:H[Q],Size:se}):O.fileSlice(i.Body,ge,he,!1,function(ce){O.getFileMd5(ce,function(ye,Ce){if(ye)return oe(O.error(ye));var Se='"'+Ce+'"';H[Q]=Se,re+=se,ie({loaded:re,total:$}),oe(null,{PartNumber:Q,ETag:Se,Size:se})})})},de=function(Q,oe){var ge=Q.length;if(ge===0)return oe(null,!0);if(ge>ee)return oe(null,!1);if(ge>1){var he=Math.max(Q[0].Size,Q[1].Size);if(he!==Y)return oe(null,!1)}var se=function(ye){if(ye<ge){var Ce=Q[ye];me(Ce.PartNumber,function(Se,Oe){Oe&&Oe.ETag===Ce.ETag&&Oe.Size===Ce.Size?se(ye+1):oe(null,!1)})}else oe(null,!0)};se(0)},le=new w;le.on("error",function(ne){if(x._isRunningTask(t))return n(ne)}),le.on("upload_id_available",function(ne){var Q={},oe=[];O.each(ne.PartList,function(se){Q[se.PartNumber]=se});for(var ge=1;ge<=ee;ge++){var he=Q[ge];he?(he.PartNumber=ge,he.Uploaded=!0):he={PartNumber:ge,ETag:null,Uploaded:!1},oe.push(he)}ne.PartList=oe,n(null,ne)}),le.on("no_available_upload_id",function(){if(x._isRunningTask(t)){var ne=O.extend({Bucket:s,Region:l,Key:v,Query:O.clone(i.Query),StorageClass:M,Body:i.Body,calledBySdk:"sliceUploadFile",tracker:i.tracker},i),Q=O.clone(i.Headers);delete Q["x-cos-mime-limit"],ne.Headers=Q,x.logger.info({cate:"PROCESS",tag:"upload",msg:"[key=".concat(i.Key,"] 准备初始化分块上传")}),x.multipartInit(ne,function(oe,ge){if(x._isRunningTask(t)){if(oe)return x.logger.error({cate:"PROCESS",tag:"upload",msg:"[key=".concat(i.Key,"] 初始化分块上传失败, ").concat(JSON.stringify(oe))}),le.emit("error",oe);var he=ge.UploadId;if(!he)return n(O.error(new Error("no such upload id")));x.logger.info({cate:"PROCESS",tag:"upload",msg:"[key=".concat(i.Key,"] 初始化分块上传成功")}),le.emit("upload_id_available",{UploadId:he,PartList:[]})}})}}),le.on("has_and_check_upload_id",function(ne){ne=ne.reverse(),A.eachLimit(ne,1,function(Q,oe){if(x._isRunningTask(t)){if(m.using[Q]){oe();return}d.call(x,{Bucket:s,Region:l,Key:v,UploadId:Q,tracker:i.tracker},function(ge,he){if(x._isRunningTask(t)){if(ge)return m.removeUsing(Q),le.emit("error",ge);var se=he.PartList;se.forEach(function(ce){ce.PartNumber*=1,ce.Size*=1,ce.ETag=ce.ETag||""}),de(se,function(ce,ye){if(x._isRunningTask(t)){if(ce)return le.emit("error",ce);ye?oe({UploadId:Q,PartList:se}):oe()}})}})}},function(Q){x._isRunningTask(t)&&(ie(null,!0),Q&&Q.UploadId?le.emit("upload_id_available",Q):le.emit("no_available_upload_id"))})}),le.on("seek_local_avail_upload_id",function(ne){var Q=m.getFileId(i.Body,i.ChunkSize,s,v),oe=m.getUploadIdList.call(x,Q);if(!Q||!oe){le.emit("has_and_check_upload_id",ne);return}var ge=function(se){if(se>=oe.length){le.emit("has_and_check_upload_id",ne);return}var ce=oe[se];if(!O.isInArray(ne,ce)){m.removeUploadId.call(x,ce),ge(se+1);return}if(m.using[ce]){ge(se+1);return}d.call(x,{Bucket:s,Region:l,Key:v,UploadId:ce,tracker:i.tracker},function(ye,Ce){x._isRunningTask(t)&&(ye?(m.removeUploadId.call(x,ce),ge(se+1)):le.emit("upload_id_available",{UploadId:ce,PartList:Ce.PartList}))})};ge(0)}),le.on("get_remote_upload_id_list",function(){S.call(x,{Bucket:s,Region:l,Key:v,tracker:i.tracker},function(ne,Q){if(x._isRunningTask(t)){if(ne)return le.emit("error",ne);var oe=O.filter(Q.UploadList,function(se){return se.Key===v&&(!M||se.StorageClass.toUpperCase()===M.toUpperCase())}).reverse().map(function(se){return se.UploadId||se.UploadID});if(oe.length)le.emit("seek_local_avail_upload_id",oe);else{var ge=m.getFileId(i.Body,i.ChunkSize,s,v),he;ge&&(he=m.getUploadIdList.call(x,ge))&&O.each(he,function(se){m.removeUploadId.call(x,se)}),le.emit("no_available_upload_id")}}})}),le.emit("get_remote_upload_id_list")}function S(i,n){var t=this,s=[],l={Bucket:i.Bucket,Region:i.Region,Prefix:i.Key,calledBySdk:i.calledBySdk||"sliceUploadFile",tracker:i.tracker},v=function(){t.multipartList(l,function(x,H){if(x)return n(x);s.push.apply(s,H.Upload||[]),H.IsTruncated==="true"?(l.KeyMarker=H.NextKeyMarker,l.UploadIdMarker=H.NextUploadIdMarker,v()):n(null,{UploadList:s})})};v()}function d(i,n){var t=this,s=[],l={Bucket:i.Bucket,Region:i.Region,Key:i.Key,UploadId:i.UploadId,calledBySdk:"sliceUploadFile",tracker:i.tracker},v=function(){t.multipartListPart(l,function(x,H){if(x)return n(x);s.push.apply(s,H.Part||[]),H.IsTruncated==="true"?(l.PartNumberMarker=H.NextPartNumberMarker,v()):n(null,{PartList:s})})};v()}function p(i,n){var t=this,s=i.TaskId,l=i.Bucket,v=i.Region,M=i.Key,x=i.UploadData,H=i.FileSize,$=i.SliceSize,Y=Math.min(i.AsyncLimit||t.options.ChunkParallelLimit||1,256),ee=i.Body,re=Math.ceil(H/$),ie=0,me=i.ServerSideEncryption,de=i.Headers,le=O.filter(x.PartList,function(Q){return Q.Uploaded&&(ie+=Q.PartNumber>=re&&H%$||$),!Q.Uploaded}),ne=i.onProgress;t.logger.info({cate:"PROCESS",tag:"upload",msg:"[key=".concat(i.Key,"] 开始并发上传各个分块")}),A.eachLimit(le,Y,function(Q,oe){if(t._isRunningTask(s)){var ge=Q.PartNumber,he=Math.min(H,Q.PartNumber*$)-(Q.PartNumber-1)*$,se=0;t.logger.info({cate:"PROCESS",tag:"upload",msg:"[key=".concat(i.Key,"] 分块").concat(ge,"开始上传")}),T.call(t,{TaskId:s,Bucket:l,Region:v,Key:M,SliceSize:$,FileSize:H,PartNumber:ge,ServerSideEncryption:me,Body:ee,UploadData:x,Headers:de,onProgress:function(ye){ie+=ye.loaded-se,se=ye.loaded,ne({loaded:ie,total:H})},tracker:i.tracker},function(ce,ye){t._isRunningTask(s)&&(!ce&&!ye.ETag&&(ce='get ETag error, please add "ETag" to CORS ExposeHeader setting.( 获取ETag失败，请在CORS ExposeHeader设置中添加ETag，请参考文档：https://cloud.tencent.com/document/product/436/13318 )',t.logger.error({cate:"PROCESS",tag:"upload",msg:"[key=".concat(i.Key,"] 分块").concat(ge,"上传请求成功，但是未获取到 eTag")})),ce?(ie-=se,t.logger.info({cate:"RESULT",tag:"upload",msg:"[key=".concat(i.Key,"] 分块").concat(ge,"上传失败")})):(ie+=he-se,Q.ETag=ye.ETag),t.logger.info({cate:"RESULT",tag:"upload",msg:"[key=".concat(i.Key,"] 分块").concat(ge,"上传成功")}),ne({loaded:ie,total:H}),oe(ce||null,ye))})}},function(Q){if(t._isRunningTask(s)){if(Q)return n(Q);n(null,{UploadId:x.UploadId,SliceList:x.PartList})}})}function T(i,n){var t=this,s=i.TaskId,l=i.Bucket,v=i.Region,M=i.Key,x=i.FileSize,H=i.Body,$=i.PartNumber*1,Y=i.SliceSize,ee=i.ServerSideEncryption,re=i.UploadData,ie=i.Headers||{},me=t.options.ChunkRetryTimes+1,de=Y*($-1),le=Y,ne=de+Y;ne>x&&(ne=x,le=ne-de);var Q=["x-cos-traffic-limit","x-cos-mime-limit"],oe={};O.each(ie,function(he,se){Q.indexOf(se)>-1&&(oe[se]=he)});var ge=re.PartList[$-1];A.retry(me,function(he){t._isRunningTask(s)&&O.fileSlice(H,de,ne,!0,function(se){t.multipartUpload({TaskId:s,Bucket:l,Region:v,Key:M,ContentLength:le,PartNumber:$,UploadId:re.UploadId,ServerSideEncryption:ee,Body:se,Headers:oe,onProgress:i.onProgress,calledBySdk:"sliceUploadFile",tracker:i.tracker},function(ce,ye){if(t._isRunningTask(s))return ce?he(ce):(ge.Uploaded=!0,he(null,ye))})})},function(he,se){if(t._isRunningTask(s))return n(he,se)})}function E(i,n){var t=i.Bucket,s=i.Region,l=i.Key,v=i.UploadId,M=i.SliceList,x=this,H=this.options.ChunkRetryTimes+1,$=i.Headers,Y=M.map(function(ee){return{PartNumber:ee.PartNumber,ETag:ee.ETag}});A.retry(H,function(ee){x.multipartComplete({Bucket:t,Region:s,Key:l,UploadId:v,Parts:Y,Headers:$,calledBySdk:"sliceUploadFile",tracker:i.tracker},ee)},function(ee,re){n(ee,re)})}function L(i,n){var t=i.Bucket,s=i.Region,l=i.Key,v=i.UploadId,M=i.Level||"task",x=i.AsyncLimit,H=this,$=new w;if($.on("error",function(Y){return n(Y)}),$.on("get_abort_array",function(Y){N.call(H,{Bucket:t,Region:s,Key:l,Headers:i.Headers,AsyncLimit:x,AbortArray:Y},n)}),M==="bucket")S.call(H,{Bucket:t,Region:s,calledBySdk:"abortUploadTask"},function(Y,ee){if(Y)return n(Y);$.emit("get_abort_array",ee.UploadList||[])});else if(M==="file"){if(!l)return n(O.error(new Error("abort_upload_task_no_key")));S.call(H,{Bucket:t,Region:s,Key:l,calledBySdk:"abortUploadTask"},function(Y,ee){if(Y)return n(Y);$.emit("get_abort_array",ee.UploadList||[])})}else if(M==="task"){if(!v)return n(O.error(new Error("abort_upload_task_no_id")));if(!l)return n(O.error(new Error("abort_upload_task_no_key")));$.emit("get_abort_array",[{Key:l,UploadId:v}])}else return n(O.error(new Error("abort_unknown_level")))}function N(i,n){var t=i.Bucket,s=i.Region,l=i.Key,v=i.AbortArray,M=i.AsyncLimit||1,x=this,H=0,$=new Array(v.length);A.eachLimit(v,M,function(Y,ee){var re=H;if(l&&l!==Y.Key){$[re]={error:{KeyNotMatch:!0}},ee(null);return}var ie=Y.UploadId||Y.UploadID;x.multipartAbort({Bucket:t,Region:s,Key:Y.Key,Headers:i.Headers,UploadId:ie},function(me){var de={Bucket:t,Region:s,Key:Y.Key,UploadId:ie};$[re]={error:me,task:de},ee(null)}),H++},function(Y){if(Y)return n(Y);for(var ee=[],re=[],ie=0,me=$.length;ie<me;ie++){var de=$[ie];de.task&&(de.error?re.push(de.task):ee.push(de.task))}return n(null,{successList:ee,errorList:re})})}function D(i,n){var t=this,s=i.SliceSize===void 0?t.options.SliceSize:i.SliceSize,l=[],v=i.Body,M=v.size||v.length||0,x={TaskId:""};if(t.options.EnableReporter){var H=t.options.UseAccelerate||typeof t.options.Domain=="string"&&t.options.Domain.includes("accelerate."),$=M>s?"sliceUploadFile":"putObject";i.tracker=new r({Beacon:t.options.BeaconReporter,clsReporter:t.options.ClsReporter,bucket:i.Bucket,region:i.Region,apiName:"uploadFile",realApi:$,fileKey:i.Key,fileSize:M,accelerate:H,deepTracker:t.options.DeepTracker,customId:t.options.CustomId,delay:t.options.TrackerDelay})}O.each(i,function(de,le){R(de)!=="object"&&typeof de!="function"&&(x[le]=de)});var Y=i.onTaskReady,ee=function(le){x.TaskId=le,Y&&Y(le)};i.onTaskReady=ee;var re=M>s?"sliceUploadFile":"putObject",ie=i.onFileFinish,me=function(le,ne){i.tracker&&i.tracker.report(le,ne),ie&&ie(le,ne,x),n&&n(le,ne)};l.push({api:re,params:i,callback:me}),t._addTasks(l)}function j(i,n){var t=this,s=i.SliceSize===void 0?t.options.SliceSize:i.SliceSize,l=0,v=0,M=O.throttleOnProgress.call(t,v,i.onProgress),x=i.files.length,H=i.onFileFinish,$=Array(x),Y=function(ie,me,de){M(null,!0),H&&H(ie,me,de),$[de.Index]={options:de,error:ie,data:me},--x<=0&&n&&n(null,{files:$})},ee=[];O.each(i.files,function(re,ie){(function(){var me=re.Body,de=me.size||me.length||0,le={Index:ie,TaskId:""};if(!t.options.UseRawKey&&re.Key&&re.Key.substr(0,1)==="/"&&(re.Key=re.Key.substr(1)),l+=de,t.options.EnableReporter){var ne=t.options.UseAccelerate||typeof t.options.Domain=="string"&&t.options.Domain.includes("accelerate."),Q=de>s?"sliceUploadFile":"putObject";re.tracker=new r({Beacon:t.options.BeaconReporter,clsReporter:t.options.ClsReporter,bucket:re.Bucket,region:re.Region,apiName:"uploadFiles",realApi:Q,fileKey:re.Key,fileSize:de,accelerate:ne,deepTracker:t.options.DeepTracker,customId:t.options.CustomId,delay:t.options.TrackerDelay})}O.each(re,function(Oe,xe){R(Oe)!=="object"&&typeof Oe!="function"&&(le[xe]=Oe)});var oe=re.onTaskReady,ge=function(xe){le.TaskId=xe,oe&&oe(xe)};re.onTaskReady=ge;var he=0,se=re.onProgress,ce=function(xe){v=v-he+xe.loaded,he=xe.loaded,se&&se(xe),M({loaded:v,total:l})};re.onProgress=ce;var ye=de>s?"sliceUploadFile":"putObject",Ce=re.onFileFinish,Se=function(xe,Ne){re.tracker&&re.tracker.report(xe,Ne),Ce&&Ce(xe,Ne),Y&&Y(xe,Ne,le)};ee.push({api:ye,params:re,callback:Se})})()}),t._addTasks(ee)}function c(i,n){var t=new w,s=this,l=i.Bucket,v=i.Region,M=i.Key,x=i.CopySource,H=O.getSourceParams.call(this,x);if(!H){n(O.error(new Error("CopySource format error")));return}var $=H.Bucket,Y=H.Region,ee=decodeURIComponent(H.Key),re=i.CopySliceSize===void 0?s.options.CopySliceSize:i.CopySliceSize;re=Math.max(0,re);var ie=i.CopyChunkSize||this.options.CopyChunkSize,me=this.options.CopyChunkParallelLimit,de=this.options.ChunkRetryTimes+1,le=0,ne=0,Q,oe,ge={},he={},se={};t.on("copy_slice_complete",function(ce){O.each(i.Headers,function(Ce,Se){Se.toLowerCase().indexOf("x-cos-meta-")});var ye=O.map(ce.PartList,function(Ce){return{PartNumber:Ce.PartNumber,ETag:Ce.ETag}});A.retry(de,function(Ce){s.multipartComplete({Bucket:l,Region:v,Key:M,UploadId:ce.UploadId,Parts:ye,tracker:i.tracker,calledBySdk:"sliceCopyFile"},Ce)},function(Ce,Se){if(m.removeUsing(ce.UploadId),Ce)return oe(null,!0),n(Ce);m.removeUploadId(ce.UploadId),oe({loaded:Q,total:Q},!0),n(null,Se)})}),t.on("get_copy_data_finish",function(ce){var ye=m.getCopyFileId(x,ge,ie,l,M);ye&&m.saveUploadId(ye,ce.UploadId,s.options.UploadIdCacheLimit),m.setUsing(ce.UploadId);var Ce=O.filter(ce.PartList,function(Se){return Se.Uploaded&&(ne+=Se.PartNumber>=le&&Q%ie||ie),!Se.Uploaded});A.eachLimit(Ce,me,function(Se,Oe){var xe=Se.PartNumber,Ne=Se.CopySourceRange,et=Se.end-Se.start;A.retry(de,function(qe){a.call(s,{Bucket:l,Region:v,Key:M,CopySource:x,UploadId:ce.UploadId,PartNumber:xe,CopySourceRange:Ne,tracker:i.tracker,calledBySdk:"sliceCopyFile"},qe)},function(qe,rt){if(qe)return Oe(qe);ne+=et,oe({loaded:ne,total:Q}),Se.ETag=rt.ETag,Oe(qe||null,rt)})},function(Se){if(Se)return m.removeUsing(ce.UploadId),oe(null,!0),n(Se);t.emit("copy_slice_complete",ce)})}),t.on("get_chunk_size_finish",function(){var ce=function(){s.multipartInit({Bucket:l,Region:v,Key:M,Headers:se,tracker:i.tracker,calledBySdk:"sliceCopyFile"},function(xe,Ne){if(xe)return n(xe);i.UploadId=Ne.UploadId,t.emit("get_copy_data_finish",{UploadId:i.UploadId,PartList:i.PartList})})},ye=m.getCopyFileId(x,ge,ie,l,M),Ce=m.getUploadIdList(ye);if(!ye||!Ce)return ce();var Se=function(xe){if(xe>=Ce.length)return ce();var Ne=Ce[xe];if(m.using[Ne])return Se(xe+1);d.call(s,{Bucket:l,Region:v,Key:M,UploadId:Ne,tracker:i.tracker,calledBySdk:"sliceCopyFile"},function(et,qe){if(et)m.removeUploadId(Ne),Se(xe+1);else{if(m.using[Ne])return Se(xe+1);var rt={},at=0;O.each(qe.PartList,function(Ge){var ot=parseInt(Ge.Size),vt=at+ot-1;rt[Ge.PartNumber+"|"+at+"|"+vt]=Ge.ETag,at+=ot}),O.each(i.PartList,function(Ge){var ot=rt[Ge.PartNumber+"|"+Ge.start+"|"+Ge.end];ot&&(Ge.ETag=ot,Ge.Uploaded=!0)}),t.emit("get_copy_data_finish",{UploadId:Ne,PartList:i.PartList})}})};Se(0)}),t.on("get_file_size_finish",function(){if(function(){for(var ye=[1,2,4,8,16,32,64,128,256,512,1024,2048,4096,5120],Ce=1024*1024,Se=0;Se<ye.length&&(Ce=ye[Se]*1024*1024,!(Q/Ce<=s.options.MaxPartNumber));Se++);i.ChunkSize=ie=Math.max(ie,Ce),le=Math.ceil(Q/ie);for(var Oe=[],xe=1;xe<=le;xe++){var Ne=(xe-1)*ie,et=xe*ie<Q?xe*ie-1:Q-1,qe={PartNumber:xe,start:Ne,end:et,CopySourceRange:"bytes="+Ne+"-"+et};Oe.push(qe)}i.PartList=Oe}(),i.Headers["x-cos-metadata-directive"]==="Replaced"?se=i.Headers:se=he,se["x-cos-storage-class"]=i.Headers["x-cos-storage-class"]||he["x-cos-storage-class"],se=O.clearKey(se),he["x-cos-storage-class"]==="ARCHIVE"||he["x-cos-storage-class"]==="DEEP_ARCHIVE"){var ce=he["x-cos-restore"];if(!ce||ce==='ongoing-request="true"'){n(O.error(new Error("Unrestored archive object is not allowed to be copied")));return}}delete se["x-cos-copy-source"],delete se["x-cos-metadata-directive"],delete se["x-cos-copy-source-If-Modified-Since"],delete se["x-cos-copy-source-If-Unmodified-Since"],delete se["x-cos-copy-source-If-Match"],delete se["x-cos-copy-source-If-None-Match"],t.emit("get_chunk_size_finish")}),s.headObject({Bucket:$,Region:Y,Key:ee,tracker:i.tracker,calledBySdk:"sliceCopyFile"},function(ce,ye){if(ce){ce.statusCode&&ce.statusCode===404?n(O.error(ce,{ErrorStatus:ee+" Not Exist"})):n(ce);return}if(Q=i.FileSize=ye.headers["content-length"],Q===void 0||!Q){n(O.error(new Error('get Content-Length error, please add "Content-Length" to CORS ExposeHeader setting.（ 获取Content-Length失败，请在CORS ExposeHeader设置中添加Content-Length，请参考文档：https://cloud.tencent.com/document/product/436/13318 ）')));return}if(i.tracker&&i.tracker.setParams({httpSize:Q}),oe=O.throttleOnProgress.call(s,Q,i.onProgress),Q<=re)i.Headers["x-cos-metadata-directive"]||(i.Headers["x-cos-metadata-directive"]="Copy"),s.putObjectCopy(Object.assign(i,{calledBySdk:"sliceCopyFile"}),function(Se,Oe){if(Se)return oe(null,!0),n(Se);oe({loaded:Q,total:Q},!0),n(Se,Oe)});else{var Ce=ye.headers;ge=Ce,he={"Cache-Control":Ce["cache-control"],"Content-Disposition":Ce["content-disposition"],"Content-Encoding":Ce["content-encoding"],"Content-Type":Ce["content-type"],Expires:Ce.expires,"x-cos-storage-class":Ce["x-cos-storage-class"]},O.each(Ce,function(Se,Oe){var xe="x-cos-meta-";Oe.indexOf(xe)===0&&Oe.length>xe.length&&(he[Oe]=Se)}),t.emit("get_file_size_finish")}})}function a(i,n){var t=i.TaskId,s=i.Bucket,l=i.Region,v=i.Key,M=i.CopySource,x=i.UploadId,H=i.PartNumber*1,$=i.CopySourceRange,Y=this.options.ChunkRetryTimes+1,ee=this;A.retry(Y,function(re){ee.uploadPartCopy({TaskId:t,Bucket:s,Region:l,Key:v,CopySource:M,UploadId:x,PartNumber:H,CopySourceRange:$,tracker:i.tracker,calledBySdk:i.calledBySdk},function(ie,me){re(ie||null,me)})},function(re,ie){return n(re,ie)})}var b={sliceUploadFile:h,abortUploadTask:L,uploadFile:D,uploadFiles:j,sliceCopyFile:c};U.exports.init=function(i,n){n.transferToTaskMethod(b,"sliceUploadFile"),O.each(b,function(t,s){i.prototype[s]=O.apiWrapper(s,t)})}},"./src/async.js":function(U,K){var k=function(w,O,r,h){if(h=h||function(){},!w.length||O<=0)return h();var f=0,S=0,d=0;(function p(){if(f>=w.length)return h();for(;d<O&&S<w.length;)S+=1,d+=1,r(w[S-1],function(T){T?(h(T),h=function(){}):(f+=1,d-=1,f>=w.length?h():p())})})()},R=function(w,O,r){var h=function(S){O(function(d,p){d&&S<w?h(S+1):r(d,p)})};w<1?r():h(1)},m={eachLimit:k,retry:R};U.exports=m},"./src/base.js":function(U,K,k){var R=k("./node_modules/@babel/runtime/helpers/defineProperty.js"),m=k("./node_modules/@babel/runtime/helpers/typeof.js");function A(e,g){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);g&&(u=u.filter(function(C){return Object.getOwnPropertyDescriptor(e,C).enumerable})),o.push.apply(o,u)}return o}function w(e){for(var g=1;g<arguments.length;g++){var o=arguments[g]!=null?arguments[g]:{};g%2?A(Object(o),!0).forEach(function(u){R(e,u,o[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):A(Object(o)).forEach(function(u){Object.defineProperty(e,u,Object.getOwnPropertyDescriptor(o,u))})}return e}var O=k("./lib/request.js"),r=k("./src/util.js");function h(e,g){var o=this.options.Protocol||(r.isBrowser&&(typeof location>"u"?"undefined":m(location))==="object"&&location.protocol==="http:"?"http:":"https:"),u=this.options.ServiceDomain,C=e.AppId||this.options.appId,y=e.Region;u?(u=u.replace(/\{\{AppId\}\}/gi,C||"").replace(/\{\{Region\}\}/gi,y||"").replace(/\{\{.*?\}\}/gi,""),/^[a-zA-Z]+:\/\//.test(u)||(u=o+"//"+u),u.slice(-1)==="/"&&(u=u.slice(0,-1))):y?u=o+"//cos."+y+".myqcloud.com":u=o+"//service.cos.myqcloud.com";var P="",F=y?"cos."+y+".myqcloud.com":"service.cos.myqcloud.com",q=u.replace(/^https?:\/\/([^/]+)(\/.*)?$/,"$1");F===q&&(P=F),te.call(this,{Action:"name/cos:GetService",url:u,method:"GET",headers:e.Headers,SignHost:P,tracker:e.tracker},function(fe,ue){if(fe)return g(fe);var Re=ue&&ue.ListAllMyBucketsResult&&ue.ListAllMyBucketsResult.Buckets&&ue.ListAllMyBucketsResult.Buckets.Bucket||[];Re=r.isArray(Re)?Re:[Re];var J=ue&&ue.ListAllMyBucketsResult&&ue.ListAllMyBucketsResult.Owner||{};g(null,{Buckets:Re,Owner:J,statusCode:ue.statusCode,headers:ue.headers})})}function f(e,g){var o=this,u="";if(e.BucketAZConfig){var C={BucketAZConfig:e.BucketAZConfig};u=r.json2xml({CreateBucketConfiguration:C})}te.call(this,{Action:"name/cos:PutBucket",method:"PUT",Bucket:e.Bucket,Region:e.Region,headers:e.Headers,body:u,tracker:e.tracker},function(y,P){if(y)return g(y);var F=Xe({protocol:o.options.Protocol,domain:o.options.Domain,bucket:e.Bucket,region:e.Region,isLocation:!0});g(null,{Location:F,statusCode:P.statusCode,headers:P.headers})})}function S(e,g){te.call(this,{Action:"name/cos:HeadBucket",Bucket:e.Bucket,Region:e.Region,headers:e.Headers,method:"HEAD",tracker:e.tracker},g)}function d(e,g){var o={};o.prefix=e.Prefix||"",o.delimiter=e.Delimiter,o.marker=e.Marker,o["max-keys"]=e.MaxKeys,o["encoding-type"]=e.EncodingType,te.call(this,{Action:"name/cos:GetBucket",ResourceKey:o.prefix,method:"GET",Bucket:e.Bucket,Region:e.Region,headers:e.Headers,qs:o,tracker:e.tracker},function(u,C){if(u)return g(u);var y=C.ListBucketResult||{},P=y.Contents||[],F=y.CommonPrefixes||[];P=r.isArray(P)?P:[P],F=r.isArray(F)?F:[F];var q=r.clone(y);r.extend(q,{Contents:P,CommonPrefixes:F,statusCode:C.statusCode,headers:C.headers}),g(null,q)})}function p(e,g){te.call(this,{Action:"name/cos:DeleteBucket",Bucket:e.Bucket,Region:e.Region,headers:e.Headers,method:"DELETE",tracker:e.tracker},function(o,u){if(o&&o.statusCode===204)return g(null,{statusCode:o.statusCode});if(o)return g(o);g(null,{statusCode:u.statusCode,headers:u.headers})})}function T(e,g){var o=e.Headers,u="";if(e.AccessControlPolicy){var C=r.clone(e.AccessControlPolicy||{}),y=C.Grants||C.Grant;y=r.isArray(y)?y:[y],delete C.Grant,delete C.Grants,C.AccessControlList={Grant:y},u=r.json2xml({AccessControlPolicy:C}),o["Content-Type"]="application/xml",o["Content-MD5"]=r.b64(r.md5(u))}r.each(o,function(P,F){F.indexOf("x-cos-grant-")===0&&(o[F]=tt(o[F]))}),te.call(this,{Action:"name/cos:PutBucketACL",method:"PUT",Bucket:e.Bucket,Region:e.Region,headers:o,action:"acl",body:u,tracker:e.tracker},function(P,F){if(P)return g(P);g(null,{statusCode:F.statusCode,headers:F.headers})})}function E(e,g){te.call(this,{Action:"name/cos:GetBucketACL",method:"GET",Bucket:e.Bucket,Region:e.Region,headers:e.Headers,action:"acl",tracker:e.tracker},function(o,u){if(o)return g(o);var C=u.AccessControlPolicy||{},y=C.Owner||{},P=C.AccessControlList.Grant||[];P=r.isArray(P)?P:[P];var F=we(C);u.headers&&u.headers["x-cos-acl"]&&(F.ACL=u.headers["x-cos-acl"]),F=r.extend(F,{Owner:y,Grants:P,statusCode:u.statusCode,headers:u.headers}),g(null,F)})}function L(e,g){var o=e.CORSConfiguration||{},u=o.CORSRules||e.CORSRules||[];u=r.clone(r.isArray(u)?u:[u]),r.each(u,function(F){r.each(["AllowedOrigin","AllowedHeader","AllowedMethod","ExposeHeader"],function(q){var fe=q+"s",ue=F[fe]||F[q]||[];delete F[fe],F[q]=r.isArray(ue)?ue:[ue]})});var C={CORSRule:u};e.ResponseVary&&(C.ResponseVary=e.ResponseVary);var y=r.json2xml({CORSConfiguration:C}),P=e.Headers;P["Content-Type"]="application/xml",P["Content-MD5"]=r.b64(r.md5(y)),te.call(this,{Action:"name/cos:PutBucketCORS",method:"PUT",Bucket:e.Bucket,Region:e.Region,body:y,action:"cors",headers:P,tracker:e.tracker},function(F,q){if(F)return g(F);g(null,{statusCode:q.statusCode,headers:q.headers})})}function N(e,g){te.call(this,{Action:"name/cos:GetBucketCORS",method:"GET",Bucket:e.Bucket,Region:e.Region,headers:e.Headers,action:"cors",tracker:e.tracker},function(o,u){if(o){if(o.statusCode===404&&o.error&&o.error.Code==="NoSuchCORSConfiguration"){var C={CORSRules:[],statusCode:o.statusCode};o.headers&&(C.headers=o.headers),g(null,C)}else g(o);return}var y=u.CORSConfiguration||{},P=y.CORSRules||y.CORSRule||[];P=r.clone(r.isArray(P)?P:[P]);var F=y.ResponseVary;r.each(P,function(q){r.each(["AllowedOrigin","AllowedHeader","AllowedMethod","ExposeHeader"],function(fe){var ue=fe+"s",Re=q[ue]||q[fe]||[];delete q[fe],q[ue]=r.isArray(Re)?Re:[Re]})}),g(null,{CORSRules:P,ResponseVary:F,statusCode:u.statusCode,headers:u.headers})})}function D(e,g){te.call(this,{Action:"name/cos:DeleteBucketCORS",method:"DELETE",Bucket:e.Bucket,Region:e.Region,headers:e.Headers,action:"cors",tracker:e.tracker},function(o,u){if(o&&o.statusCode===204)return g(null,{statusCode:o.statusCode});if(o)return g(o);g(null,{statusCode:u.statusCode||o.statusCode,headers:u.headers})})}function j(e,g){te.call(this,{Action:"name/cos:GetBucketLocation",method:"GET",Bucket:e.Bucket,Region:e.Region,headers:e.Headers,action:"location",tracker:e.tracker},g)}function c(e,g){var o=e.Policy;try{typeof o=="string"&&(o=JSON.parse(o))}catch{}if(!o||typeof o=="string")return g(r.error(new Error("Policy format error")));var u=JSON.stringify(o);o.version||(o.version="2.0");var C=e.Headers;C["Content-Type"]="application/json",C["Content-MD5"]=r.b64(r.md5(u)),te.call(this,{Action:"name/cos:PutBucketPolicy",method:"PUT",Bucket:e.Bucket,Region:e.Region,action:"policy",body:u,headers:C,tracker:e.tracker},function(y,P){if(y&&y.statusCode===204)return g(null,{statusCode:y.statusCode});if(y)return g(y);g(null,{statusCode:P.statusCode,headers:P.headers})})}function a(e,g){te.call(this,{Action:"name/cos:GetBucketPolicy",method:"GET",Bucket:e.Bucket,Region:e.Region,headers:e.Headers,action:"policy",rawBody:!0,tracker:e.tracker},function(o,u){if(o)return o.statusCode&&o.statusCode===403?g(r.error(o,{ErrorStatus:"Access Denied"})):o.statusCode&&o.statusCode===405?g(r.error(o,{ErrorStatus:"Method Not Allowed"})):o.statusCode&&o.statusCode===404?g(r.error(o,{ErrorStatus:"Policy Not Found"})):g(o);var C={};try{C=JSON.parse(u.body)}catch{}g(null,{Policy:C,statusCode:u.statusCode,headers:u.headers})})}function b(e,g){te.call(this,{Action:"name/cos:DeleteBucketPolicy",method:"DELETE",Bucket:e.Bucket,Region:e.Region,headers:e.Headers,action:"policy",tracker:e.tracker},function(o,u){if(o&&o.statusCode===204)return g(null,{statusCode:o.statusCode});if(o)return g(o);g(null,{statusCode:u.statusCode||o.statusCode,headers:u.headers})})}function i(e,g){var o=e.Tagging||{},u=o.TagSet||o.Tags||e.Tags||[];u=r.clone(r.isArray(u)?u:[u]);var C=r.json2xml({Tagging:{TagSet:{Tag:u}}}),y=e.Headers;y["Content-Type"]="application/xml",y["Content-MD5"]=r.b64(r.md5(C)),te.call(this,{Action:"name/cos:PutBucketTagging",method:"PUT",Bucket:e.Bucket,Region:e.Region,body:C,action:"tagging",headers:y,tracker:e.tracker},function(P,F){if(P&&P.statusCode===204)return g(null,{statusCode:P.statusCode});if(P)return g(P);g(null,{statusCode:F.statusCode,headers:F.headers})})}function n(e,g){te.call(this,{Action:"name/cos:GetBucketTagging",method:"GET",Bucket:e.Bucket,Region:e.Region,headers:e.Headers,action:"tagging",tracker:e.tracker},function(o,u){if(o){if(o.statusCode===404&&o.error&&(o.error==="Not Found"||o.error.Code==="NoSuchTagSet")){var C={Tags:[],statusCode:o.statusCode};o.headers&&(C.headers=o.headers),g(null,C)}else g(o);return}var y=[];try{y=u.Tagging.TagSet.Tag||[]}catch{}y=r.clone(r.isArray(y)?y:[y]),g(null,{Tags:y,statusCode:u.statusCode,headers:u.headers})})}function t(e,g){te.call(this,{Action:"name/cos:DeleteBucketTagging",method:"DELETE",Bucket:e.Bucket,Region:e.Region,headers:e.Headers,action:"tagging",tracker:e.tracker},function(o,u){if(o&&o.statusCode===204)return g(null,{statusCode:o.statusCode});if(o)return g(o);g(null,{statusCode:u.statusCode,headers:u.headers})})}function s(e,g){var o=e.LifecycleConfiguration||{},u=o.Rules||e.Rules||[];u=r.clone(u);var C=r.json2xml({LifecycleConfiguration:{Rule:u}}),y=e.Headers;y["Content-Type"]="application/xml",y["Content-MD5"]=r.b64(r.md5(C)),te.call(this,{Action:"name/cos:PutBucketLifecycle",method:"PUT",Bucket:e.Bucket,Region:e.Region,body:C,action:"lifecycle",headers:y,tracker:e.tracker},function(P,F){if(P&&P.statusCode===204)return g(null,{statusCode:P.statusCode});if(P)return g(P);g(null,{statusCode:F.statusCode,headers:F.headers})})}function l(e,g){te.call(this,{Action:"name/cos:GetBucketLifecycle",method:"GET",Bucket:e.Bucket,Region:e.Region,headers:e.Headers,action:"lifecycle",tracker:e.tracker},function(o,u){if(o){if(o.statusCode===404&&o.error&&o.error.Code==="NoSuchLifecycleConfiguration"){var C={Rules:[],statusCode:o.statusCode};o.headers&&(C.headers=o.headers),g(null,C)}else g(o);return}var y=[];try{y=u.LifecycleConfiguration.Rule||[]}catch{}y=r.clone(r.isArray(y)?y:[y]),g(null,{Rules:y,statusCode:u.statusCode,headers:u.headers})})}function v(e,g){te.call(this,{Action:"name/cos:DeleteBucketLifecycle",method:"DELETE",Bucket:e.Bucket,Region:e.Region,headers:e.Headers,action:"lifecycle",tracker:e.tracker},function(o,u){if(o&&o.statusCode===204)return g(null,{statusCode:o.statusCode});if(o)return g(o);g(null,{statusCode:u.statusCode,headers:u.headers})})}function M(e,g){if(!e.VersioningConfiguration){g(r.error(new Error("missing param VersioningConfiguration")));return}var o=e.VersioningConfiguration||{},u=r.json2xml({VersioningConfiguration:o}),C=e.Headers;C["Content-Type"]="application/xml",C["Content-MD5"]=r.b64(r.md5(u)),te.call(this,{Action:"name/cos:PutBucketVersioning",method:"PUT",Bucket:e.Bucket,Region:e.Region,body:u,action:"versioning",headers:C,tracker:e.tracker},function(y,P){if(y&&y.statusCode===204)return g(null,{statusCode:y.statusCode});if(y)return g(y);g(null,{statusCode:P.statusCode,headers:P.headers})})}function x(e,g){te.call(this,{Action:"name/cos:GetBucketVersioning",method:"GET",Bucket:e.Bucket,Region:e.Region,headers:e.Headers,action:"versioning",tracker:e.tracker},function(o,u){o||!u.VersioningConfiguration&&(u.VersioningConfiguration={}),g(o,u)})}function H(e,g){var o=r.clone(e.ReplicationConfiguration),u=r.json2xml({ReplicationConfiguration:o});u=u.replace(/<(\/?)Rules>/gi,"<$1Rule>"),u=u.replace(/<(\/?)Tags>/gi,"<$1Tag>");var C=e.Headers;C["Content-Type"]="application/xml",C["Content-MD5"]=r.b64(r.md5(u)),te.call(this,{Action:"name/cos:PutBucketReplication",method:"PUT",Bucket:e.Bucket,Region:e.Region,body:u,action:"replication",headers:C,tracker:e.tracker},function(y,P){if(y&&y.statusCode===204)return g(null,{statusCode:y.statusCode});if(y)return g(y);g(null,{statusCode:P.statusCode,headers:P.headers})})}function $(e,g){te.call(this,{Action:"name/cos:GetBucketReplication",method:"GET",Bucket:e.Bucket,Region:e.Region,headers:e.Headers,action:"replication",tracker:e.tracker},function(o,u){if(o){if(o.statusCode===404&&o.error&&(o.error==="Not Found"||o.error.Code==="ReplicationConfigurationnotFoundError")){var C={ReplicationConfiguration:{Rules:[]},statusCode:o.statusCode};o.headers&&(C.headers=o.headers),g(null,C)}else g(o);return}!u.ReplicationConfiguration&&(u.ReplicationConfiguration={}),u.ReplicationConfiguration.Rule&&(u.ReplicationConfiguration.Rules=r.makeArray(u.ReplicationConfiguration.Rule),delete u.ReplicationConfiguration.Rule),g(o,u)})}function Y(e,g){te.call(this,{Action:"name/cos:DeleteBucketReplication",method:"DELETE",Bucket:e.Bucket,Region:e.Region,headers:e.Headers,action:"replication",tracker:e.tracker},function(o,u){if(o&&o.statusCode===204)return g(null,{statusCode:o.statusCode});if(o)return g(o);g(null,{statusCode:u.statusCode,headers:u.headers})})}function ee(e,g){if(!e.WebsiteConfiguration){g(r.error(new Error("missing param WebsiteConfiguration")));return}var o=r.clone(e.WebsiteConfiguration||{}),u=o.RoutingRules||o.RoutingRule||[];u=r.isArray(u)?u:[u],delete o.RoutingRule,delete o.RoutingRules,u.length&&(o.RoutingRules={RoutingRule:u});var C=r.json2xml({WebsiteConfiguration:o}),y=e.Headers;y["Content-Type"]="application/xml",y["Content-MD5"]=r.b64(r.md5(C)),te.call(this,{Action:"name/cos:PutBucketWebsite",method:"PUT",Bucket:e.Bucket,Region:e.Region,body:C,action:"website",headers:y,tracker:e.tracker},function(P,F){if(P&&P.statusCode===204)return g(null,{statusCode:P.statusCode});if(P)return g(P);g(null,{statusCode:F.statusCode,headers:F.headers})})}function re(e,g){te.call(this,{Action:"name/cos:GetBucketWebsite",method:"GET",Bucket:e.Bucket,Region:e.Region,Key:e.Key,headers:e.Headers,action:"website",tracker:e.tracker},function(o,u){if(o){if(o.statusCode===404&&o.error.Code==="NoSuchWebsiteConfiguration"){var C={WebsiteConfiguration:{},statusCode:o.statusCode};o.headers&&(C.headers=o.headers),g(null,C)}else g(o);return}var y=u.WebsiteConfiguration||{};if(y.RoutingRules){var P=r.clone(y.RoutingRules.RoutingRule||[]);P=r.makeArray(P),y.RoutingRules=P}g(null,{WebsiteConfiguration:y,statusCode:u.statusCode,headers:u.headers})})}function ie(e,g){te.call(this,{Action:"name/cos:DeleteBucketWebsite",method:"DELETE",Bucket:e.Bucket,Region:e.Region,headers:e.Headers,action:"website",tracker:e.tracker},function(o,u){if(o&&o.statusCode===204)return g(null,{statusCode:o.statusCode});if(o)return g(o);g(null,{statusCode:u.statusCode,headers:u.headers})})}function me(e,g){if(!e.RefererConfiguration){g(r.error(new Error("missing param RefererConfiguration")));return}var o=r.clone(e.RefererConfiguration||{}),u=o.DomainList||{},C=u.Domains||u.Domain||[];C=r.isArray(C)?C:[C],C.length&&(o.DomainList={Domain:C});var y=r.json2xml({RefererConfiguration:o}),P=e.Headers;P["Content-Type"]="application/xml",P["Content-MD5"]=r.b64(r.md5(y)),te.call(this,{Action:"name/cos:PutBucketReferer",method:"PUT",Bucket:e.Bucket,Region:e.Region,body:y,action:"referer",headers:P,tracker:e.tracker},function(F,q){if(F&&F.statusCode===204)return g(null,{statusCode:F.statusCode});if(F)return g(F);g(null,{statusCode:q.statusCode,headers:q.headers})})}function de(e,g){te.call(this,{Action:"name/cos:GetBucketReferer",method:"GET",Bucket:e.Bucket,Region:e.Region,Key:e.Key,headers:e.Headers,action:"referer",tracker:e.tracker},function(o,u){if(o){if(o.statusCode===404&&o.error.Code==="NoSuchRefererConfiguration"){var C={WebsiteConfiguration:{},statusCode:o.statusCode};o.headers&&(C.headers=o.headers),g(null,C)}else g(o);return}var y=u.RefererConfiguration||{};if(y.DomainList){var P=r.makeArray(y.DomainList.Domain||[]);y.DomainList={Domains:P}}g(null,{RefererConfiguration:y,statusCode:u.statusCode,headers:u.headers})})}function le(e,g){var o=e.DomainConfiguration||{},u=o.DomainRule||e.DomainRule||[];u=r.clone(u);var C=r.json2xml({DomainConfiguration:{DomainRule:u}}),y=e.Headers;y["Content-Type"]="application/xml",y["Content-MD5"]=r.b64(r.md5(C)),te.call(this,{Action:"name/cos:PutBucketDomain",method:"PUT",Bucket:e.Bucket,Region:e.Region,body:C,action:"domain",headers:y,tracker:e.tracker},function(P,F){if(P&&P.statusCode===204)return g(null,{statusCode:P.statusCode});if(P)return g(P);g(null,{statusCode:F.statusCode,headers:F.headers})})}function ne(e,g){te.call(this,{Action:"name/cos:GetBucketDomain",method:"GET",Bucket:e.Bucket,Region:e.Region,headers:e.Headers,action:"domain",tracker:e.tracker},function(o,u){if(o)return g(o);var C=[];try{C=u.DomainConfiguration.DomainRule||[]}catch{}C=r.clone(r.isArray(C)?C:[C]),g(null,{DomainRule:C,statusCode:u.statusCode,headers:u.headers})})}function Q(e,g){te.call(this,{Action:"name/cos:DeleteBucketDomain",method:"DELETE",Bucket:e.Bucket,Region:e.Region,headers:e.Headers,action:"domain",tracker:e.tracker},function(o,u){if(o&&o.statusCode===204)return g(null,{statusCode:o.statusCode});if(o)return g(o);g(null,{statusCode:u.statusCode,headers:u.headers})})}function oe(e,g){var o=e.OriginConfiguration||{},u=o.OriginRule||e.OriginRule||[];u=r.clone(u);var C=r.json2xml({OriginConfiguration:{OriginRule:u}}),y=e.Headers;y["Content-Type"]="application/xml",y["Content-MD5"]=r.b64(r.md5(C)),te.call(this,{Action:"name/cos:PutBucketOrigin",method:"PUT",Bucket:e.Bucket,Region:e.Region,body:C,action:"origin",headers:y,tracker:e.tracker},function(P,F){if(P&&P.statusCode===204)return g(null,{statusCode:P.statusCode});if(P)return g(P);g(null,{statusCode:F.statusCode,headers:F.headers})})}function ge(e,g){te.call(this,{Action:"name/cos:GetBucketOrigin",method:"GET",Bucket:e.Bucket,Region:e.Region,headers:e.Headers,action:"origin",tracker:e.tracker},function(o,u){if(o)return g(o);var C=[];try{C=u.OriginConfiguration.OriginRule||[]}catch{}C=r.clone(r.isArray(C)?C:[C]),g(null,{OriginRule:C,statusCode:u.statusCode,headers:u.headers})})}function he(e,g){te.call(this,{Action:"name/cos:DeleteBucketOrigin",method:"DELETE",Bucket:e.Bucket,Region:e.Region,headers:e.Headers,action:"origin",tracker:e.tracker},function(o,u){if(o&&o.statusCode===204)return g(null,{statusCode:o.statusCode});if(o)return g(o);g(null,{statusCode:u.statusCode,headers:u.headers})})}function se(e,g){var o=r.json2xml({BucketLoggingStatus:e.BucketLoggingStatus||""}),u=e.Headers;u["Content-Type"]="application/xml",u["Content-MD5"]=r.b64(r.md5(o)),te.call(this,{Action:"name/cos:PutBucketLogging",method:"PUT",Bucket:e.Bucket,Region:e.Region,body:o,action:"logging",headers:u,tracker:e.tracker},function(C,y){if(C&&C.statusCode===204)return g(null,{statusCode:C.statusCode});if(C)return g(C);g(null,{statusCode:y.statusCode,headers:y.headers})})}function ce(e,g){te.call(this,{Action:"name/cos:GetBucketLogging",method:"GET",Bucket:e.Bucket,Region:e.Region,headers:e.Headers,action:"logging",tracker:e.tracker},function(o,u){if(o)return g(o);g(null,{BucketLoggingStatus:u.BucketLoggingStatus,statusCode:u.statusCode,headers:u.headers})})}function ye(e,g,o){var u=r.clone(g.InventoryConfiguration);if(u.OptionalFields){var C=u.OptionalFields||[];u.OptionalFields={Field:C}}if(u.Destination&&u.Destination.COSBucketDestination&&u.Destination.COSBucketDestination.Encryption){var y=u.Destination.COSBucketDestination.Encryption;Object.keys(y).indexOf("SSECOS")>-1&&(y["SSE-COS"]=y.SSECOS,delete y.SSECOS)}var P=r.json2xml({InventoryConfiguration:u}),F=g.Headers;F["Content-Type"]="application/xml",F["Content-MD5"]=r.b64(r.md5(P));var q=e==="PUT"?"name/cos:PutBucketInventory":"name/cos:PostBucketInventory";te.call(this,{Action:q,method:e,Bucket:g.Bucket,Region:g.Region,body:P,action:"inventory",qs:{id:g.Id},headers:F,tracker:g.tracker},function(fe,ue){if(fe&&fe.statusCode===204)return o(null,{statusCode:fe.statusCode});if(fe)return o(fe);o(null,{statusCode:ue.statusCode,headers:ue.headers})})}function Ce(e,g){return ye.call(this,"PUT",e,g)}function Se(e,g){return ye.call(this,"POST",e,g)}function Oe(e,g){te.call(this,{Action:"name/cos:GetBucketInventory",method:"GET",Bucket:e.Bucket,Region:e.Region,headers:e.Headers,action:"inventory",qs:{id:e.Id},tracker:e.tracker},function(o,u){if(o)return g(o);var C=u.InventoryConfiguration;if(C&&C.OptionalFields&&C.OptionalFields.Field){var y=C.OptionalFields.Field;r.isArray(y)||(y=[y]),C.OptionalFields=y}if(C.Destination&&C.Destination.COSBucketDestination&&C.Destination.COSBucketDestination.Encryption){var P=C.Destination.COSBucketDestination.Encryption;Object.keys(P).indexOf("SSE-COS")>-1&&(P.SSECOS=P["SSE-COS"],delete P["SSE-COS"])}g(null,{InventoryConfiguration:C,statusCode:u.statusCode,headers:u.headers})})}function xe(e,g){te.call(this,{Action:"name/cos:ListBucketInventory",method:"GET",Bucket:e.Bucket,Region:e.Region,headers:e.Headers,action:"inventory",qs:{"continuation-token":e.ContinuationToken},tracker:e.tracker},function(o,u){if(o)return g(o);var C=u.ListInventoryConfigurationResult,y=C.InventoryConfiguration||[];y=r.isArray(y)?y:[y],delete C.InventoryConfiguration,r.each(y,function(P){if(P&&P.OptionalFields&&P.OptionalFields.Field){var F=P.OptionalFields.Field;r.isArray(F)||(F=[F]),P.OptionalFields=F}if(P.Destination&&P.Destination.COSBucketDestination&&P.Destination.COSBucketDestination.Encryption){var q=P.Destination.COSBucketDestination.Encryption;Object.keys(q).indexOf("SSE-COS")>-1&&(q.SSECOS=q["SSE-COS"],delete q["SSE-COS"])}}),C.InventoryConfigurations=y,r.extend(C,{statusCode:u.statusCode,headers:u.headers}),g(null,C)})}function Ne(e,g){te.call(this,{Action:"name/cos:DeleteBucketInventory",method:"DELETE",Bucket:e.Bucket,Region:e.Region,headers:e.Headers,action:"inventory",qs:{id:e.Id},tracker:e.tracker},function(o,u){if(o&&o.statusCode===204)return g(null,{statusCode:o.statusCode});if(o)return g(o);g(null,{statusCode:u.statusCode,headers:u.headers})})}function et(e,g){if(!e.AccelerateConfiguration){g(r.error(new Error("missing param AccelerateConfiguration")));return}var o={AccelerateConfiguration:e.AccelerateConfiguration||{}},u=r.json2xml(o),C={};C["Content-Type"]="application/xml",C["Content-MD5"]=r.b64(r.md5(u)),te.call(this,{Action:"name/cos:PutBucketAccelerate",method:"PUT",Bucket:e.Bucket,Region:e.Region,body:u,action:"accelerate",headers:C,tracker:e.tracker},function(y,P){if(y)return g(y);g(null,{statusCode:P.statusCode,headers:P.headers})})}function qe(e,g){te.call(this,{Action:"name/cos:GetBucketAccelerate",method:"GET",Bucket:e.Bucket,Region:e.Region,action:"accelerate",tracker:e.tracker},function(o,u){o||!u.AccelerateConfiguration&&(u.AccelerateConfiguration={}),g(o,u)})}function rt(e,g){var o=e.ServerSideEncryptionConfiguration||{},u=o.Rule||o.Rules||[],C=r.json2xml({ServerSideEncryptionConfiguration:{Rule:u}}),y=e.Headers;y["Content-Type"]="application/xml",y["Content-MD5"]=r.b64(r.md5(C)),te.call(this,{Action:"name/cos:PutBucketEncryption",method:"PUT",Bucket:e.Bucket,Region:e.Region,body:C,action:"encryption",headers:y,tracker:e.tracker},function(P,F){if(P&&P.statusCode===204)return g(null,{statusCode:P.statusCode});if(P)return g(P);g(null,{statusCode:F.statusCode,headers:F.headers})})}function at(e,g){te.call(this,{Action:"name/cos:GetBucketEncryption",method:"GET",Bucket:e.Bucket,Region:e.Region,headers:e.Headers,action:"encryption",tracker:e.tracker},function(o,u){if(o){if(o.statusCode===404&&o.code==="NoSuchEncryptionConfiguration"){var C={EncryptionConfiguration:{Rules:[]},statusCode:o.statusCode};o.headers&&(C.headers=o.headers),g(null,C)}else g(o);return}var y=r.makeArray(u.EncryptionConfiguration&&u.EncryptionConfiguration.Rule||[]);u.EncryptionConfiguration={Rules:y},g(o,u)})}function Ge(e,g){te.call(this,{Action:"name/cos:DeleteBucketReplication",method:"DELETE",Bucket:e.Bucket,Region:e.Region,headers:e.Headers,action:"encryption",tracker:e.tracker},function(o,u){if(o&&o.statusCode===204)return g(null,{statusCode:o.statusCode});if(o)return g(o);g(null,{statusCode:u.statusCode,headers:u.headers})})}function ot(e,g){te.call(this,{Action:"name/cos:HeadObject",method:"HEAD",Bucket:e.Bucket,Region:e.Region,Key:e.Key,VersionId:e.VersionId,headers:e.Headers,tracker:e.tracker},function(o,u){if(o){var C=o.statusCode;return e.Headers["If-Modified-Since"]&&C&&C===304?g(null,{NotModified:!0,statusCode:C}):g(o)}u.ETag=r.attr(u.headers,"etag",""),g(null,u)})}function vt(e,g){var o={};o.prefix=e.Prefix||"",o.delimiter=e.Delimiter,o["key-marker"]=e.KeyMarker,o["version-id-marker"]=e.VersionIdMarker,o["max-keys"]=e.MaxKeys,o["encoding-type"]=e.EncodingType,te.call(this,{Action:"name/cos:GetBucketObjectVersions",ResourceKey:o.prefix,method:"GET",Bucket:e.Bucket,Region:e.Region,headers:e.Headers,qs:o,action:"versions",tracker:e.tracker},function(u,C){if(u)return g(u);var y=C.ListVersionsResult||{},P=y.DeleteMarker||[];P=r.isArray(P)?P:[P];var F=y.Version||[];F=r.isArray(F)?F:[F];var q=r.clone(y);delete q.DeleteMarker,delete q.Version,r.extend(q,{DeleteMarkers:P,Versions:F,statusCode:C.statusCode,headers:C.headers}),g(null,q)})}function Et(e,g){var o=this;if(o.logger.info({cate:"PROCESS",tag:"download",msg:"[key=".concat(e.Key,"] getObject开始")}),this.options.ObjectKeySimplifyCheck){var u=r.simplifyPath(e.Key);if(u==="/"){g(r.error(new Error("The Getobject Key is illegal")));return}}var C=e.Query||{},y=e.QueryString||"",P=r.throttleOnProgress.call(this,0,e.onProgress),F=e.tracker;F&&F.setParams({signStartTime:new Date().getTime()}),C["response-content-type"]=e.ResponseContentType,C["response-content-language"]=e.ResponseContentLanguage,C["response-expires"]=e.ResponseExpires,C["response-cache-control"]=e.ResponseCacheControl,C["response-content-disposition"]=e.ResponseContentDisposition,C["response-content-encoding"]=e.ResponseContentEncoding,te.call(this,{Action:"name/cos:GetObject",method:"GET",Bucket:e.Bucket,Region:e.Region,Key:e.Key,VersionId:e.VersionId,DataType:e.DataType,headers:e.Headers,qs:C,qsStr:y,rawBody:!0,onDownloadProgress:P,tracker:F},function(q,fe){if(P(null,!0),q){var ue=q.statusCode;return e.Headers["If-Modified-Since"]&&ue&&ue===304?g(null,{NotModified:!0}):g(q)}g(null,{Body:fe.body,ETag:r.attr(fe.headers,"etag",""),statusCode:fe.statusCode,headers:fe.headers}),o.logger.info({cate:"PROCESS",tag:"download",msg:"[key=".concat(e.Key,"] getObject结束")})})}function Ot(e,g){var o=this,u=e.ContentLength,C=r.throttleOnProgress.call(o,u,e.onProgress);o.logger.info({cate:"PROCESS",tag:"upload",msg:"[key=".concat(e.Key,"] putObject开始")});var y=e.Headers;!y["Cache-Control"]&&!y["cache-control"]&&(y["Cache-Control"]=""),!y["Content-Type"]&&!y["content-type"]&&(y["Content-Type"]=e.Body&&e.Body.type||"");var P=e.UploadAddMetaMd5||o.options.UploadAddMetaMd5||o.options.UploadCheckContentMd5,F=e.tracker;P&&F&&F.setParams({md5StartTime:new Date().getTime()}),P&&o.logger.debug({cate:"PROCESS",tag:"upload",msg:"[key=".concat(e.Key,"] 开始计算 md5")}),r.getBodyMd5(P,e.Body,function(q){q&&(o.logger.debug({cate:"PROCESS",tag:"upload",msg:"[key=".concat(e.Key,"] md5: ").concat(q,"，md5Base64=").concat(r.b64(q))}),F&&F.setParams({md5EndTime:new Date().getTime()}),o.options.UploadCheckContentMd5&&(y["Content-MD5"]=r.b64(q)),(e.UploadAddMetaMd5||o.options.UploadAddMetaMd5)&&(y["x-cos-meta-md5"]=q)),e.ContentLength!==void 0&&(y["Content-Length"]=e.ContentLength),C(null,!0),te.call(o,{Action:"name/cos:PutObject",TaskId:e.TaskId,method:"PUT",Bucket:e.Bucket,Region:e.Region,Key:e.Key,headers:e.Headers,qs:e.Query,body:e.Body,onProgress:C,tracker:F},function(fe,ue){if(fe)return o.logger.error({cate:"ERROR",tag:"upload",msg:"上传失败，错误信息：".concat(JSON.stringify(fe))}),C(null,!0),g(fe);C({loaded:u,total:u},!0);var Re=Xe({ForcePathStyle:o.options.ForcePathStyle,protocol:o.options.Protocol,domain:o.options.Domain,bucket:e.Bucket,region:o.options.UseAccelerate?"accelerate":e.Region,object:e.Key});Re=Re.substr(Re.indexOf("://")+3),ue.Location=Re,ue.ETag=r.attr(ue.headers,"etag",""),o.logger.info({cate:"RESULT",tag:"upload",msg:"上传成功，Location=".concat(Re)}),o.logger.info({cate:"PROCESS",tag:"upload",msg:"[key=".concat(e.Key,"] putObject结束")}),g(null,ue)})},e.onHashProgress)}function At(e,g){te.call(this,{Action:"name/cos:DeleteObject",method:"DELETE",Bucket:e.Bucket,Region:e.Region,Key:e.Key,headers:e.Headers,VersionId:e.VersionId,action:e.Recursive?"recursive":"",tracker:e.tracker},function(o,u){if(o){var C=o.statusCode;return C&&C===404?g(null,{BucketNotFound:!0,statusCode:C}):g(o)}g(null,{statusCode:u.statusCode,headers:u.headers})})}function It(e,g){var o={};e.VersionId&&(o.versionId=e.VersionId),te.call(this,{Action:"name/cos:GetObjectACL",method:"GET",Bucket:e.Bucket,Region:e.Region,Key:e.Key,headers:e.Headers,qs:o,action:"acl",tracker:e.tracker},function(u,C){if(u)return g(u);var y=C.AccessControlPolicy||{},P=y.Owner||{},F=y.AccessControlList&&y.AccessControlList.Grant||[];F=r.isArray(F)?F:[F];var q=we(y);delete q.GrantWrite,C.headers&&C.headers["x-cos-acl"]&&(q.ACL=C.headers["x-cos-acl"]),q=r.extend(q,{Owner:P,Grants:F,statusCode:C.statusCode,headers:C.headers}),g(null,q)})}function Ut(e,g){var o=e.Headers,u="";if(e.AccessControlPolicy){var C=r.clone(e.AccessControlPolicy||{}),y=C.Grants||C.Grant;y=r.isArray(y)?y:[y],delete C.Grant,delete C.Grants,C.AccessControlList={Grant:y},u=r.json2xml({AccessControlPolicy:C}),o["Content-Type"]="application/xml",o["Content-MD5"]=r.b64(r.md5(u))}r.each(o,function(P,F){F.indexOf("x-cos-grant-")===0&&(o[F]=tt(o[F]))}),te.call(this,{Action:"name/cos:PutObjectACL",method:"PUT",Bucket:e.Bucket,Region:e.Region,Key:e.Key,action:"acl",headers:o,body:u,tracker:e.tracker},function(P,F){if(P)return g(P);g(null,{statusCode:F.statusCode,headers:F.headers})})}function Lt(e,g){var o=e.Headers;o.Origin=e.Origin,o["Access-Control-Request-Method"]=e.AccessControlRequestMethod,o["Access-Control-Request-Headers"]=e.AccessControlRequestHeaders,te.call(this,{Action:"name/cos:OptionsObject",method:"OPTIONS",Bucket:e.Bucket,Region:e.Region,Key:e.Key,headers:o,tracker:e.tracker},function(u,C){if(u)return u.statusCode&&u.statusCode===403?g(null,{OptionsForbidden:!0,statusCode:u.statusCode}):g(u);var y=C.headers||{};g(null,{AccessControlAllowOrigin:y["access-control-allow-origin"],AccessControlAllowMethods:y["access-control-allow-methods"],AccessControlAllowHeaders:y["access-control-allow-headers"],AccessControlExposeHeaders:y["access-control-expose-headers"],AccessControlMaxAge:y["access-control-max-age"],statusCode:C.statusCode,headers:C.headers})})}function jt(e,g){var o=this,u=e.Headers;!u["Cache-Control"]&&!u["cache-control"]&&(u["Cache-Control"]="");var C=e.CopySource||"",y=r.getSourceParams.call(this,C);if(!y){g(r.error(new Error("CopySource format error")));return}var P=y.Bucket,F=y.Region,q=decodeURIComponent(y.Key);te.call(this,{Scope:[{action:"name/cos:GetObject",bucket:P,region:F,prefix:q},{action:"name/cos:PutObject",bucket:e.Bucket,region:e.Region,prefix:e.Key}],method:"PUT",Bucket:e.Bucket,Region:e.Region,Key:e.Key,VersionId:e.VersionId,headers:e.Headers,tracker:e.tracker},function(fe,ue){if(fe)return g(fe);var Re=r.clone(ue.CopyObjectResult||{}),J=Xe({ForcePathStyle:o.options.ForcePathStyle,protocol:o.options.Protocol,domain:o.options.Domain,bucket:e.Bucket,region:e.Region,object:e.Key,isLocation:!0});r.extend(Re,{Location:J,statusCode:ue.statusCode,headers:ue.headers}),g(null,Re)})}function $e(e,g){var o=e.CopySource||"",u=r.getSourceParams.call(this,o);if(!u){g(r.error(new Error("CopySource format error")));return}var C=u.Bucket,y=u.Region,P=decodeURIComponent(u.Key);te.call(this,{Scope:[{action:"name/cos:GetObject",bucket:C,region:y,prefix:P},{action:"name/cos:PutObject",bucket:e.Bucket,region:e.Region,prefix:e.Key}],method:"PUT",Bucket:e.Bucket,Region:e.Region,Key:e.Key,VersionId:e.VersionId,qs:{partNumber:e.PartNumber,uploadId:e.UploadId},headers:e.Headers,tracker:e.tracker},function(F,q){if(F)return g(F);var fe=r.clone(q.CopyPartResult||{});r.extend(fe,{statusCode:q.statusCode,headers:q.headers}),g(null,fe)})}function W(e,g){var o=e.Objects||[],u=e.Quiet;o=r.isArray(o)?o:[o];var C=r.json2xml({Delete:{Object:o,Quiet:u||!1}}),y=e.Headers;y["Content-Type"]="application/xml",y["Content-MD5"]=r.b64(r.md5(C));var P=r.map(o,function(F){return{action:"name/cos:DeleteObject",bucket:e.Bucket,region:e.Region,prefix:F.Key}});te.call(this,{Scope:P,method:"POST",Bucket:e.Bucket,Region:e.Region,body:C,action:"delete",headers:y,tracker:e.tracker},function(F,q){if(F)return g(F);var fe=q.DeleteResult||{},ue=fe.Deleted||[],Re=fe.Error||[];ue=r.isArray(ue)?ue:[ue],Re=r.isArray(Re)?Re:[Re];var J=r.clone(fe);r.extend(J,{Error:Re,Deleted:ue,statusCode:q.statusCode,headers:q.headers}),g(null,J)})}function I(e,g){var o=e.Headers;if(!e.RestoreRequest){g(r.error(new Error("missing param RestoreRequest")));return}var u=e.RestoreRequest||{},C=r.json2xml({RestoreRequest:u});o["Content-Type"]="application/xml",o["Content-MD5"]=r.b64(r.md5(C)),te.call(this,{Action:"name/cos:RestoreObject",method:"POST",Bucket:e.Bucket,Region:e.Region,Key:e.Key,VersionId:e.VersionId,body:C,action:"restore",headers:o,tracker:e.tracker},g)}function _(e,g){var o=e.Tagging||{},u=o.TagSet||o.Tags||e.Tags||[];u=r.clone(r.isArray(u)?u:[u]);var C=r.json2xml({Tagging:{TagSet:{Tag:u}}}),y=e.Headers;y["Content-Type"]="application/xml",y["Content-MD5"]=r.b64(r.md5(C)),te.call(this,{Action:"name/cos:PutObjectTagging",method:"PUT",Bucket:e.Bucket,Key:e.Key,Region:e.Region,body:C,action:"tagging",headers:y,VersionId:e.VersionId,tracker:e.tracker},function(P,F){if(P&&P.statusCode===204)return g(null,{statusCode:P.statusCode});if(P)return g(P);g(null,{statusCode:F.statusCode,headers:F.headers})})}function z(e,g){te.call(this,{Action:"name/cos:GetObjectTagging",method:"GET",Key:e.Key,Bucket:e.Bucket,Region:e.Region,headers:e.Headers,action:"tagging",VersionId:e.VersionId,tracker:e.tracker},function(o,u){if(o){if(o.statusCode===404&&o.error&&(o.error==="Not Found"||o.error.Code==="NoSuchTagSet")){var C={Tags:[],statusCode:o.statusCode};o.headers&&(C.headers=o.headers),g(null,C)}else g(o);return}var y=[];try{y=u.Tagging.TagSet.Tag||[]}catch{}y=r.clone(r.isArray(y)?y:[y]),g(null,{Tags:y,statusCode:u.statusCode,headers:u.headers})})}function X(e,g){te.call(this,{Action:"name/cos:DeleteObjectTagging",method:"DELETE",Bucket:e.Bucket,Region:e.Region,Key:e.Key,headers:e.Headers,action:"tagging",VersionId:e.VersionId,tracker:e.tracker},function(o,u){if(o&&o.statusCode===204)return g(null,{statusCode:o.statusCode});if(o)return g(o);g(null,{statusCode:u.statusCode,headers:u.headers})})}function Z(e,g){var o=e.SelectType;if(!o)return g(r.error(new Error("missing param SelectType")));var u=e.SelectRequest||{},C=r.json2xml({SelectRequest:u}),y=e.Headers;y["Content-Type"]="application/xml",y["Content-MD5"]=r.b64(r.md5(C)),te.call(this,{Action:"name/cos:GetObject",method:"POST",Bucket:e.Bucket,Region:e.Region,Key:e.Key,headers:e.Headers,action:"select",qs:{"select-type":e.SelectType},VersionId:e.VersionId,body:C,DataType:"arraybuffer",rawBody:!0,tracker:e.tracker},function(P,F){if(P&&P.statusCode===204)return g(null,{statusCode:P.statusCode});if(P)return g(P);var q=r.parseSelectPayload(F.body);g(null,{statusCode:F.statusCode,headers:F.headers,Body:q.body,Payload:q.payload})})}function ae(e,g){var o=this,u=e.Headers,C=e.tracker;!u["Cache-Control"]&&!u["cache-control"]&&(u["Cache-Control"]=""),!u["Content-Type"]&&!u["content-type"]&&(u["Content-Type"]=e.Body&&e.Body.type||"");var y=e.Body&&(e.UploadAddMetaMd5||o.options.UploadAddMetaMd5);y&&C&&C.setParams({md5StartTime:new Date().getTime()}),r.getBodyMd5(y,e.Body,function(P){P&&(e.Headers["x-cos-meta-md5"]=P),y&&C&&C.setParams({md5EndTime:new Date().getTime()}),te.call(o,{Action:"name/cos:InitiateMultipartUpload",method:"POST",Bucket:e.Bucket,Region:e.Region,Key:e.Key,action:"uploads",headers:e.Headers,qs:e.Query,tracker:C},function(F,q){if(F)return C&&C.parent&&C.parent.setParams({errorNode:"multipartInit"}),g(F);if(q=r.clone(q||{}),q&&q.InitiateMultipartUploadResult)return g(null,r.extend(q.InitiateMultipartUploadResult,{statusCode:q.statusCode,headers:q.headers}));g(null,q)})},e.onHashProgress)}function ve(e,g){var o=this;r.getFileSize("multipartUpload",e,function(){var u=e.tracker,C=o.options.UploadCheckContentMd5;C&&u&&u.setParams({md5StartTime:new Date().getTime()}),r.getBodyMd5(C,e.Body,function(y){y&&(e.Headers["Content-MD5"]=r.b64(y)),C&&u&&u.setParams({md5EndTime:new Date().getTime()}),u&&u.setParams({partNumber:e.PartNumber}),te.call(o,{Action:"name/cos:UploadPart",TaskId:e.TaskId,method:"PUT",Bucket:e.Bucket,Region:e.Region,Key:e.Key,qs:{partNumber:e.PartNumber,uploadId:e.UploadId},headers:e.Headers,onProgress:e.onProgress,body:e.Body||null,tracker:u},function(P,F){if(P)return u&&u.parent&&u.parent.setParams({errorNode:"multipartUpload"}),g(P);g(null,{ETag:r.attr(F.headers,"etag",""),statusCode:F.statusCode,headers:F.headers})})})})}function be(e,g){for(var o=this,u=e.UploadId,C=e.Parts,y=e.tracker,P=0,F=C.length;P<F;P++)C[P].ETag&&C[P].ETag.indexOf('"')===0||(C[P].ETag='"'+C[P].ETag+'"');var q=r.json2xml({CompleteMultipartUpload:{Part:C}});q=q.replace(/\n\s*/g,"");var fe=e.Headers;fe["Content-Type"]="application/xml",fe["Content-MD5"]=r.b64(r.md5(q)),te.call(this,{Action:"name/cos:CompleteMultipartUpload",method:"POST",Bucket:e.Bucket,Region:e.Region,Key:e.Key,qs:{uploadId:u},body:q,headers:fe,tracker:y},function(ue,Re){if(ue)return y&&y.parent&&y.parent.setParams({errorNode:"multipartComplete"}),g(ue);var J=Xe({ForcePathStyle:o.options.ForcePathStyle,protocol:o.options.Protocol,domain:o.options.Domain,bucket:e.Bucket,region:o.options.UseAccelerate?"accelerate":e.Region,object:e.Key,isLocation:!0}),Be=Re.CompleteMultipartUploadResult||{};if(Be.ProcessResults&&(Be.UploadResult={OriginalInfo:{Key:Be.Key,Location:J,ETag:Be.ETag,ImageInfo:Be.ImageInfo},ProcessResults:Be.ProcessResults},delete Be.ImageInfo,delete Be.ProcessResults),Be.CallbackResult){var Me=Be.CallbackResult;if(Me.Status==="200"&&Me.CallbackBody)try{Be.CallbackBody=JSON.parse(r.decodeBase64(Me.CallbackBody))}catch{Be.CallbackBody={}}else Be.CallbackError=Me.Error||{};delete Be.CallbackResult}if(Be.ReturnBodyResult){var He=Be.ReturnBodyResult;if(He.Status==="200"&&He.ReturnBody)try{Be.ReturnBody=JSON.parse(r.decodeBase64(He.ReturnBody))}catch{Be.ReturnBody={}}else Be.ReturnError={Code:He.Code,Message:He.Message,Status:He.Status};delete Be.ReturnBodyResult}var De=r.extend(Be,{Location:J,statusCode:Re.statusCode,headers:Re.headers});g(null,De)})}function Pe(e,g){var o={};o.delimiter=e.Delimiter,o["encoding-type"]=e.EncodingType,o.prefix=e.Prefix||"",o["max-uploads"]=e.MaxUploads,o["key-marker"]=e.KeyMarker,o["upload-id-marker"]=e.UploadIdMarker,o=r.clearKey(o);var u=e.tracker;u&&u.setParams({signStartTime:new Date().getTime()}),te.call(this,{Action:"name/cos:ListMultipartUploads",ResourceKey:o.prefix,method:"GET",Bucket:e.Bucket,Region:e.Region,headers:e.Headers,qs:o,action:"uploads",tracker:u},function(C,y){if(C)return u&&u.parent&&u.parent.setParams({errorNode:"multipartList"}),g(C);if(y&&y.ListMultipartUploadsResult){var P=y.ListMultipartUploadsResult.Upload||[];P=r.isArray(P)?P:[P],y.ListMultipartUploadsResult.Upload=P}var F=r.clone(y.ListMultipartUploadsResult||{});r.extend(F,{statusCode:y.statusCode,headers:y.headers}),g(null,F)})}function Ie(e,g){var o={},u=e.tracker;o.uploadId=e.UploadId,o["encoding-type"]=e.EncodingType,o["max-parts"]=e.MaxParts,o["part-number-marker"]=e.PartNumberMarker,te.call(this,{Action:"name/cos:ListParts",method:"GET",Bucket:e.Bucket,Region:e.Region,Key:e.Key,headers:e.Headers,qs:o,tracker:u},function(C,y){if(C)return u&&u.parent&&u.parent.setParams({errorNode:"multipartListPart"}),g(C);var P=y.ListPartsResult||{},F=P.Part||[];F=r.isArray(F)?F:[F],P.Part=F;var q=r.clone(P);r.extend(q,{statusCode:y.statusCode,headers:y.headers}),g(null,q)})}function _e(e,g){var o={};o.uploadId=e.UploadId,te.call(this,{Action:"name/cos:AbortMultipartUpload",method:"DELETE",Bucket:e.Bucket,Region:e.Region,Key:e.Key,headers:e.Headers,qs:o,tracker:e.tracker},function(u,C){if(u)return g(u);g(null,{statusCode:C.statusCode,headers:C.headers})})}function je(e,g){te.call(this,{method:e.Method,Bucket:e.Bucket,Region:e.Region,Key:e.Key,action:e.Action,headers:e.Headers,qs:e.Query,body:e.Body,Url:e.Url,rawBody:e.RawBody,DataType:e.DataType,tracker:e.tracker},function(o,u){if(o)return g(o);u&&u.body&&(u.Body=u.body,delete u.body),g(o,u)})}function We(e,g){var o=e.Headers;!o["Cache-Control"]&&!o["cache-control"]&&(o["Cache-Control"]=""),!o["Content-Type"]&&!o["content-type"]&&(o["Content-Type"]=e.Body&&e.Body.type||""),te.call(this,{Action:"name/cos:AppendObject",method:"POST",Bucket:e.Bucket,Region:e.Region,action:"append",Key:e.Key,body:e.Body,qs:{position:e.Position},headers:e.Headers,tracker:e.tracker},function(u,C){if(u)return g(u);g(null,C)})}function lt(e){var g=this;return r.getAuth({SecretId:e.SecretId||this.options.SecretId||"",SecretKey:e.SecretKey||this.options.SecretKey||"",Bucket:e.Bucket,Region:e.Region,Method:e.Method,Key:e.Key,Query:e.Query,Headers:e.Headers,Expires:e.Expires,UseRawKey:g.options.UseRawKey,SystemClockOffset:g.options.SystemClockOffset})}function Qe(e,g){var o=this,u=e.UseAccelerate===void 0?o.options.UseAccelerate:e.UseAccelerate,C=Xe({ForcePathStyle:o.options.ForcePathStyle,protocol:e.Protocol||o.options.Protocol,domain:e.Domain||o.options.Domain,bucket:e.Bucket,region:u?"accelerate":e.Region,object:e.Key}),y="";e.Query&&(y+=r.obj2str(e.Query)),e.QueryString&&(y+=(y?"&":"")+e.QueryString);var P=C;if(e.Sign!==void 0&&!e.Sign)return y&&(P+="?"+y),g(null,{Url:P}),P;var F=ft.call(this,{Bucket:e.Bucket,Region:e.Region,UseAccelerate:e.UseAccelerate,Url:C}),q=mt.call(this,{Action:(e.Method||"").toUpperCase()==="PUT"?"name/cos:PutObject":"name/cos:GetObject",Bucket:e.Bucket||"",Region:e.Region||"",Method:e.Method||"get",Key:e.Key,Expires:e.Expires,Headers:e.Headers,Query:e.Query,SignHost:F,ForceSignHost:e.ForceSignHost===!1?!1:o.options.ForceSignHost},function(fe,ue){if(g){if(fe){g(fe);return}var Re=function(Me){var He=Me.match(/q-url-param-list.*?(?=&)/g)[0],De="q-url-param-list="+encodeURIComponent(He.replace(/q-url-param-list=/,"")).toLowerCase(),Ve=new RegExp(He,"g"),it=Me.replace(Ve,De);return it},J=C;J+="?"+(ue.Authorization.indexOf("q-signature")>-1?Re(ue.Authorization):"sign="+encodeURIComponent(ue.Authorization)),ue.SecurityToken&&(J+="&x-cos-security-token="+ue.SecurityToken),ue.ClientIP&&(J+="&clientIP="+ue.ClientIP),ue.ClientUA&&(J+="&clientUA="+ue.ClientUA),ue.Token&&(J+="&token="+ue.Token),y&&(J+="&"+y),setTimeout(function(){g(null,{Url:J})})}});return q?(P+="?"+q.Authorization+(q.SecurityToken?"&x-cos-security-token="+q.SecurityToken:""),y&&(P+="&"+y)):y&&(P+="?"+y),P}function we(e){var g={GrantFullControl:[],GrantWrite:[],GrantRead:[],GrantReadAcp:[],GrantWriteAcp:[],ACL:""},o={FULL_CONTROL:"GrantFullControl",WRITE:"GrantWrite",READ:"GrantRead",READ_ACP:"GrantReadAcp",WRITE_ACP:"GrantWriteAcp"},u=e&&e.AccessControlList||{},C=u.Grant;C&&(C=r.isArray(C)?C:[C]);var y={READ:0,WRITE:0,FULL_CONTROL:0};return C&&C.length&&r.each(C,function(P){var F=P.Grantee.URI&&P.Grantee.URI.endsWith("/groups/global/AllUsers");P.Grantee.ID==="qcs::cam::anyone:anyone"||F?y[P.Permission]=1:P.Grantee.ID!==e.Owner.ID&&g[o[P.Permission]].push('id="'+P.Grantee.ID+'"')}),y.FULL_CONTROL||y.WRITE&&y.READ?g.ACL="public-read-write":y.READ?g.ACL="public-read":g.ACL="private",r.each(o,function(P){g[P]=tt(g[P].join(","))}),g}function tt(e){var g=e.split(","),o={},u,C;for(u=0;u<g.length;)C=g[u].trim(),o[C]?g.splice(u,1):(o[C]=!0,g[u]=C,u++);return g.join(",")}function Xe(e){var g=e.region||"",o=e.bucket||"",u=o.substr(0,o.lastIndexOf("-")),C=o.substr(o.lastIndexOf("-")+1),y=e.domain,P=e.object;typeof y=="function"&&(y=y({Bucket:o,Region:g})),["http","https"].includes(e.protocol)&&(e.protocol=e.protocol+":");var F=e.protocol||(r.isBrowser&&(typeof location>"u"?"undefined":m(location))==="object"&&location.protocol==="http:"?"http:":"https:");y||(["cn-south","cn-south-2","cn-north","cn-east","cn-southwest","sg"].indexOf(g)>-1?y="{Region}.myqcloud.com":y="cos.{Region}.myqcloud.com",e.ForcePathStyle||(y="{Bucket}."+y)),y=y.replace(/\{\{AppId\}\}/gi,C).replace(/\{\{Bucket\}\}/gi,u).replace(/\{\{Region\}\}/gi,g).replace(/\{\{.*?\}\}/gi,""),y=y.replace(/\{AppId\}/gi,C).replace(/\{BucketName\}/gi,u).replace(/\{Bucket\}/gi,o).replace(/\{Region\}/gi,g).replace(/\{.*?\}/gi,""),/^[a-zA-Z]+:\/\//.test(y)||(y=F+"//"+y),y.slice(-1)==="/"&&(y=y.slice(0,-1));var q=y;return e.ForcePathStyle&&(q+="/"+o),q+="/",P&&(q+=r.camSafeUrlEncode(P).replace(/%2F/g,"/")),e.isLocation&&(q=q.replace(/^https?:\/\//,"")),q}var ft=function(g){var o=g.Url||g.Bucket&&g.Region;if(!o)return"";var u=g.UseAccelerate===void 0?this.options.UseAccelerate:g.UseAccelerate,C=g.Url||Xe({ForcePathStyle:this.options.ForcePathStyle,protocol:this.options.Protocol,domain:this.options.Domain,bucket:g.Bucket,region:u?"accelerate":g.Region}),y=C.replace(/^https?:\/\/([^/]+)(\/.*)?$/,"$1");return y};function mt(e,g){var o=r.clone(e.Headers),u="";r.each(o,function(Ee,ke){(Ee===""||["content-type","cache-control","expires"].indexOf(ke.toLowerCase())>-1)&&delete o[ke],ke.toLowerCase()==="host"&&(u=Ee)});var C=e.ForceSignHost!==!1;!u&&e.SignHost&&C&&(o.Host=e.SignHost);var y=!1,P=function(ke,Ae){y||(y=!0,Ae&&Ae.XCosSecurityToken&&!Ae.SecurityToken&&(Ae=r.clone(Ae),Ae.SecurityToken=Ae.XCosSecurityToken,delete Ae.XCosSecurityToken),g&&g(ke,Ae))},F=this,q=e.Bucket||"",fe=e.Region||"",ue=e.Key||"";F.options.ForcePathStyle&&q&&(ue=q+"/"+ue);var Re="/"+ue,J={},Be=e.Scope;if(!Be){var Me=e.Action||"",He=e.ResourceKey||e.Key||"";Be=e.Scope||[{action:Me,bucket:q,region:fe,prefix:He}]}var De=r.md5(JSON.stringify(Be));F._StsCache=F._StsCache||[],function(){var Ee,ke;for(Ee=F._StsCache.length-1;Ee>=0;Ee--){ke=F._StsCache[Ee];var Ae=Math.round(r.getSkewTime(F.options.SystemClockOffset)/1e3)+30;if(ke.StartTime&&Ae<ke.StartTime||Ae>=ke.ExpiredTime){F._StsCache.splice(Ee,1);continue}if(!ke.ScopeLimit||ke.ScopeLimit&&ke.ScopeKey===De){J=ke;break}}}();var Ve=function(){var ke="";J.StartTime&&e.Expires?ke=J.StartTime+";"+(J.StartTime+e.Expires*1):J.StartTime&&J.ExpiredTime&&(ke=J.StartTime+";"+J.ExpiredTime);var Ae=r.getAuth({SecretId:J.TmpSecretId,SecretKey:J.TmpSecretKey,Method:e.Method,Pathname:Re,Query:e.Query,Headers:o,Expires:e.Expires,UseRawKey:F.options.UseRawKey,SystemClockOffset:F.options.SystemClockOffset,KeyTime:ke,ForceSignHost:C}),Te={Authorization:Ae,SecurityToken:J.SecurityToken||J.XCosSecurityToken||"",Token:J.Token||"",ClientIP:J.ClientIP||"",ClientUA:J.ClientUA||"",SignFrom:"client"};P(null,Te)},it=function(ke){if(ke.Authorization){var Ae=!1,Te=ke.Authorization;if(Te)if(Te.indexOf(" ")>-1)Ae=!1;else if(Te.indexOf("q-sign-algorithm=")>-1&&Te.indexOf("q-ak=")>-1&&Te.indexOf("q-sign-time=")>-1&&Te.indexOf("q-key-time=")>-1&&Te.indexOf("q-url-param-list=")>-1)Ae=!0;else try{Te=atob(Te),Te.indexOf("a=")>-1&&Te.indexOf("k=")>-1&&Te.indexOf("t=")>-1&&Te.indexOf("r=")>-1&&Te.indexOf("b=")>-1&&(Ae=!0)}catch{}if(!Ae)return r.error(new Error("getAuthorization callback params format error"))}else{if(!ke.TmpSecretId)return r.error(new Error('getAuthorization callback params missing "TmpSecretId"'));if(!ke.TmpSecretKey)return r.error(new Error('getAuthorization callback params missing "TmpSecretKey"'));if(!ke.SecurityToken&&!ke.XCosSecurityToken)return r.error(new Error('getAuthorization callback params missing "SecurityToken"'));if(!ke.ExpiredTime)return r.error(new Error('getAuthorization callback params missing "ExpiredTime"'));if(ke.ExpiredTime&&ke.ExpiredTime.toString().length!==10)return r.error(new Error('getAuthorization callback params "ExpiredTime" should be 10 digits'));if(ke.StartTime&&ke.StartTime.toString().length!==10)return r.error(new Error('getAuthorization callback params "StartTime" should be 10 StartTime'))}return!1};if(J.ExpiredTime&&J.ExpiredTime-r.getSkewTime(F.options.SystemClockOffset)/1e3>60)Ve();else if(F.options.getAuthorization)F.options.getAuthorization.call(F,{Bucket:q,Region:fe,Method:e.Method,Key:ue,Pathname:Re,Query:e.Query,Headers:o,Scope:Be,SystemClockOffset:F.options.SystemClockOffset,ForceSignHost:C},function(Ee){typeof Ee=="string"&&(Ee={Authorization:Ee});var ke=it(Ee);if(ke)return P(ke);Ee.Authorization?P(null,Ee):(J=Ee||{},J.Scope=Be,J.ScopeKey=De,F._StsCache.push(J),Ve())});else if(F.options.getSTS)F.options.getSTS.call(F,{Bucket:q,Region:fe},function(Ee){J=Ee||{},J.Scope=Be,J.ScopeKey=De,J.TmpSecretId||(J.TmpSecretId=J.SecretId),J.TmpSecretKey||(J.TmpSecretKey=J.SecretKey);var ke=it(J);if(ke)return P(ke);F._StsCache.push(J),Ve()});else return function(){var Ee="";if(F.options.StartTime&&e.Expires){if(F.options.StartTime.toString().length!==10)return P(r.error(new Error('params "StartTime" should be 10 digits')));Ee=F.options.StartTime+";"+(F.options.StartTime+e.Expires*1)}else if(F.options.StartTime&&F.options.ExpiredTime){if(F.options.StartTime.toString().length!==10)return P(r.error(new Error('params "StartTime" should be 10 digits')));if(F.options.ExpiredTime.toString().length!==10)return P(r.error(new Error('params "ExpiredTime" should be 10 digits')));Ee=F.options.StartTime+";"+F.options.ExpiredTime*1}var ke=r.getAuth({SecretId:e.SecretId||F.options.SecretId,SecretKey:e.SecretKey||F.options.SecretKey,Method:e.Method,Pathname:Re,Query:e.Query,Headers:o,Expires:e.Expires,KeyTime:Ee,UseRawKey:F.options.UseRawKey,SystemClockOffset:F.options.SystemClockOffset,ForceSignHost:C}),Ae={Authorization:ke,SecurityToken:F.options.SecurityToken||F.options.XCosSecurityToken,SignFrom:"client"};return P(null,Ae),Ae}();return""}function Nt(e){var g=this,o=!1,u=!1,C=!1,y=e.headers&&(e.headers.date||e.headers.Date)||e.error&&e.error.ServerTime;try{var P=e.error.Code,F=e.error.Message;(P==="RequestTimeTooSkewed"||P==="AccessDenied"&&F==="Request has expired")&&(u=!0)}catch{}if(e)if(u&&y){var q=Date.parse(y);this.options.CorrectClockSkew&&Math.abs(r.getSkewTime(this.options.SystemClockOffset)-q)>=3e4&&(console.error("error: Local time is too skewed."),this.options.SystemClockOffset=q-Date.now(),o=!0)}else Math.floor(e.statusCode/100)===5?(o=!0,C=!1):(e.message==="timeout"||e.message==="CORS blocked or network error")&&(o=!0,C=g.options.AutoSwitchHost);return{canRetry:o,networkError:C}}function Ft(e){var g=e.requestUrl,o=e.clientCalcSign,u=e.networkError;if(!this.options.AutoSwitchHost||!g||!o||!u)return!1;var C=/^https?:\/\/[^\/]*\.cos\.[^\/]*\.myqcloud\.com(\/.*)?$/,y=/^https?:\/\/[^\/]*\.cos\.accelerate\.myqcloud\.com(\/.*)?$/,P=C.test(g)&&!y.test(g);return P}function te(e,g){var o=this;!e.headers&&(e.headers={}),!e.qs&&(e.qs={}),e.VersionId&&(e.qs.versionId=e.VersionId),e.qs=r.clearKey(e.qs),e.headers&&(e.headers=r.clearKey(e.headers)),e.qs&&(e.qs=r.clearKey(e.qs));var u=r.clone(e.qs);e.action&&(u[e.action]="");var C=e.url||e.Url,y=e.SignHost||ft.call(this,{Bucket:e.Bucket,Region:e.Region,Url:C}),P=e.tracker,F=function(fe){var ue=o.options.SystemClockOffset;P&&P.setParams({signStartTime:new Date().getTime(),httpRetryTimes:fe-1}),e.SwitchHost&&(y=y.replace(/myqcloud.com/,"tencentcos.cn"));var Re=w(w({},e),{},{Query:u,SignHost:y,ForceSignHost:o.options.ForceSignHost});delete Re.tracker,o.logger.debug({cate:"PROCESS",tag:"base",msg:"开始计算签名, opt=".concat(JSON.stringify(Re))}),mt.call(o,{Bucket:e.Bucket||"",Region:e.Region||"",Method:e.method,Key:e.Key,Query:u,Headers:e.headers,SignHost:y,Action:e.Action,ResourceKey:e.ResourceKey,Scope:e.Scope,ForceSignHost:o.options.ForceSignHost,SwitchHost:e.SwitchHost},function(J,Be){if(J){o.logger.error({cate:"PROCESS",tag:"base",msg:"签名获取失败, err=".concat(JSON.stringify(J.message))}),g(J);return}P&&P.setParams({signEndTime:new Date().getTime(),httpStartTime:new Date().getTime()}),e.AuthData=Be,o.logger.debug({cate:"PROCESS",tag:"base",msg:"签名获取成功"}),o.logger.info({cate:"PROCESS",tag:"base",msg:"准备发起请求"}),Mt.call(o,e,function(Me,He){P&&P.setParams({httpEndTime:new Date().getTime()});var De=!1,Ve=!1;if(Me){var it=Nt.call(o,Me);De=it.canRetry||ue!==o.options.SystemClockOffset,Ve=it.networkError,o.logger.error({cate:"PROCESS",tag:"network",msg:"请求失败, err=".concat(JSON.stringify(Me),", canRetry=").concat(De,", networkError=").concat(Ve,", tryTimes=").concat(fe)})}if(Me&&fe<4&&De){e.headers&&(delete e.headers.Authorization,delete e.headers.token,delete e.headers.clientIP,delete e.headers.clientUA,e.headers["x-cos-security-token"]&&delete e.headers["x-cos-security-token"],e.headers["x-ci-security-token"]&&delete e.headers["x-ci-security-token"]);var Ee=Ft.call(o,{requestUrl:(Me==null?void 0:Me.url)||"",clientCalcSign:Be.SignFrom==="client",networkError:Ve});e.SwitchHost=Ee,e.headers["x-cos-sdk-retry"]=!0,o.logger.info({cate:"PROCESS",tag:"base",msg:"重试请求, 重试第".concat(fe,"次")}),F(fe+1)}else o.logger.info({cate:"PROCESS",tag:"base",msg:"请求完成"}),g(Me,He)})})};F(1)}function Mt(e,g){var o=this,u=e.TaskId;if(!(u&&!o._isRunningTask(u))){var C=e.Bucket,y=e.Region,P=e.Key,F=e.method||"GET",q=e.Url||e.url,fe=e.body,ue=e.rawBody;o.options.UseAccelerate&&(y="accelerate"),q=q||Xe({ForcePathStyle:o.options.ForcePathStyle,protocol:o.options.Protocol,domain:o.options.Domain,bucket:C,region:y,object:P}),e.SwitchHost&&(q=q.replace(/myqcloud.com/,"tencentcos.cn"));var Re=P?q:"";e.action&&(q=q+"?"+(r.isIOS_QQ?"".concat(e.action,"="):e.action)),e.qsStr&&(q.indexOf("?")>-1?q=q+"&"+e.qsStr:q=q+"?"+e.qsStr);var J={method:F,url:q,headers:e.headers,qs:e.qs,body:fe},Be="x-cos-security-token";if(r.isCIHost(q)&&(Be="x-ci-security-token"),J.headers.Authorization=e.AuthData.Authorization,e.AuthData.Token&&(J.headers.token=e.AuthData.Token),e.AuthData.ClientIP&&(J.headers.clientIP=e.AuthData.ClientIP),e.AuthData.ClientUA&&(J.headers.clientUA=e.AuthData.ClientUA),e.AuthData.SecurityToken&&(J.headers[Be]=e.AuthData.SecurityToken),e.Action&&(J.action=e.Action),J.key=e.Key||e.ResourceKey,J.headers&&(J.headers=r.clearKey(J.headers)),J=r.clearKey(J),e.onProgress&&typeof e.onProgress=="function"){var Me=fe&&(fe.size||fe.length)||0;J.onProgress=function(Te){if(!(u&&!o._isRunningTask(u))){var Je=Te?Te.loaded:0;e.onProgress({loaded:Je,total:Me})}}}e.onDownloadProgress&&(J.onDownloadProgress=e.onDownloadProgress),e.DataType&&(J.dataType=e.DataType),this.options.Timeout&&(J.timeout=this.options.Timeout),o.options.ForcePathStyle&&(J.pathStyle=o.options.ForcePathStyle);var He=r.uuid();o.logger.info({cate:"PROCESS",tag:"network",msg:"[Request] ".concat(He,", requestOpt=").concat(JSON.stringify(J))}),o.emit("before-send",J);var De=J.url.includes("accelerate."),Ve=J.qs?Object.keys(J.qs).map(function(Te){return"".concat(Te,"=").concat(J.qs[Te])}).join("&"):"",it=Ve?J.url+"?"+Ve:J.url;if(e.tracker){var Ee;e.tracker.setParams({url:it,httpMethod:J.method,accelerate:De,httpSize:((Ee=J.body)===null||Ee===void 0?void 0:Ee.size)||0}),e.tracker.parent&&!e.tracker.parent.params.url&&e.tracker.parent.setParams({url:Re,accelerate:De})}var ke=(o.options.Request||O)(J,function(Te){if(!(Te&&Te.error==="abort")){var Je={options:J,error:Te&&Te.error,statusCode:Te&&Te.statusCode||0,statusMessage:Te&&Te.statusMessage||"",headers:Te&&Te.headers||{},body:Te&&Te.body};o.emit("after-receive",Je);var _t=Je.error,kt=Je.body,st={statusCode:Je.statusCode,statusMessage:Je.statusMessage,headers:Je.headers},mn=_t?"[error]":"[success]";o.logger.info({cate:"PROCESS",tag:"network",msg:"[Response] ".concat(He,", ").concat(mn,", response=").concat(JSON.stringify(st))});var Dt,ut=function(ct,ze){if(u&&o.off("inner-kill-task",Ae),!Dt){Dt=!0;var gt={};if(st&&st.statusCode&&(gt.statusCode=st.statusCode),st&&st.headers&&(gt.headers=st.headers),ct)J.url&&(gt.url=J.url),J.method&&(gt.method=J.method),ct=r.extend(ct||{},gt),g(ct,null);else{if(e.Action==="name/cos:PutObject"){var Kt={};for(var Gt in e.headers){var kn=Gt.toLowerCase();Kt[kn]=e.headers[Gt]}Kt["x-cos-callback"]?ze.Error?(ze.CallbackError=r.clone(ze.Error),delete ze.Error):ze.CallbackBody=r.clone(ze):Kt["x-cos-return-body"]&&(ze.Error?(ze.ReturnError=r.clone(ze.Error),delete ze.Error):ze.ReturnBody=r.clone(ze))}ze=r.extend(ze||{},gt),g(null,ze)}ke=null}};if(_t)return ut(r.error(_t));var St=st.statusCode,Vt=Math.floor(St/100)===2;if(ue){if(Vt)return ut(null,{body:kt});if(kt instanceof Blob){r.readAsBinaryString(kt,function(qt){var ct=r.parseResBody(qt),ze=ct.Error||ct;return ut(r.error(new Error(ze.Message||"response body error"),{code:ze.Code,error:ze}))});return}}var zt=r.parseResBody(kt),bt=zt.Error||zt;Vt?ut(null,zt):bt?ut(r.error(new Error(bt.Message),{code:bt.Code,error:bt})):St?ut(r.error(new Error(st.statusMessage),{code:""+St})):St&&ut(r.error(new Error("statusCode error")))}}),Ae=function(Je){Je.TaskId===u&&(ke&&ke.abort&&ke.abort(),o.off("inner-kill-task",Ae))};u&&o.on("inner-kill-task",Ae)}}var $t={getService:h,putBucket:f,headBucket:S,getBucket:d,deleteBucket:p,putBucketAcl:T,getBucketAcl:E,putBucketCors:L,getBucketCors:N,deleteBucketCors:D,getBucketLocation:j,getBucketPolicy:a,putBucketPolicy:c,deleteBucketPolicy:b,putBucketTagging:i,getBucketTagging:n,deleteBucketTagging:t,putBucketLifecycle:s,getBucketLifecycle:l,deleteBucketLifecycle:v,putBucketVersioning:M,getBucketVersioning:x,putBucketReplication:H,getBucketReplication:$,deleteBucketReplication:Y,putBucketWebsite:ee,getBucketWebsite:re,deleteBucketWebsite:ie,putBucketReferer:me,getBucketReferer:de,putBucketDomain:le,getBucketDomain:ne,deleteBucketDomain:Q,putBucketOrigin:oe,getBucketOrigin:ge,deleteBucketOrigin:he,putBucketLogging:se,getBucketLogging:ce,putBucketInventory:Ce,postBucketInventory:Se,getBucketInventory:Oe,listBucketInventory:xe,deleteBucketInventory:Ne,putBucketAccelerate:et,getBucketAccelerate:qe,putBucketEncryption:rt,getBucketEncryption:at,deleteBucketEncryption:Ge,getObject:Et,headObject:ot,listObjectVersions:vt,putObject:Ot,deleteObject:At,getObjectAcl:It,putObjectAcl:Ut,optionsObject:Lt,putObjectCopy:jt,deleteMultipleObject:W,restoreObject:I,putObjectTagging:_,getObjectTagging:z,deleteObjectTagging:X,selectObjectContent:Z,appendObject:We,uploadPartCopy:$e,multipartInit:ae,multipartUpload:ve,multipartComplete:be,multipartList:Pe,multipartListPart:Ie,multipartAbort:_e,request:je,getObjectUrl:Qe,getAuth:lt};function Cn(e,g,o){r.each(["Cors","Acl"],function(u){if(e.slice(-u.length)===u){var C=e.slice(0,-u.length)+u.toUpperCase(),y=r.apiWrapper(e,g),P=!1;o[C]=function(){!P&&console.warn("warning: cos."+C+" has been deprecated. Please Use cos."+e+" instead."),P=!0,y.apply(this,arguments)}}})}U.exports.init=function(e,g){g.transferToTaskMethod($t,"putObject"),r.each($t,function(o,u){e.prototype[u]=r.apiWrapper(u,o),Cn(u,o,e.prototype)})}},"./src/cos.js":function(U,K,k){var R=k("./src/util.js"),m=k("./src/event.js"),A=k("./src/task.js"),w=k("./src/base.js"),O=k("./src/advance.js"),r=k("./src/logger.js"),h=k("./package.json"),f={AppId:"",SecretId:"",SecretKey:"",SecurityToken:"",StartTime:0,ExpiredTime:0,ChunkRetryTimes:2,FileParallelLimit:3,ChunkParallelLimit:3,ChunkSize:1024*1024,SliceSize:1024*1024,CopyChunkParallelLimit:20,CopyChunkSize:1024*1024*10,CopySliceSize:1024*1024*10,MaxPartNumber:1e4,ProgressInterval:1e3,Domain:"",ServiceDomain:"",Protocol:"",CompatibilityMode:!1,ForcePathStyle:!1,UseRawKey:!1,Timeout:0,CorrectClockSkew:!0,SystemClockOffset:0,UploadCheckContentMd5:!1,UploadQueueSize:1e4,UploadAddMetaMd5:!1,UploadIdCacheLimit:50,UseAccelerate:!1,ForceSignHost:!0,AutoSwitchHost:!0,CopySourceParser:null,ObjectKeySimplifyCheck:!0,DeepTracker:!1,TrackerDelay:5e3,CustomId:"",BeaconReporter:null,ClsReporter:null,EnableLog:!1,EnableLogcat:!1,LogLevel:"VERBOSE",ClsLogger:null,LogExtras:{}},S=function(p){var T,E,L=this;if(this.options=R.extend(R.clone(f),p||{}),this.options.FileParallelLimit=Math.max(1,this.options.FileParallelLimit),this.options.ChunkParallelLimit=Math.max(1,this.options.ChunkParallelLimit),this.options.ChunkRetryTimes=Math.max(0,this.options.ChunkRetryTimes),this.options.ChunkSize=Math.max(1024*1024,this.options.ChunkSize),this.options.CopyChunkParallelLimit=Math.max(1,this.options.CopyChunkParallelLimit),this.options.CopyChunkSize=Math.max(1024*1024,this.options.CopyChunkSize),this.options.CopySliceSize=Math.max(0,this.options.CopySliceSize),this.options.MaxPartNumber=Math.max(1024,Math.min(1e4,this.options.MaxPartNumber)),this.options.Timeout=Math.max(0,this.options.Timeout),this.options.EnableReporter=this.options.BeaconReporter||this.options.ClsReporter,this.options.AppId&&console.warn('warning: AppId has been deprecated, Please put it at the end of parameter Bucket(E.g: "test-1250000000").'),this.options.SecretId&&this.options.SecretId.indexOf(" ")>-1&&(console.error("error: SecretId格式错误，请检查"),console.error("error: SecretId format is incorrect. Please check")),this.options.SecretKey&&this.options.SecretKey.indexOf(" ")>-1&&(console.error("error: SecretKey格式错误，请检查"),console.error("error: SecretKey format is incorrect. Please check")),R.isNode()&&(console.log("Tip: Next.js、Nuxt.js 等服务端渲染技术可正常使用JavaScript SDK，请忽略下方 nodejs 环境警告"),console.warn("warning: cos-js-sdk-v5 不支持 nodejs 环境使用，请改用 cos-nodejs-sdk-v5，参考文档： https://cloud.tencent.com/document/product/436/8629"),console.warn("warning: cos-js-sdk-v5 does not support nodejs environment. Please use cos-nodejs-sdk-v5 instead. See: https://cloud.tencent.com/document/product/436/8629")),this.options.ForcePathStyle)throw console.warn("cos-js-sdk-v5不再支持使用path-style，仅支持使用virtual-hosted-style，参考文档：https://cloud.tencent.com/document/product/436/96243"),new Error("ForcePathStyle is not supported");m.init(this),A.init(this),this.logger=new r({enableLog:this.options.EnableLog,enableLogcat:this.options.EnableLogcat,level:(T=this.options.LogLevel)!==null&&T!==void 0?T:"VERBOSE",clsLogger:this.options.ClsLogger,logExtras:(E=this.options.LogExtras)!==null&&E!==void 0?E:{}}),this.options.EnableLog&&(m.init(this.logger),this.logger.on("log-message",function(N){L.emit("log-message",N)}))};w.init(S,A),O.init(S,A),S.util={md5:R.md5,xml2json:R.xml2json,json2xml:R.json2xml,encodeBase64:R.encodeBase64},S.getAuthorization=R.getAuth,S.version=h.version,U.exports=S},"./src/event.js":function(U,K){var k=function(A){var w={},O=function(h){return!w[h]&&(w[h]=[]),w[h]};A.on=function(r,h){r==="task-list-update"&&console.warn('warning: Event "'+r+'" has been deprecated. Please use "list-update" instead.'),O(r).push(h)},A.off=function(r,h){for(var f=O(r),S=f.length-1;S>=0;S--)h===f[S]&&f.splice(S,1)},A.emit=function(r,h){for(var f=O(r).map(function(d){return d}),S=0;S<f.length;S++)f[S](h)}},R=function(){k(this)};U.exports.init=k,U.exports.EventProxy=R},"./src/logger.js":function(U,K,k){var R=k("./node_modules/@babel/runtime/helpers/classCallCheck.js"),m=k("./node_modules/@babel/runtime/helpers/createClass.js"),A=k("./node_modules/@babel/runtime/helpers/defineProperty.js"),w=k("./package.json"),O=w.version,r=["VERBOSE","DEBUG","INFO","WARN","ERROR"],h=function(){function f(S){var d;R(this,f),A(this,"level","VERBOSE"),A(this,"clsLogger",null),A(this,"logExtras",{}),this.enableLog=(d=S.enableLog)!==null&&d!==void 0?d:!1,this.level=S.level||"VERBOSE",r.includes(this.level)||(this.level="VERBOSE"),this.enableLogcat=S.enableLogcat,this.clsLogger=S.clsLogger,this.logExtras=S.logExtras}return m(f,[{key:"info",value:function(){if(["VERBOSE","INFO"].includes(this.level)){for(var d=arguments.length,p=new Array(d),T=0;T<d;T++)p[T]=arguments[T];this.log.apply(this,["info"].concat(p))}}},{key:"debug",value:function(){if(["VERBOSE","DEBUG"].includes(this.level)){for(var d=arguments.length,p=new Array(d),T=0;T<d;T++)p[T]=arguments[T];this.log.apply(this,["debug"].concat(p))}}},{key:"warn",value:function(){if(["VERBOSE","WARN"].includes(this.level)){for(var d=arguments.length,p=new Array(d),T=0;T<d;T++)p[T]=arguments[T];this.log.apply(this,["warn"].concat(p))}}},{key:"error",value:function(){if(["VERBOSE","ERROR"].includes(this.level)){for(var d=arguments.length,p=new Array(d),T=0;T<d;T++)p[T]=arguments[T];this.log.apply(this,["error"].concat(p))}}},{key:"log",value:function(){if(this.enableLog){var d=arguments.length<=0?void 0:arguments[0],p=arguments.length<=1?void 0:arguments[1],T=p.cate,E=T===void 0?"base":T,L=p.tag,N=L===void 0?"base":L,D=p.msg,j={version:"cos-js-sdk-v5-".concat(O),timestamp:new Date().toISOString(),cate:"[".concat(E.toUpperCase(),"]"),tag:"[".concat(N.toUpperCase(),"]"),msg:D,extras:this.logExtras};this.enableLogcat&&console[d]("[".concat(j.version,"] ").concat(j.timestamp," ").concat(j.cate," ").concat(j.tag," ").concat(j.msg," ").concat(j.extras?JSON.stringify(j.extras):"")),this.clsLogger&&this.clsLogger.log(j,!1),this.emit("log-message",j)}}}])}();U.exports=h},"./src/session.js":function(U,K,k){var R=k("./src/util.js"),m="cos_sdk_upload_cache",A=30*24*3600,w,O,r=function(){try{var T=JSON.parse(localStorage.getItem(m))}catch{}T||(T=[]),w=T},h=function(){try{w.length?localStorage.setItem(m,JSON.stringify(w)):localStorage.removeItem(m)}catch{}},f=function(){if(!w){r.call(this);for(var T=!1,E=Math.round(Date.now()/1e3),L=w.length-1;L>=0;L--){var N=w[L][2];(!N||N+A<E)&&(w.splice(L,1),T=!0)}T&&h()}},S=function(){O||(O=setTimeout(function(){h(),O=null},400))},d={using:{},setUsing:function(T){d.using[T]=!0},removeUsing:function(T){delete d.using[T]},getFileId:function(T,E,L,N){return T.name&&T.size&&T.lastModifiedDate&&E?R.md5([T.name,T.size,T.lastModifiedDate,E,L,N].join("::")):null},getCopyFileId:function(T,E,L,N,D){var j=E["content-length"],c=E.etag||"",a=E["last-modified"];return T&&L?R.md5([T,j,c,a,L,N,D].join("::")):null},getUploadIdList:function(T){if(!T)return null;f.call(this);for(var E=[],L=0;L<w.length;L++)w[L][0]===T&&E.push(w[L][1]);return E.length?E:null},saveUploadId:function(T,E,L){if(f.call(this),!!T){for(var N=w.length-1;N>=0;N--){var D=w[N];D[0]===T&&D[1]===E&&w.splice(N,1)}w.unshift([T,E,Math.round(Date.now()/1e3)]),w.length>L&&w.splice(L),S()}},removeUploadId:function(T){f.call(this),delete d.using[T];for(var E=w.length-1;E>=0;E--)w[E][1]===T&&w.splice(E,1);S()}};U.exports=d},"./src/task.js":function(U,K,k){var R=k("./src/session.js"),m=k("./src/util.js"),A={},w=function(h,f){A[f]=h[f],h[f]=function(S,d){S.SkipTask?A[f].call(this,S,d):this._addTask(f,S,d)}},O=function(h){var f=[],S={},d=0,p=0,T=function(a){var b={id:a.id,Bucket:a.Bucket,Region:a.Region,Key:a.Key,FilePath:a.FilePath,state:a.state,loaded:a.loaded,size:a.size,speed:a.speed,percent:a.percent,hashPercent:a.hashPercent,error:a.error};return a.FilePath&&(b.FilePath=a.FilePath),a._custom&&(b._custom=a._custom),b},E=function(){var c,a=function(){c=0,h.emit("task-list-update",{list:m.map(f,T)}),h.emit("list-update",{list:m.map(f,T)})};return function(){c||(c=setTimeout(a))}}(),L=function(){if(!(f.length<=h.options.UploadQueueSize)){for(var a=0;a<p&&a<f.length&&f.length>h.options.UploadQueueSize;){var b=f[a].state==="waiting"||f[a].state==="checking"||f[a].state==="uploading";!f[a]||!b?(S[f[a].id]&&delete S[f[a].id],f.splice(a,1),p--):a++}E()}},N=function(){if(!(d>=h.options.FileParallelLimit)){for(;f[p]&&f[p].state!=="waiting";)p++;if(!(p>=f.length)){var a=f[p];p++,d++,a.state="checking",a.params.onTaskStart&&a.params.onTaskStart(T(a)),!a.params.UploadData&&(a.params.UploadData={});var b=m.formatParams(a.api,a.params);A[a.api].call(h,b,function(i,n){h._isRunningTask(a.id)&&((a.state==="checking"||a.state==="uploading")&&(a.state=i?"error":"success",i&&(a.error=i),d--,E(),N(),a.callback&&a.callback(i,n),a.state==="success"&&(a.params&&(delete a.params.UploadData,delete a.params.Body,delete a.params),delete a.callback)),L())}),E(),setTimeout(N)}}},D=function(a,b){var i=S[a];if(i){var n=i&&i.state==="waiting",t=i&&(i.state==="checking"||i.state==="uploading");if(b==="canceled"&&i.state!=="canceled"||b==="paused"&&n||b==="paused"&&t){i.state=b,h.emit("inner-kill-task",{TaskId:a,toState:b});try{var s=i&&i.params&&i.params.UploadData.UploadId}catch{}b==="canceled"&&s&&R.removeUsing(s),E(),t&&(d--,N()),b==="canceled"&&(i.params&&(delete i.params.UploadData,delete i.params.Body,delete i.params),delete i.callback)}L()}};h._addTasks=function(c){m.each(c,function(a){h._addTask(a.api,a.params,a.callback,!0)}),E()};var j=!0;h._addTask=function(c,a,b,i){a=m.formatParams(c,a);var n=m.uuid();a.TaskId=n,a.onTaskReady&&a.onTaskReady(n),a.TaskReady&&(a.TaskReady(n),j&&console.warn('warning: Param "TaskReady" has been deprecated. Please use "onTaskReady" instead.'),j=!1);var t={params:a,callback:b,api:c,index:f.length,id:n,Bucket:a.Bucket,Region:a.Region,Key:a.Key,FilePath:a.FilePath||"",state:"waiting",loaded:0,size:0,speed:0,percent:0,hashPercent:0,error:null,_custom:a._custom},s=a.onHashProgress;a.onHashProgress=function(v){h._isRunningTask(t.id)&&(t.hashPercent=v.percent,s&&s(v),E())};var l=a.onProgress;return a.onProgress=function(v){h._isRunningTask(t.id)&&(t.state==="checking"&&(t.state="uploading"),t.loaded=v.loaded,t.speed=v.speed,t.percent=v.percent,l&&l(v),E())},m.getFileSize(c,a,function(v,M){if(v)return b(m.error(v));S[n]=t,f.push(t),t.size=M,!i&&E(),N(),L()}),n},h._isRunningTask=function(c){var a=S[c];return!!(a&&(a.state==="checking"||a.state==="uploading"))},h.getTaskList=function(){return m.map(f,T)},h.cancelTask=function(c){D(c,"canceled")},h.pauseTask=function(c){D(c,"paused")},h.restartTask=function(c){var a=S[c];a&&(a.state==="paused"||a.state==="error")&&(a.state="waiting",E(),p=Math.min(p,a.index),N())},h.isUploadRunning=function(){return d||p<f.length}};U.exports.transferToTaskMethod=w,U.exports.init=O},"./src/tracker.js":function(U,K,k){var R=k("./node_modules/@babel/runtime/helpers/classCallCheck.js"),m=k("./node_modules/@babel/runtime/helpers/createClass.js"),A=k("./node_modules/@babel/runtime/helpers/typeof.js"),w=k("./package.json"),O=null,r=function(b,i){if(!O){if(typeof b!="function")throw new Error("Beacon not found");O=new b({appkey:"0WEB05PY6MHRGK0U",versionCode:w.version,channelID:"js_sdk",openid:"openid",unionid:"unid",strictMode:!1,delay:i,sessionDuration:60*1e3})}return O},h=function(b){return!b||b<0?0:(b/1e3).toFixed(3)},f={getUid:function(){var b=function(){return((1+Math.random())*65536|0).toString(16).substring(1)};return b()+b()+"-"+b()+"-"+b()+"-"+b()+"-"+b()+b()+b()},getNetType:function(){if((typeof navigator>"u"?"undefined":A(navigator))==="object"){var b=navigator.connection||navigator.mozConnection||navigator.webkitConnection;return(b==null?void 0:b.type)||(b==null?void 0:b.effectiveType)||"unknown"}return"unknown"},getProtocol:function(){return(typeof location>"u"?"undefined":A(location))==="object"?location.protocol.replace(/:/,""):"unknown protocol"},getOsType:function(){if((typeof navigator>"u"?"undefined":A(navigator))!=="object")return"unknown os";var b=navigator.userAgent.toLowerCase(),i=/macintosh|mac os x/i.test(navigator.userAgent);return b.indexOf("win32")>=0||b.indexOf("wow32")>=0?"win32":b.indexOf("win64")>=0||b.indexOf("wow64")>=0?"win64":i?"mac":"unknown os"},isMobile:function(){var b=/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i;return!!((typeof navigator>"u"?"undefined":A(navigator))==="object"&&navigator.userAgent.match(b))},isAndroid:function(){var b=/(Android|Adr|Linux)/i;return!!((typeof navigator>"u"?"undefined":A(navigator))==="object"&&navigator.userAgent.match(b))},isIOS:function(){var b=/(iPhone|iPod|iPad|iOS)/i;return!!((typeof navigator>"u"?"undefined":A(navigator))==="object"&&navigator.userAgent.match(b))},isOtherMobile:function(){return S&&!isAndroid&&!isIOS},getUA:function(){if((typeof navigator>"u"?"undefined":A(navigator))!=="object")return"unknown device";var b=navigator.userAgent;return b}},S=f.isMobile(),d=f.isAndroid()?"android":f.isIOS?"ios":"other_mobile",p=f.getOsType(),T=S?d:p,E=f.getUA(),L=f.getProtocol(),N=function(b){return["putObject","sliceUploadFile","uploadFile","uploadFiles"].includes(b)?"UploadTask":b==="getObject"?"DownloadTask":["putObjectCopy","sliceCopyFile"].includes(b)?"CopyTask":b};function D(a){return a.replace(/([A-Z])/g,"_$1").toLowerCase()}function j(a){var b={},i=["sdkVersionName","sdkVersionCode","osName","networkType","requestName","requestResult","bucket","region","appid","accelerate","url","host","requestPath","userAgent","networkProtocol","httpMethod","httpSize","httpSpeed","httpTookTime","httpMd5","httpSign","httpFullTime","httpDomain","partNumber","httpRetryTimes","customId","traceId","realApi"],n=[].concat(i,["errorNode","errorCode","errorName","errorMessage","errorRequestId","errorHttpCode","errorServiceName","errorType","fullError"]),t=a.requestResult==="Success"?i:n;for(var s in a)if(t.includes(s)){var l=D(s);b[l]=a[s]}return b.request_name=a.realApi?N(a.realApi):a.requestName,b}var c=function(){function a(b){R(this,a);var i=b.parent,n=b.traceId,t=b.bucket,s=b.region,l=b.apiName,v=b.realApi,M=b.httpMethod,x=b.fileKey,H=b.fileSize,$=b.accelerate,Y=b.customId,ee=b.delay,re=b.deepTracker,ie=b.Beacon,me=b.clsReporter,de=t&&t.substr(t.lastIndexOf("-")+1)||"";this.parent=i,this.deepTracker=re,this.delay=ee,me&&!this.clsReporter&&(this.clsReporter=me),this.params={sdkVersionName:"cos-js-sdk-v5",sdkVersionCode:w.version,osName:T,networkType:"",requestName:l||"",requestResult:"",realApi:v,bucket:t,region:s,accelerate:$,httpMethod:M,url:"",host:"",httpDomain:"",requestPath:x||"",userAgent:E,networkProtocol:L,errorType:"",errorCode:"",errorName:"",errorMessage:"",errorRequestId:"",errorHttpCode:0,errorServiceName:"",errorNode:"",httpTookTime:0,httpSize:H||0,httpMd5:0,httpSign:0,httpFullTime:0,httpSpeed:0,md5StartTime:0,md5EndTime:0,signStartTime:0,signEndTime:0,httpStartTime:0,httpEndTime:0,startTime:new Date().getTime(),endTime:0,traceId:n||f.getUid(),appid:de,partNumber:0,httpRetryTimes:0,customId:Y||"",partTime:0},ie&&(this.beacon=r(ie,ee))}return m(a,[{key:"formatResult",value:function(i,n){var t,s,l,v,M,x,H=new Date().getTime(),$=f.getNetType(),Y=i?(i==null?void 0:i.code)||(i==null||(t=i.error)===null||t===void 0?void 0:t.code)||(i==null||(s=i.error)===null||s===void 0?void 0:s.Code):"",ee=i?(i==null?void 0:i.message)||(i==null||(l=i.error)===null||l===void 0?void 0:l.message)||(i==null||(v=i.error)===null||v===void 0?void 0:v.Message):"",re=ee,ie=i?(i==null?void 0:i.resource)||(i==null||(M=i.error)===null||M===void 0?void 0:M.resource)||(i==null||(x=i.error)===null||x===void 0?void 0:x.Resource):"",me=i?i==null?void 0:i.statusCode:n.statusCode,de=i?(i==null?void 0:i.headers)&&(i==null?void 0:i.headers["x-cos-request-id"]):(n==null?void 0:n.headers)&&(n==null?void 0:n.headers["x-cos-request-id"]),le=i?de?"Server":"Client":"";this.params.requestName==="getObject"&&(this.params.httpSize=n?n.headers&&n.headers["content-length"]:0);var ne=this.params.realApi==="sliceUploadFile",Q=this.params.realApi==="sliceCopyFile";if(ne||Q){var oe=this.params.httpSize/1024/this.params.partTime;Object.assign(this.params,{httpSpeed:oe<0?0:oe.toFixed(3)})}else{var ge=H-this.params.startTime,he=this.params.httpEndTime-this.params.httpStartTime,se=this.params.httpSize/1024/(he/1e3),ce=this.params.md5EndTime-this.params.md5StartTime,ye=this.params.signEndTime-this.params.signStartTime;this.parent&&(this.parent.addParamValue("httpTookTime",h(he)),this.parent.addParamValue("httpFullTime",h(ge)),this.parent.addParamValue("httpMd5",h(ce)),this.parent.addParamValue("httpSign",h(ye)),["multipartUpload","uploadPartCopy","putObjectCopy"].includes(this.params.requestName)&&this.parent.addParamValue("partTime",h(he))),Object.assign(this.params,{httpFullTime:h(ge),httpMd5:h(ce),httpSign:h(ye),httpTookTime:h(he),httpSpeed:se<0?0:se.toFixed(3)})}if(Object.assign(this.params,{networkType:$,requestResult:i?"Failure":"Success",errorType:le,errorCode:Y,errorHttpCode:me,errorName:re,errorMessage:ee,errorServiceName:ie,errorRequestId:de}),i&&(!Y||!ee)&&(this.params.fullError=i?JSON.stringify(i):""),this.params.url){try{var Ce=/^http(s)?:\/\/(.*?)\//.exec(this.params.url);this.params.host=Ce[2]}catch{this.params.host=this.params.url}this.params.httpDomain=this.params.host}}},{key:"report",value:function(i,n){if(!(!this.beacon&&!this.clsReporter)){this.formatResult(i,n);var t=j(this.params);this.beacon&&this.sendEventsToBeacon(t),this.clsReporter&&this.sendEventsToCLS(t)}}},{key:"setParams",value:function(i){Object.assign(this.params,i)}},{key:"addParamValue",value:function(i,n){this.params[i]=(+this.params[i]+ +n).toFixed(3)}},{key:"sendEventsToBeacon",value:function(i){var n=this.params.requestName==="sliceUploadFile"||this.params.realApi==="sliceUploadFile";if(!(n&&!this.deepTracker)){var t="qcloud_track_cos_sdk";this.delay===0?this.beacon&&this.beacon.onDirectUserAction(t,i):this.beacon&&this.beacon.onUserAction(t,i)}}},{key:"sendEventsToCLS",value:function(i){var n=this.delay===0;this.clsReporter.log(i,n)}},{key:"generateSubTracker",value:function(i){return Object.assign(i,{parent:this,deepTracker:this.deepTracker,traceId:this.params.traceId,bucket:this.params.bucket,region:this.params.region,accelerate:this.params.accelerate,fileKey:this.params.requestPath,customId:this.params.customId,delay:this.delay,clsReporter:this.clsReporter}),new a(i)}}])}();U.exports=c},"./src/util.js":function(U,K,k){(function(R){var m=k("./node_modules/@babel/runtime/helpers/typeof.js");function A(W,I){var _=typeof Symbol<"u"&&W[Symbol.iterator]||W["@@iterator"];if(!_){if(Array.isArray(W)||(_=w(W))||I){_&&(W=_);var z=0,X=function(){};return{s:X,n:function(){return z>=W.length?{done:!0}:{done:!1,value:W[z++]}},e:function(Pe){throw Pe},f:X}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var Z,ae=!0,ve=!1;return{s:function(){_=_.call(W)},n:function(){var Pe=_.next();return ae=Pe.done,Pe},e:function(Pe){ve=!0,Z=Pe},f:function(){try{ae||_.return==null||_.return()}finally{if(ve)throw Z}}}}function w(W,I){if(W){if(typeof W=="string")return O(W,I);var _={}.toString.call(W).slice(8,-1);return _==="Object"&&W.constructor&&(_=W.constructor.name),_==="Map"||_==="Set"?Array.from(W):_==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(_)?O(W,I):void 0}}function O(W,I){(I==null||I>W.length)&&(I=W.length);for(var _=0,z=Array(I);_<I;_++)z[_]=W[_];return z}var r=k("./lib/md5.js"),h=k("./lib/crypto.js"),f=k("./node_modules/fast-xml-parser/src/fxp.js"),S=f.XMLParser,d=f.XMLBuilder,p=new S({ignoreDeclaration:!0,ignoreAttributes:!0,parseTagValue:!1,trimValues:!1}),T=new d,E=k("./lib/base64.js"),L=k("./src/tracker.js"),N="#text",D=function(I){if(ge(I))for(var _ in I){var z=I[_];typeof z=="string"?_===N&&delete I[_]:Array.isArray(z)?z.forEach(function(X){D(X)}):ge(z)&&D(z)}},j=function(I){var _=p.parse(I);return D(_),_},c=function(I){var _=T.build(I);return _};function a(W){return encodeURIComponent(W).replace(/!/g,"%21").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/\*/g,"%2A")}function b(W,I){var _=[];for(var z in W)W.hasOwnProperty(z)&&_.push(I?a(z).toLowerCase():z);return _.sort(function(X,Z){return X=X.toLowerCase(),Z=Z.toLowerCase(),X===Z?0:X>Z?1:-1})}var i=function(I,_){var z,X,Z,ae=[],ve=b(I);for(z=0;z<ve.length;z++)X=ve[z],Z=I[X]===void 0||I[X]===null?"":""+I[X],X=_?a(X).toLowerCase():a(X),Z=a(Z)||"",ae.push(X+"="+Z);return ae.join("&")},n=["cache-control","content-disposition","content-encoding","content-length","content-md5","expect","expires","host","if-match","if-modified-since","if-none-match","if-unmodified-since","origin","range","transfer-encoding","pic-operations"],t=function(I){var _={};for(var z in I){var X=z.toLowerCase();(X.indexOf("x-cos-")>-1||X.indexOf("x-ci-")>-1||n.indexOf(X)>-1)&&(_[z]=I[z])}return _},s=function(I){I=I||{};var _=I.SecretId,z=I.SecretKey,X=I.KeyTime,Z=(I.method||I.Method||"get").toLowerCase(),ae=le(I.Query||I.params||{}),ve=t(le(I.Headers||I.headers||{})),be=I.Key||"",Pe;I.UseRawKey?Pe=I.Pathname||I.pathname||"/"+be:(Pe=I.Pathname||I.pathname||be,Pe.indexOf("/")!==0&&(Pe="/"+Pe));var Ie=I.ForceSignHost!==!1;if(!ve.Host&&!ve.host&&I.Bucket&&I.Region&&Ie&&(ve.Host=I.Bucket+".cos."+I.Region+".myqcloud.com"),!_)throw new Error("missing param SecretId");if(!z)throw new Error("missing param SecretKey");var _e=Math.round(at(I.SystemClockOffset)/1e3)-1,je=_e,We=I.Expires||I.expires;We===void 0?je+=900:je+=We*1||0;var lt="sha1",Qe=_,we=X||_e+";"+je,tt=X||_e+";"+je,Xe=b(ve,!0).join(";").toLowerCase(),ft=b(ae,!0).join(";").toLowerCase(),mt=h.HmacSHA1(tt,z).toString(),Nt=[Z,Pe,$e.obj2str(ae,!0),$e.obj2str(ve,!0),""].join(`
`),Ft=["sha1",we,h.SHA1(Nt).toString(),""].join(`
`),te=h.HmacSHA1(Ft,mt).toString(),Mt=["q-sign-algorithm="+lt,"q-ak="+Qe,"q-sign-time="+we,"q-key-time="+tt,"q-header-list="+Xe,"q-url-param-list="+ft,"q-signature="+te].join("&");return Mt},l=function(I,_,z){var X=_/8,Z=I.slice(z,z+X);return new Uint8Array(Z).reverse(),new{8:Uint8Array,16:Uint16Array,32:Uint32Array}[_](Z)[0]},v=function(I,_,z,X){var Z=I.slice(_,z),ae="";return new Uint8Array(Z).forEach(function(ve){ae+=String.fromCharCode(ve)}),X&&(ae=decodeURIComponent(escape(ae))),ae},M=function(I){for(var _={},z=v(I),X={records:[]};I.byteLength;){var Z=l(I,32,0),ae=l(I,32,4),ve=Z-ae-16,be=0,Pe;for(I=I.slice(12);be<ae;){var Ie=l(I,8,be),_e=v(I,be+1,be+1+Ie),je=l(I,16,be+Ie+2),We=v(I,be+Ie+4,be+Ie+4+je);_[_e]=We,be+=Ie+4+je}if(_[":event-type"]==="Records")Pe=v(I,be,be+ve,!0),X.records.push(Pe);else if(_[":event-type"]==="Stats")Pe=v(I,be,be+ve,!0),X.stats=$e.xml2json(Pe).Stats;else if(_[":event-type"]==="error"){var lt=_[":error-code"],Qe=_[":error-message"],we=new Error(Qe);we.message=Qe,we.name=we.code=lt,X.error=we}I=I.slice(be+ve+4)}return{payload:X.records.join(""),body:z}},x=function(I){var _=this.options.CopySourceParser;if(_)return _(I);var z=I.match(/^([^.]+-\d+)\.cos(v6|-cdc|-cdz|-internal)?\.([^.]+)\.((myqcloud\.com)|(tencentcos\.cn))\/(.+)$/);return z?{Bucket:z[1],Region:z[3],Key:z[7]}:null},H=function(){},$=function(I){var _={};for(var z in I)I.hasOwnProperty(z)&&I[z]!==void 0&&I[z]!==null&&(_[z]=I[z]);return _},Y=function(I,_){var z,X=new FileReader;FileReader.prototype.readAsBinaryString?(z=FileReader.prototype.readAsBinaryString,X.onload=function(){_(this.result)}):FileReader.prototype.readAsArrayBuffer?z=function(ae){var ve="",be=new FileReader;be.onload=function(Pe){for(var Ie=new Uint8Array(be.result),_e=Ie.byteLength,je=0;je<_e;je++)ve+=String.fromCharCode(Ie[je]);_(ve)},be.readAsArrayBuffer(ae)}:console.error("FileReader not support readAsBinaryString"),z.call(X,I)},ee=function(){var W=function(z,X){z=z.split("."),X=X.split(".");for(var Z=0;Z<X.length;Z++)if(z[Z]!==X[Z])return parseInt(z[Z])>parseInt(X[Z])?1:-1;return 0},I=function(z){if(!z)return!1;var X=(z.match(/Chrome\/([.\d]+)/)||[])[1],Z=(z.match(/QBCore\/([.\d]+)/)||[])[1],ae=(z.match(/QQBrowser\/([.\d]+)/)||[])[1],ve=X&&W(X,"53.0.2785.116")<0&&Z&&W(Z,"3.53.991.400")<0&&ae&&W(ae,"9.0.2524.400")<=0||!1;return ve};return I(typeof navigator<"u"&&navigator.userAgent)}(),re=function(I,_,z,X,Z){var ae;if(I.slice?ae=I.slice(_,z):I.mozSlice?ae=I.mozSlice(_,z):I.webkitSlice&&(ae=I.webkitSlice(_,z)),X&&ee){var ve=new FileReader;ve.onload=function(be){ae=null,Z(new Blob([ve.result]))},ve.readAsArrayBuffer(ae)}else Z(ae)},ie=function(I,_,z,X){z=z||H,I?typeof _=="string"?z($e.md5(_,!0)):Blob&&_ instanceof Blob?$e.getFileMd5(_,function(Z,ae){z(ae)},X):z():z()},me=1024*1024,de=function(I,_,z){var X=I.size,Z=0,ae=r.getCtx(),ve=function(Pe){if(Pe>=X){var Ie=ae.digest("hex");_(null,Ie);return}var _e=Math.min(X,Pe+me);$e.fileSlice(I,Pe,_e,!1,function(je){Y(je,function(We){je=null,ae=ae.update(We,!0),Z+=We.length,We=null,z&&z({loaded:Z,total:X,percent:Math.round(Z/X*1e4)/1e4}),ve(Pe+me)})})};ve(0)};function le(W){return ye(W,function(I){return m(I)==="object"&&I!==null?le(I):I})}function ne(W,I,_){return W&&I in W?W[I]:_}function Q(W,I){return ce(I,function(_,z){W[z]=I[z]}),W}function oe(W){return W instanceof Array}function ge(W){return Object.prototype.toString.call(W)==="[object Object]"}function he(W,I){for(var _=!1,z=0;z<W.length;z++)if(I===W[z]){_=!0;break}return _}function se(W){return oe(W)?W:[W]}function ce(W,I){for(var _ in W)W.hasOwnProperty(_)&&I(W[_],_)}function ye(W,I){var _=oe(W)?[]:{};for(var z in W)W.hasOwnProperty(z)&&(_[z]=I(W[z],z));return _}function Ce(W,I){var _=oe(W),z=_?[]:{};for(var X in W)W.hasOwnProperty(X)&&I(W[X],X)&&(_?z.push(W[X]):z[X]=W[X]);return z}var Se=function(I){var _,z,X,Z="";for(_=0,z=I.length/2;_<z;_++)X=parseInt(I[_*2]+I[_*2+1],16),Z+=String.fromCharCode(X);return btoa(Z)},Oe=function(){var I=function(){return((1+Math.random())*65536|0).toString(16).substring(1)};return I()+I()+"-"+I()+"-"+I()+"-"+I()+"-"+I()+I()+I()},xe=function(I,_){var z=_.Bucket,X=_.Region,Z=_.Key,ae=this.options.Domain,ve=!ae||typeof ae=="string"&&ae.indexOf("{Bucket}")>-1,be=!ae||typeof ae=="string"&&ae.indexOf("{Region}")>-1;if(I.indexOf("Bucket")>-1||I==="deleteMultipleObject"||I==="multipartList"||I==="listObjectVersions"){if(ve&&!z)return"Bucket";if(be&&!X)return"Region"}else if(I.indexOf("Object")>-1||I.indexOf("multipart")>-1||I==="sliceUploadFile"||I==="abortUploadTask"||I==="uploadFile"){if(ve&&!z)return"Bucket";if(be&&!X)return"Region";if(!Z)return"Key"}return!1},Ne=function(I,_){if(_=Q({},_),I!=="getAuth"&&I!=="getV4Auth"&&I!=="getObjectUrl"){var z=_.Headers||{};if(_&&m(_)==="object"){(function(){for(var Z in _)_.hasOwnProperty(Z)&&Z.indexOf("x-cos-")>-1&&(z[Z]=_[Z])})();var X={"x-cos-mfa":"MFA","Content-MD5":"ContentMD5","Content-Length":"ContentLength","Content-Type":"ContentType",Expect:"Expect",Expires:"Expires","Cache-Control":"CacheControl","Content-Disposition":"ContentDisposition","Content-Encoding":"ContentEncoding",Range:"Range","If-Modified-Since":"IfModifiedSince","If-Unmodified-Since":"IfUnmodifiedSince","If-Match":"IfMatch","If-None-Match":"IfNoneMatch","x-cos-copy-source":"CopySource","x-cos-copy-source-Range":"CopySourceRange","x-cos-metadata-directive":"MetadataDirective","x-cos-copy-source-If-Modified-Since":"CopySourceIfModifiedSince","x-cos-copy-source-If-Unmodified-Since":"CopySourceIfUnmodifiedSince","x-cos-copy-source-If-Match":"CopySourceIfMatch","x-cos-copy-source-If-None-Match":"CopySourceIfNoneMatch","x-cos-acl":"ACL","x-cos-grant-read":"GrantRead","x-cos-grant-write":"GrantWrite","x-cos-grant-full-control":"GrantFullControl","x-cos-grant-read-acp":"GrantReadAcp","x-cos-grant-write-acp":"GrantWriteAcp","x-cos-storage-class":"StorageClass","x-cos-traffic-limit":"TrafficLimit","x-cos-mime-limit":"MimeLimit","x-cos-server-side-encryption-customer-algorithm":"SSECustomerAlgorithm","x-cos-server-side-encryption-customer-key":"SSECustomerKey","x-cos-server-side-encryption-customer-key-MD5":"SSECustomerKeyMD5","x-cos-server-side-encryption":"ServerSideEncryption","x-cos-server-side-encryption-cos-kms-key-id":"SSEKMSKeyId","x-cos-server-side-encryption-context":"SSEContext","Pic-Operations":"PicOperations","x-cos-callback":"Callback","x-cos-callback-var":"CallbackVar","x-cos-return-body":"ReturnBody"};$e.each(X,function(Z,ae){_[Z]!==void 0&&(z[ae]=_[Z])}),_.Headers=$(z)}}return _},et=function(I,_){return function(z,X){var Z=this;typeof z=="function"&&(X=z,z={}),z=Ne(I,z);var ae;if(Z.options.EnableReporter)if(z.calledBySdk==="sliceUploadFile"||z.calledBySdk==="sliceCopyFile")ae=z.tracker&&z.tracker.generateSubTracker({apiName:I});else if(["uploadFile","uploadFiles"].includes(I))ae=null;else{var ve=0;z.Body&&(ve=typeof z.Body=="string"?z.Body.length:z.Body.size||z.Body.byteLength||0);var be=Z.options.UseAccelerate||typeof Z.options.Domain=="string"&&Z.options.Domain.includes("accelerate.");ae=new L({Beacon:Z.options.BeaconReporter,clsReporter:Z.options.ClsReporter,bucket:z.Bucket,region:z.Region,apiName:I,realApi:I,accelerate:be,fileKey:z.Key,fileSize:ve,deepTracker:Z.options.DeepTracker,customId:Z.options.CustomId,delay:Z.options.TrackerDelay})}z.tracker=ae;var Pe=function(we){return we&&we.headers&&(we.headers["x-ci-request-id"]&&(we.RequestId=we.headers["x-ci-request-id"]),we.headers["x-cos-request-id"]&&(we.RequestId=we.headers["x-cos-request-id"]),we.headers["x-cos-version-id"]&&(we.VersionId=we.headers["x-cos-version-id"]),we.headers["x-cos-delete-marker"]&&(we.DeleteMarker=we.headers["x-cos-delete-marker"])),we},Ie=function(we,tt){ae&&ae.report(we,tt),X&&X(Pe(we),Pe(tt))},_e=function(){if(I!=="getService"&&I!=="abortUploadTask"){var we=xe.call(Z,I,z);if(we)return"missing param "+we;if(z.Region){if(Z.options.CompatibilityMode){if(!/^([a-z\d-.]+)$/.test(z.Region))return"Region format error."}else{if(z.Region.indexOf("cos.")>-1)return'param Region should not be start with "cos."';if(!/^([a-z\d-]+)$/.test(z.Region))return"Region format error."}!Z.options.CompatibilityMode&&z.Region.indexOf("-")===-1&&z.Region!=="yfb"&&z.Region!=="default"&&z.Region!=="accelerate"&&console.warn("warning: param Region format error, find help here: https://cloud.tencent.com/document/product/436/6224")}if(z.Bucket){if(!/^([a-z\d-]+)-(\d+)$/.test(z.Bucket))if(z.AppId)z.Bucket=z.Bucket+"-"+z.AppId;else if(Z.options.AppId)z.Bucket=z.Bucket+"-"+Z.options.AppId;else return'Bucket should format as "test-1250000000".';z.AppId&&(console.warn('warning: AppId has been deprecated, Please put it at the end of parameter Bucket(E.g Bucket:"test-1250000000" ).'),delete z.AppId)}!Z.options.UseRawKey&&z.Key&&z.Key.substr(0,1)==="/"&&(z.Key=z.Key.substr(1))}},je=_e(),We=["getAuth","getObjectUrl"].includes(I);if(typeof Promise=="function"&&!We&&!X)return new Promise(function(Qe,we){if(X=function(Xe,ft){Xe?we(Xe):Qe(ft)},je)return Ie($e.error(new Error(je)));_.call(Z,z,Ie)});if(je)return Ie($e.error(new Error(je)));var lt=_.call(Z,z,Ie);if(We)return lt}},qe=function(I,_){var z=this,X=0,Z=0,ae=Date.now(),ve,be;function Pe(){if(be=0,_&&typeof _=="function"){ve=Date.now();var Ie=Math.max(0,Math.round((Z-X)/((ve-ae)/1e3)*100)/100)||0,_e;Z===0&&I===0?_e=1:_e=Math.floor(Z/I*100)/100||0,ae=ve,X=Z;try{_({loaded:Z,total:I,speed:Ie,percent:_e})}catch{}}}return function(Ie,_e){if(Ie&&(Z=Ie.loaded,I=Ie.total),_e)clearTimeout(be),Pe();else{if(be)return;be=setTimeout(Pe,z.options.ProgressInterval)}}},rt=function(I,_,z){var X;if(typeof _.Body=="string"?_.Body=new Blob([_.Body],{type:"text/plain"}):_.Body instanceof ArrayBuffer&&(_.Body=new Blob([_.Body])),_.Body&&(_.Body instanceof Blob||_.Body.toString()==="[object File]"||_.Body.toString()==="[object Blob]"))X=_.Body.size;else{z($e.error(new Error("params body format error, Only allow File|Blob|String.")));return}_.ContentLength=X,z(null,X)},at=function(I){return Date.now()+(I||0)},Ge=function(I,_){var z=I;return I.message=I.message||null,typeof _=="string"?(I.error=_,I.message=_):m(_)==="object"&&_!==null&&(Q(I,_),(_.code||_.name)&&(I.code=_.code||_.name),_.message&&(I.message=_.message),_.stack&&(I.stack=_.stack)),typeof Object.defineProperty=="function"&&(Object.defineProperty(I,"name",{writable:!0,enumerable:!1}),Object.defineProperty(I,"message",{enumerable:!0})),I.name=_&&_.name||I.name||I.code||"Error",I.code||(I.code=I.name),I.error||(I.error=le(z)),I},ot=function(){return(typeof globalThis>"u"?"undefined":m(globalThis))==="object"&&(globalThis.constructor.name==="DedicatedWorkerGlobalScope"||globalThis.FileReaderSync)},vt=function(){return(typeof window>"u"?"undefined":m(window))!=="object"&&(typeof R>"u"?"undefined":m(R))==="object"&&!0&&!ot()},Et=function(I){return/^https?:\/\/([^/]+\.)?ci\.[^/]+/.test(I)},Ot=function(){if((typeof navigator>"u"?"undefined":m(navigator))!=="object")return!1;var W=navigator.userAgent,I=!!W.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/);return I}(),At=function(){return(typeof navigator>"u"?"undefined":m(navigator))!=="object"?!1:/\sQQ/i.test(navigator.userAgent)}(),It=function(I,_){var z=E.encode(I);return _&&(z=z.replaceAll("+","-").replaceAll("/","_").replaceAll("=","")),z},Ut=function(I){return I?E.decode(I):""},Lt=function(I){var _=I.split("/"),z=[],X=A(_),Z;try{for(X.s();!(Z=X.n()).done;){var ae=Z.value;ae===".."?z.length&&z.pop():ae.length&&ae!=="."&&z.push(ae)}}catch(ve){X.e(ve)}finally{X.f()}return"/"+z.join("/")},jt=function(I){var _;if(I&&typeof I=="string"){var z=I.trim(),X=z.indexOf("<")===0,Z=z.indexOf("{")===0;if(X)_=$e.xml2json(I)||{};else if(Z)try{var ae=I.replace(/\n/g," "),ve=JSON.parse(ae);Object.prototype.toString.call(ve)==="[object Object]"?_=ve:_=I}catch{_=I}else _=I}else _=I||{};return _},$e={noop:H,formatParams:Ne,apiWrapper:et,xml2json:j,json2xml:c,md5:r,clearKey:$,fileSlice:re,getBodyMd5:ie,getFileMd5:de,b64:Se,extend:Q,isArray:oe,isInArray:he,makeArray:se,each:ce,map:ye,filter:Ce,clone:le,attr:ne,uuid:Oe,camSafeUrlEncode:a,throttleOnProgress:qe,getFileSize:rt,getSkewTime:at,error:Ge,obj2str:i,getAuth:s,parseSelectPayload:M,getSourceParams:x,isBrowser:!0,isNode:vt,isCIHost:Et,isIOS_QQ:Ot&&At,encodeBase64:It,decodeBase64:Ut,simplifyPath:Lt,readAsBinaryString:Y,parseResBody:jt};U.exports=$e}).call(this,k("./node_modules/process/browser.js"))}})})}(Tt)),Tt.exports}var Ir=Ar();const Ur=_n(Ir),Lr={class:"cos-uploader"},Mr={__name:"CosUploader",props:{modelValue:{type:String,default:[]},prefix:{type:String,default:"uploads/"}},emits:["update:modelValue","upload-success","upload-error","upload-progress","before-upload","file-remove","image-delete"],setup(B,{expose:G,emit:U}){const K={SecretId:"AKIDxmOnz042pSs5D8seMtFPM6cw3ygCeuxm",SecretKey:"iFgvxmPq9FAcu0xjJn7FBuSpzzoRr68z",Protocol:"https:",Bucket:"gensi-1316936694",Region:"ap-shanghai",ServiceDomain:"https://cos.ap-shanghai.myqcloud.com"},k={defaultFiles:"",maxSize:10,maxFiles:1,multiple:!0,accept:"image/*",listType:"image-card"},R=B,m=U,A=new Ur(K),w=zn(),O=Kn(),r=dt([]),h=dt([]),f=j=>`${K.Protocol||"https:"}//${K.Bucket}.cos.${K.Region}.myqcloud.com/${j}`,S=j=>!j||!j.trim()?[]:j.split(",").map(c=>{const a=c.trim();if(!a)return null;let b,i,n;if(a.startsWith("http://")||a.startsWith("https://"))try{b=new URL(a).pathname.substring(1),i=a,n=b.split("/").pop()||b}catch{return console.error("解析URL失败:",a),null}else b=a,i=f(a),n=a.split("/").pop()||a;return{key:b,name:n,url:i,size:0,uploadTime:"预设文件",isDefault:!0}}).filter(c=>c!==null),d=async({file:j,onProgress:c,onError:a,onFinish:b})=>{const i=`${R.prefix}${Date.now()}-${j.name}`;try{m("before-upload",{file:j,key:i});const n=await A.putObject({Bucket:K.Bucket,Region:K.Region,Key:i,Body:j.file,onProgress:l=>{const v=Math.round(l.percent*100);c({percent:v}),m("upload-progress",{file:j,percent:v,progressData:l})}}),t=f(i),s={key:i,name:j.name,url:t,size:j.file.size,uploadTime:new Date().toLocaleString(),cosResult:n};h.value.push(s),r.value.push({id:s.key,name:s.name,status:"finished",url:s.url,key:s.key,file:null,percentage:100}),w.success(`${j.name} 上传成功！`),b(),D(),m("upload-success",{file:j,imageInfo:s,result:n})}catch(n){console.error("上传失败:",n),w.error(`${j.name} 上传失败: ${n.message}`),a(),m("upload-error",{file:j,error:n})}},p=j=>{var i;const{file:c}=j,a=(i=c.type)==null?void 0:i.startsWith("image/"),b=c.size<k.maxSize*1024*1024;return a?b?!0:(w.warning(`图片大小不能超过 ${k.maxSize}MB！`),!1):(w.warning("只能上传图片文件！"),!1)},T=async j=>{const{file:c,index:a}=j;if(console.log("准备删除文件:",c),c.url||c.key)return new Promise(b=>{O.warning({title:"确认删除",content:`确定要删除 ${c.name} 吗？`,positiveText:"确定",negativeText:"取消",onPositiveClick:async()=>{await E(c,b)},onNegativeClick:()=>{b(!1)}})});if(r.value&&r.value.length>a){const b=r.value[a];r.value.splice(a,1),m("file-remove",{file:b,index:a})}return!0},E=async(j,c)=>{try{let a=j.key;!a&&j.url&&(a=new URL(j.url).pathname.substring(1)),console.log("删除文件key:",a);const b=await A.deleteObject({Bucket:K.Bucket,Region:K.Region,Key:a});console.log("COS删除结果:",b);const i=h.value.findIndex(t=>t.key===a);i>-1&&(h.value.splice(i,1),console.log("从 uploadedImages 中移除了索引:",i));const n=r.value.findIndex(t=>t.key===a);n>-1&&(r.value.splice(n,1),console.log("从 uploadFileList 中移除了索引:",n)),D(),m("image-delete"),w.success("删除成功！"),m("image-delete",{image:j}),c(!0)}catch(a){console.error("删除失败:",a),console.error("错误详情:",a),w.error(`删除失败: ${a.message}`),c(!1)}},L=(j=null)=>{const c=j||R.modelValue||k.defaultFiles;if(c){const a=S(c);h.value=[...a],r.value=a.map(b=>({id:b.key,name:b.name,status:"finished",url:b.url,key:b.key,file:null,percentage:100})),console.log("已加载文件:",a)}};Hn(()=>R.modelValue,(j,c)=>{j!==c&&(console.log("modelValue 变化:",j),L(j))},{immediate:!1});const N=()=>h.value.map(j=>j.url).join(","),D=()=>{const j=N();m("update:modelValue",j),console.log("更新 modelValue:",j)};return G({uploadedImages:h,cos:A,getFilePathsString:N,initDefaultFiles:L}),$n(async()=>{console.log("CosUploader 组件已挂载"),L()}),(j,c)=>{const a=Er;return Vn(),Dn("div",Lr,[qn(a,{"file-list":r.value,"onUpdate:fileList":c[0]||(c[0]=b=>r.value=b),"custom-request":d,"before-upload":p,multiple:k.multiple,accept:k.accept,max:k.maxFiles,"list-type":k.listType,onRemove:T},null,8,["file-list","multiple","accept","max","list-type"])])}}};export{Mr as _};
