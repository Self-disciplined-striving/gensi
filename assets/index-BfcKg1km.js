import{_ as j}from"./CosUploader-CWsmLGcJ.js";import{g as q,u as O,i as R,d as F,N as L,a as E}from"./supabaseAction-CtZEhjoC.js";import{N as _}from"./Space-huVS_WJM.js";import{d as K,j as P,r as v,k as A,a as G,l as H,b as J,o as Q,f as n,w as i,i as r,N as x,B as p,h as y,t as D,m as W,n as g,p as X,q as Y,s as h,v as Z,_ as ee}from"./index-BX3CDTav.js";import{N as te}from"./Form-DonZQ5aj.js";import{N as ae}from"./Image-C7prWbZ-.js";import"./supabase-CL7jMM04.js";function le(){return q()}function ne(d){return R(d)}function re(d,o){return O(d,o)}function w(d){return F(d)}const ie={class:"p-4"},oe=K({__name:"index",setup(d){const o=P(),u=v(!1),c=v(!1),m=v(!1),f=v(""),s=v([]),a=A({title:"",content:"",cover:"",create_by:"",time:null}),b=v([]),B=[{title:"ID",key:"id",width:80,ellipsis:{tooltip:!0}},{title:"封面图片",key:"cover",width:120,render(e){return e?e.cover?h(ae,{src:e.cover,width:60,height:40,objectFit:"cover",style:"border-radius: 4px;"}):"暂无图片":"数据错误"}},{title:"标题",key:"title",width:200,ellipsis:{tooltip:!0},render(e){return(e==null?void 0:e.title)||"-"}},{title:"内容",key:"content",width:300,ellipsis:{tooltip:!0},render(e){if(!e)return"-";const t=e.content||"";return t.length>80?t.substring(0,80)+"...":t}},{title:"创建者",key:"create_by",width:120,render(e){return e?h(Z,{type:"info",size:"small"},{default:()=>e.create_by||"未知"}):"-"}},{title:"发布时间",key:"time",width:120,render(e){return(e==null?void 0:e.time)||"-"}},{title:"创建时间",key:"created_at",width:150,render(e){return e&&e.created_at?new Date(e.created_at).toLocaleDateString("zh-CN"):"-"}},{title:"操作",key:"actions",width:150,fixed:"right",render(e){return!e||!e.id?"-":h(_,null,{default:()=>[h(p,{size:"small",type:"primary",onClick:()=>V(e)},{default:()=>"编辑"}),h(p,{size:"small",type:"error",onClick:()=>M(e.id)},{default:()=>"删除"})]})}}],C=G(()=>f.value?b.value.filter(e=>{var t,l,N;return e&&(((t=e.title)==null?void 0:t.includes(f.value))||((l=e.content)==null?void 0:l.includes(f.value))||((N=e.create_by)==null?void 0:N.includes(f.value)))}):b.value);async function k(){u.value=!0;try{const e=await le();b.value=(e||[]).filter(t=>t&&t.id)}catch(e){console.error("加载博客数据失败:",e),o.error("加载数据失败"),b.value=[]}finally{u.value=!1}}function I(){m.value=!1,Object.assign(a,{title:"",content:"",cover:"",create_by:"",time:null}),c.value=!0}function V(e){m.value=!0;let t=null;e.time&&S(e.time)&&(t=new Date(e.time).getTime()),Object.assign(a,{...e,time:t}),c.value=!0}function S(e){if(!e||!/^\d{4}-\d{2}-\d{2}$/.test(e))return!1;const l=new Date(e);return l instanceof Date&&!isNaN(l.getTime())}async function U(){if(!a.title||!a.content){o.error("请填写标题和内容");return}u.value=!0;try{let e="";a.time?typeof a.time=="number"?e=new Date(a.time).toISOString().split("T")[0]:typeof a.time=="string"&&(e=a.time):e=new Date().toISOString().split("T")[0];const t={title:a.title,content:a.content,cover:a.cover||"",create_by:a.create_by||"管理员",time:e};m.value&&a.id?(await re(a.id,t),o.success("更新成功")):(await ne(t),o.success("新增成功")),c.value=!1,await k()}catch(e){console.error("保存博客失败:",e),o.error("保存失败")}finally{u.value=!1}}async function M(e){u.value=!0;try{await w(e),o.success("删除成功"),await k()}catch(t){console.error("删除博客失败:",t),o.error("删除失败")}finally{u.value=!1}}async function T(){if(s.value.length===0){o.warning("请选择要删除的博客");return}u.value=!0;try{await Promise.all(s.value.map(e=>w(e))),o.success(`成功删除 ${s.value.length} 篇博客`),s.value=[],await k()}catch(e){console.error("批量删除失败:",e),o.error("批量删除失败")}finally{u.value=!1}}function $(e){s.value=e.map(t=>String(t))}H(()=>{k()});const z=()=>{console.log("出发删除",a.id),E(a.id,"blog"),a.cover=""};return(e,t)=>(Q(),J("div",ie,[n(r(W),{title:"博客管理",bordered:!1},{"header-extra":i(()=>[n(r(_),null,{default:i(()=>[n(r(x),{value:f.value,"onUpdate:value":t[0]||(t[0]=l=>f.value=l),placeholder:"搜索标题、内容或创建者",clearable:"",style:{width:"250px"}},null,8,["value"]),n(r(p),{type:"error",disabled:s.value.length===0,onClick:T},{default:i(()=>[y(" 批量删除 ("+D(s.value.length)+") ",1)]),_:1},8,["disabled"]),n(r(p),{type:"primary",onClick:I},{default:i(()=>t[8]||(t[8]=[y(" 新增博客 ")])),_:1})]),_:1})]),default:i(()=>[n(r(L),{loading:u.value,columns:B,data:C.value,pagination:{pageSize:10},"row-key":l=>(l==null?void 0:l.id)||"","scroll-x":1400,"checked-row-keys":s.value,"onUpdate:checkedRowKeys":$},null,8,["loading","data","row-key","checked-row-keys"])]),_:1}),n(r(Y),{show:c.value,"onUpdate:show":t[7]||(t[7]=l=>c.value=l),preset:"dialog",style:{width:"900px"}},{header:i(()=>[y(D(m.value?"编辑博客":"新增博客"),1)]),action:i(()=>[n(r(_),null,{default:i(()=>[n(r(p),{onClick:t[6]||(t[6]=l=>c.value=!1)},{default:i(()=>t[9]||(t[9]=[y("取消")])),_:1}),n(r(p),{type:"primary",onClick:U,loading:u.value},{default:i(()=>[y(D(m.value?"更新":"创建"),1)]),_:1},8,["loading"])]),_:1})]),default:i(()=>[n(r(te),{model:a,"label-placement":"left","label-width":"100px","require-mark-placement":"right-hanging"},{default:i(()=>[n(r(g),{label:"标题",path:"title",required:""},{default:i(()=>[n(r(x),{value:a.title,"onUpdate:value":t[1]||(t[1]=l=>a.title=l),placeholder:"请输入博客标题",maxlength:"200","show-count":""},null,8,["value"])]),_:1}),n(r(g),{label:"封面图片",path:"cover"},{default:i(()=>[n(r(_),{vertical:"",style:{width:"100%"}},{default:i(()=>[n(j,{modelValue:a.cover,"onUpdate:modelValue":t[2]||(t[2]=l=>a.cover=l),prefix:"blog/cover/",onImageDelete:z},null,8,["modelValue"])]),_:1})]),_:1}),n(r(g),{label:"内容",path:"content",required:""},{default:i(()=>[n(r(x),{value:a.content,"onUpdate:value":t[3]||(t[3]=l=>a.content=l),type:"textarea",placeholder:"请输入博客内容",rows:8,maxlength:"5000","show-count":""},null,8,["value"])]),_:1}),n(r(g),{label:"创建者",path:"create_by"},{default:i(()=>[n(r(x),{value:a.create_by,"onUpdate:value":t[4]||(t[4]=l=>a.create_by=l),placeholder:"请输入创建者姓名",maxlength:"50"},null,8,["value"])]),_:1}),n(r(g),{label:"发布时间",path:"time"},{default:i(()=>[n(r(X),{value:a.time,"onUpdate:value":t[5]||(t[5]=l=>a.time=l),"value-format":"yyyy-MM-dd",type:"date",placeholder:"请选择发布时间",style:{width:"100%"},clearable:""},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show"])]))}}),me=ee(oe,[["__scopeId","data-v-700c5a6f"]]);export{me as default};
