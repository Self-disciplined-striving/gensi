import{d as I,j as M,r as f,k as S,a as z,l as U,b as V,o as O,f as t,w as o,e as d,i as s,y as T,h as m,B as p,g as E,N as _,m as F,p as w,t as L,v as P,x as v,_ as R}from"./index-C5NNhcj1.js";import{N as $,H,I as J,J as K,K as q}from"./supabaseAction-DTzG44gK.js";import{N as G}from"./Form-Dwv7jmx4.js";import{N as g}from"./Space-B1Q4eXpn.js";import{N as Q}from"./Popconfirm-BpPQQ0Dg.js";const W={class:"view-page"},X={class:"flex-col h-full"},Y={class:"flex-y-center justify-between pb-18px"},Z={class:"flex-y-center gap-16px"},ee={class:"flex-y-center pb-18px"},ae={class:"flex-1"},te=I({__name:"index",setup(le){const n=M(),b=f(!1),r=f(!1),u=f(!1),c=f(""),l=S({name:"",describe:""}),x=f([]),N=[{title:"ID",key:"id",width:80,ellipsis:{tooltip:!0}},{title:"姓名",key:"name",width:150,ellipsis:{tooltip:!0}},{title:"简介",key:"describe",width:300,ellipsis:{tooltip:!0}},{title:"创建时间",key:"created_at",width:180,render(e){return e.created_at?new Date(e.created_at).toLocaleString():""}},{title:"操作",key:"actions",width:150,render(e){return v(g,null,{default:()=>[v(p,{size:"small",type:"primary",onClick:()=>D(e)},{default:()=>"编辑"}),v(Q,{onPositiveClick:()=>j(e.id)},{default:()=>"确认删除这个校友信息吗？",trigger:()=>v(p,{size:"small",type:"error"},{default:()=>"删除"})})]})}}],k=z(()=>c.value?x.value.filter(e=>e.name.includes(c.value)||e.describe.includes(c.value)):x.value);async function y(){b.value=!0;try{const e=await H();x.value=e||[]}catch(e){console.error("加载校友数据失败:",e),n.error("加载数据失败")}finally{b.value=!1}}function C(){u.value=!1,Object.assign(l,{name:"",describe:""}),r.value=!0}function D(e){u.value=!0,Object.assign(l,e),r.value=!0}async function j(e){try{await J(e),n.success("删除成功"),y()}catch(a){console.error("删除校友失败:",a),n.error("删除失败")}}async function A(){try{if(!l.name||!l.describe){n.error("请填写所有必填字段");return}u.value?(await K(l.id,{name:l.name,describe:l.describe}),n.success("更新成功")):(await q({name:l.name,describe:l.describe}),n.success("添加成功")),r.value=!1,y()}catch(e){console.error("操作失败:",e),n.error("操作失败")}}function B(){r.value=!1,Object.assign(l,{name:"",describe:""})}return U(()=>{y()}),(e,a)=>{const h=E;return O(),V("div",W,[t(s(F),{bordered:!1,class:"h-full rounded-8px shadow-sm"},{default:o(()=>[d("div",X,[d("div",Y,[d("div",Z,[a[5]||(a[5]=d("div",{class:"text-20px font-bold"},"校友管理",-1)),t(s(T),{type:"info",class:"text-12px"},{default:o(()=>a[4]||(a[4]=[m(" 管理校友信息 ")])),_:1})]),t(s(p),{type:"primary",onClick:C},{icon:o(()=>[t(h,{icon:"mdi:plus",class:"text-16px"})]),default:o(()=>[a[6]||(a[6]=m(" 添加校友 "))]),_:1})]),d("div",ee,[t(s(_),{value:c.value,"onUpdate:value":a[0]||(a[0]=i=>c.value=i),placeholder:"搜索校友姓名或简介",clearable:"",class:"w-300px"},{prefix:o(()=>[t(h,{icon:"mdi:magnify",class:"text-16px"})]),_:1},8,["value"])]),d("div",ae,[t(s($),{columns:N,data:k.value,loading:b.value,pagination:{pageSize:10},bordered:!1,class:"h-full"},null,8,["data","loading"])])])]),_:1}),t(s(P),{show:r.value,"onUpdate:show":a[3]||(a[3]=i=>r.value=i),preset:"card",title:u.value?"编辑校友":"添加校友",class:"w-600px"},{footer:o(()=>[t(s(g),{justify:"end"},{default:o(()=>[t(s(p),{onClick:B},{default:o(()=>a[7]||(a[7]=[m("取消")])),_:1}),t(s(p),{type:"primary",onClick:A},{default:o(()=>[m(L(u.value?"更新":"添加"),1)]),_:1})]),_:1})]),default:o(()=>[t(s(G),{model:l,"label-placement":"left","label-width":80},{default:o(()=>[t(s(w),{label:"姓名",path:"name"},{default:o(()=>[t(s(_),{value:l.name,"onUpdate:value":a[1]||(a[1]=i=>l.name=i),placeholder:"请输入校友姓名"},null,8,["value"])]),_:1}),t(s(w),{label:"简介",path:"describe"},{default:o(()=>[t(s(_),{value:l.describe,"onUpdate:value":a[2]||(a[2]=i=>l.describe=i),type:"textarea",placeholder:"请输入校友简介",autosize:{minRows:4,maxRows:8}},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"])])}}}),de=R(te,[["__scopeId","data-v-b1699e8a"]]);export{de as default};
