import{_ as z}from"./CosUploader-B-7czNlT.js";import{b as B,c as O,e as j,f as R,N as Y,a as E}from"./supabaseAction-CsXWuVGY.js";import{d as K,j as P,r as m,k as A,a as G,l as H,b as J,o as Q,f as n,w as r,i,N as w,B as v,h,t as D,m as W,n as p,x as X,p as Z,q as ee,s as k,v as te,_ as le}from"./index-C9izoxC8.js";import{N as x}from"./Space-DlBK14Y7.js";import{N as ae}from"./Form-PnC4zqqV.js";import{N as ne}from"./Image-BIKV7t1q.js";import"./supabase-C7S-aqbW.js";function ie(){return B()}function re(d){return j(d)}function oe(d,o){return O(d,o)}function T(d){return R(d)}const ue={class:"p-4"},se=K({__name:"index",setup(d){const o=P(),u=m(!1),c=m(!1),y=m(!1),f=m(""),s=m([]),l=A({media:"",title:"",content:"",time:null,cover:"",link:""}),g=m([]),U=[{label:"微信",value:"微信"},{label:"微博",value:"微博"},{label:"Twitter",value:"Twitter"},{label:"Facebook",value:"Facebook"},{label:"Instagram",value:"Instagram"},{label:"LinkedIn",value:"LinkedIn"},{label:"YouTube",value:"YouTube"},{label:"TikTok",value:"TikTok"},{label:"其他",value:"其他"}],I=[{title:"ID",key:"id",width:80,ellipsis:{tooltip:!0}},{title:"社交媒体",key:"media",width:120,render(e){return e?k(te,{type:(a=>({微信:"success",微博:"warning",Twitter:"info",Facebook:"primary",Instagram:"error",LinkedIn:"default",YouTube:"error",TikTok:"default"})[a]||"default")(e.media||""),size:"small"},{default:()=>e.media||"未知"}):"-"}},{title:"封面图片",key:"cover",width:120,render(e){return e?e.cover?k(ne,{src:e.cover,width:60,height:40,objectFit:"cover",style:"border-radius: 4px;"}):"暂无图片":"数据错误"}},{title:"标题",key:"title",width:200,ellipsis:{tooltip:!0},render(e){return(e==null?void 0:e.title)||"-"}},{title:"内容",key:"content",width:250,ellipsis:{tooltip:!0},render(e){if(!e)return"-";const t=e.content||"";return t.length>50?t.substring(0,50)+"...":t}},{title:"发布时间",key:"time",width:120,render(e){return(e==null?void 0:e.time)||"-"}},{title:"链接",key:"link",width:200,ellipsis:{tooltip:!0},render(e){return e&&e.link?k("a",{href:e.link,target:"_blank",style:"color: #18a058; text-decoration: none;"},e.link):"-"}},{title:"创建时间",key:"created_at",width:150,render(e){return e&&e.created_at?new Date(e.created_at).toLocaleDateString("zh-CN"):"-"}},{title:"操作",key:"actions",width:150,fixed:"right",render(e){return!e||!e.id?"-":k(x,null,{default:()=>[k(v,{size:"small",type:"primary",onClick:()=>C(e)},{default:()=>"编辑"}),k(v,{size:"small",type:"error",onClick:()=>V(e.id)},{default:()=>"删除"})]})}}],_=G(()=>f.value?g.value.filter(e=>{var t,a,N;return e&&(((t=e.title)==null?void 0:t.includes(f.value))||((a=e.content)==null?void 0:a.includes(f.value))||((N=e.media)==null?void 0:N.includes(f.value)))}):g.value);async function b(){u.value=!0;try{const e=await ie();g.value=(e||[]).filter(t=>t&&t.id)}catch(e){console.error("加载关注我们数据失败:",e),o.error("加载数据失败"),g.value=[]}finally{u.value=!1}}function F(){y.value=!1,Object.assign(l,{media:"",title:"",content:"",time:null,cover:"",link:""}),c.value=!0}function C(e){y.value=!0;let t=null;e.time&&M(e.time)&&(t=new Date(e.time).getTime()),Object.assign(l,{...e,time:t}),c.value=!0}function M(e){if(!e||!/^\d{4}-\d{2}-\d{2}$/.test(e))return!1;const a=new Date(e);return a instanceof Date&&!isNaN(a.getTime())}async function S(){if(!l.media||!l.title||!l.content){o.error("请填写社交媒体、标题和内容");return}u.value=!0;try{let e="";l.time?typeof l.time=="number"?e=new Date(l.time).toISOString().split("T")[0]:typeof l.time=="string"&&(e=l.time):e=new Date().toISOString().split("T")[0];const t={media:l.media,title:l.title,content:l.content,time:e,cover:l.cover||"",link:l.link||""};y.value&&l.id?(await oe(l.id,t),o.success("更新成功")):(await re(t),o.success("新增成功")),c.value=!1,await b()}catch(e){console.error("保存关注我们失败:",e),o.error("保存失败")}finally{u.value=!1}}async function V(e){u.value=!0;try{await T(e),o.success("删除成功"),await b()}catch(t){console.error("删除关注我们失败:",t),o.error("删除失败")}finally{u.value=!1}}async function $(){if(s.value.length===0){o.warning("请选择要删除的项目");return}u.value=!0;try{await Promise.all(s.value.map(e=>T(e))),o.success(`成功删除 ${s.value.length} 个项目`),s.value=[],await b()}catch(e){console.error("批量删除失败:",e),o.error("批量删除失败")}finally{u.value=!1}}function L(e){s.value=e.map(t=>String(t))}H(()=>{b()});const q=()=>{console.log("出发删除",l.id),E(l.id,"followus"),l.cover=""};return(e,t)=>(Q(),J("div",ue,[n(i(W),{title:"关注我们管理",bordered:!1},{"header-extra":r(()=>[n(i(x),null,{default:r(()=>[n(i(w),{value:f.value,"onUpdate:value":t[0]||(t[0]=a=>f.value=a),placeholder:"搜索标题、内容或社交媒体",clearable:"",style:{width:"250px"}},null,8,["value"]),n(i(v),{type:"error",disabled:s.value.length===0,onClick:$},{default:r(()=>[h(" 批量删除 ("+D(s.value.length)+") ",1)]),_:1},8,["disabled"]),n(i(v),{type:"primary",onClick:F},{default:r(()=>t[9]||(t[9]=[h(" 新增关注 ")])),_:1})]),_:1})]),default:r(()=>[n(i(Y),{loading:u.value,columns:I,data:_.value,pagination:{pageSize:10},"row-key":a=>(a==null?void 0:a.id)||"","scroll-x":1400,"checked-row-keys":s.value,"onUpdate:checkedRowKeys":L},null,8,["loading","data","row-key","checked-row-keys"])]),_:1}),n(i(ee),{show:c.value,"onUpdate:show":t[8]||(t[8]=a=>c.value=a),preset:"dialog",style:{width:"800px"}},{header:r(()=>[h(D(y.value?"编辑关注我们":"新增关注我们"),1)]),action:r(()=>[n(i(x),null,{default:r(()=>[n(i(v),{onClick:t[7]||(t[7]=a=>c.value=!1)},{default:r(()=>t[10]||(t[10]=[h("取消")])),_:1}),n(i(v),{type:"primary",onClick:S,loading:u.value},{default:r(()=>[h(D(y.value?"更新":"创建"),1)]),_:1},8,["loading"])]),_:1})]),default:r(()=>[n(i(ae),{model:l,"label-placement":"left","label-width":"100px","require-mark-placement":"right-hanging"},{default:r(()=>[n(i(p),{label:"社交媒体",path:"media",required:""},{default:r(()=>[n(i(X),{value:l.media,"onUpdate:value":t[1]||(t[1]=a=>l.media=a),options:U,placeholder:"请选择社交媒体平台",filterable:"",tag:""},null,8,["value"])]),_:1}),n(i(p),{label:"标题",path:"title",required:""},{default:r(()=>[n(i(w),{value:l.title,"onUpdate:value":t[2]||(t[2]=a=>l.title=a),placeholder:"请输入标题",maxlength:"100","show-count":""},null,8,["value"])]),_:1}),n(i(p),{label:"封面图片",path:"cover"},{default:r(()=>[n(i(x),{vertical:"",style:{width:"100%"}},{default:r(()=>[n(z,{modelValue:l.cover,"onUpdate:modelValue":t[3]||(t[3]=a=>l.cover=a),prefix:"followus/cover/",onImageDelete:q},null,8,["modelValue"])]),_:1})]),_:1}),n(i(p),{label:"内容",path:"content",required:""},{default:r(()=>[n(i(w),{value:l.content,"onUpdate:value":t[4]||(t[4]=a=>l.content=a),type:"textarea",placeholder:"请输入内容",rows:6,maxlength:"2000","show-count":""},null,8,["value"])]),_:1}),n(i(p),{label:"链接",path:"link"},{default:r(()=>[n(i(w),{value:l.link,"onUpdate:value":t[5]||(t[5]=a=>l.link=a),placeholder:"请输入相关链接，如：https://example.com",maxlength:"500"},null,8,["value"])]),_:1}),n(i(p),{label:"发布时间",path:"time"},{default:r(()=>[n(i(Z),{value:l.time,"onUpdate:value":t[6]||(t[6]=a=>l.time=a),"value-format":"yyyy-MM-dd",type:"date",placeholder:"请选择发布时间",style:{width:"100%"},clearable:""},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show"])]))}}),ye=le(se,[["__scopeId","data-v-e5637631"]]);export{ye as default};
