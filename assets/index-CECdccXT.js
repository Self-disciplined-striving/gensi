import{_ as V}from"./CosUploader-Bzc04wBn.js";import{as as Q,z as $,at as Z,au as ee,A as M,a5 as H,d as G,av as ae,x as c,a6 as te,aw as re,D as le,r as h,ax as U,a as P,E as K,ay as oe,az as ne,G as se,H as ie,aA as de,l as q,aB as ue,aC as ce,J as fe,j as ve,k as me,b as pe,o as ge,f as l,w as s,i as o,N as L,B as R,h as O,m as he,p as N,aD as be,t as ye,v as ke,y as ze,aE as we,_ as xe}from"./index-C5NNhcj1.js";import{N as _e,m as Se,n as T,o as Oe,p as Ne,q as Re,a as A}from"./supabaseAction-DTzG44gK.js";import{i as Pe,o as Ce}from"./cos-js-sdk-v5-Ci1OAid3.js";import{N as je}from"./Popconfirm-BpPQQ0Dg.js";import{N as B}from"./Space-B1Q4eXpn.js";import{N as Ee}from"./Form-Dwv7jmx4.js";const Le=Q("n-avatar-group"),De=$("avatar",`
 width: var(--n-merged-size);
 height: var(--n-merged-size);
 color: #FFF;
 font-size: var(--n-font-size);
 display: inline-flex;
 position: relative;
 overflow: hidden;
 text-align: center;
 border: var(--n-border);
 border-radius: var(--n-border-radius);
 --n-merged-color: var(--n-color);
 background-color: var(--n-merged-color);
 transition:
 border-color .3s var(--n-bezier),
 background-color .3s var(--n-bezier),
 color .3s var(--n-bezier);
`,[Z(M("&","--n-merged-color: var(--n-color-modal);")),ee(M("&","--n-merged-color: var(--n-color-popover);")),M("img",`
 width: 100%;
 height: 100%;
 `),H("text",`
 white-space: nowrap;
 display: inline-block;
 position: absolute;
 left: 50%;
 top: 50%;
 `),$("icon",`
 vertical-align: bottom;
 font-size: calc(var(--n-merged-size) - 6px);
 `),H("text","line-height: 1.25")]),Fe=Object.assign(Object.assign({},K.props),{size:[String,Number],src:String,circle:{type:Boolean,default:void 0},objectFit:String,round:{type:Boolean,default:void 0},bordered:{type:Boolean,default:void 0},onError:Function,fallbackSrc:String,intersectionObserverOptions:Object,lazy:Boolean,onLoad:Function,renderPlaceholder:Function,renderFallback:Function,imgProps:Object,color:String}),W=G({name:"Avatar",props:Fe,slots:Object,setup(n){const{mergedClsPrefixRef:m,inlineThemeDisabled:i}=le(n),f=h(!1);let v=null;const d=h(null),t=h(null),x=()=>{const{value:e}=d;if(e&&(v===null||v!==e.innerHTML)){v=e.innerHTML;const{value:a}=t;if(a){const{offsetWidth:u,offsetHeight:w}=a,{offsetWidth:g,offsetHeight:D}=e,E=.9,F=Math.min(u/g*E,w/D*E,1);e.style.transform=`translateX(-50%) translateY(-50%) scale(${F})`}}},_=U(Le,null),b=P(()=>{const{size:e}=n;if(e)return e;const{size:a}=_||{};return a||"medium"}),p=K("Avatar","-avatar",De,oe,n,m),S=U(ne,null),y=P(()=>{if(_)return!0;const{round:e,circle:a}=n;return e!==void 0||a!==void 0?e||a:S?S.roundRef.value:!1}),k=P(()=>_?!0:n.bordered||!1),j=P(()=>{const e=b.value,a=y.value,u=k.value,{color:w}=n,{self:{borderRadius:g,fontSize:D,color:E,border:F,colorModal:J,colorPopover:X},common:{cubicBezierEaseInOut:Y}}=p.value;let I;return typeof e=="number"?I=`${e}px`:I=p.value.self[se("height",e)],{"--n-font-size":D,"--n-border":u?F:"none","--n-border-radius":a?"50%":g,"--n-color":w||E,"--n-color-modal":w||J,"--n-color-popover":w||X,"--n-bezier":Y,"--n-merged-size":`var(--n-avatar-size-override, ${I})`}}),z=i?ie("avatar",P(()=>{const e=b.value,a=y.value,u=k.value,{color:w}=n;let g="";return e&&(typeof e=="number"?g+=`a${e}`:g+=e[0]),a&&(g+="b"),u&&(g+="c"),w&&(g+=de(w)),g}),j,n):void 0,C=h(!n.lazy);q(()=>{if(n.lazy&&n.intersectionObserverOptions){let e;const a=ue(()=>{e==null||e(),e=void 0,n.lazy&&(e=Ce(t.value,n.intersectionObserverOptions,C))});ce(()=>{a(),e==null||e()})}}),fe(()=>{var e;return n.src||((e=n.imgProps)===null||e===void 0?void 0:e.src)},()=>{f.value=!1});const r=h(!n.lazy);return{textRef:d,selfRef:t,mergedRoundRef:y,mergedClsPrefix:m,fitTextTransform:x,cssVars:i?void 0:j,themeClass:z==null?void 0:z.themeClass,onRender:z==null?void 0:z.onRender,hasLoadError:f,shouldStartLoading:C,loaded:r,mergedOnError:e=>{if(!C.value)return;f.value=!0;const{onError:a,imgProps:{onError:u}={}}=n;a==null||a(e),u==null||u(e)},mergedOnLoad:e=>{const{onLoad:a,imgProps:{onLoad:u}={}}=n;a==null||a(e),u==null||u(e),r.value=!0}}},render(){var n,m;const{$slots:i,src:f,mergedClsPrefix:v,lazy:d,onRender:t,loaded:x,hasLoadError:_,imgProps:b={}}=this;t==null||t();let p;const S=!x&&!_&&(this.renderPlaceholder?this.renderPlaceholder():(m=(n=this.$slots).placeholder)===null||m===void 0?void 0:m.call(n));return this.hasLoadError?p=this.renderFallback?this.renderFallback():ae(i.fallback,()=>[c("img",{src:this.fallbackSrc,style:{objectFit:this.objectFit}})]):p=te(i.default,y=>{if(y)return c(re,{onResize:this.fitTextTransform},{default:()=>c("span",{ref:"textRef",class:`${v}-avatar__text`},y)});if(f||b.src){const k=this.src||b.src;return c("img",Object.assign(Object.assign({},b),{loading:Pe&&!this.intersectionObserverOptions&&d?"lazy":"eager",src:d&&this.intersectionObserverOptions?this.shouldStartLoading?k:void 0:k,"data-image-src":k,onLoad:this.mergedOnLoad,onError:this.mergedOnError,style:[b.style||"",{objectFit:this.objectFit},S?{height:"0",width:"0",visibility:"hidden",position:"absolute"}:""]}))}}),c("span",{ref:"selfRef",class:[`${v}-avatar`,this.themeClass],style:this.cssVars},p,d&&S)}}),Ie={class:"p-4"},Me=G({__name:"index",setup(n){const m=ve(),i=h(!1),f=h(!1),v=h(!1),d=h(""),t=me({name:"",age:0,avatar:"",ct_avatar:"",description:"",link_url:"",role:"staff",sort:0}),x=h([]),_=[{title:"ID",key:"id",width:80,ellipsis:{tooltip:!0}},{title:"头像",key:"avatar",width:80,render(r){return c(W,{src:r.avatar,fallbackSrc:"https://avatar.vercel.sh/default",size:"small"})}},{title:"卡通头像",key:"ct_avatar",width:80,render(r){return c(W,{src:r.ct_avatar,fallbackSrc:"https://avatar.vercel.sh/cartoon",size:"small"})}},{title:"姓名",key:"name",width:100},{title:"个人简介",key:"description",width:200,ellipsis:{tooltip:!0}},{title:"个人中心链接",key:"link_url",width:150,render(r){return r.link_url?c(R,{size:"small",text:!0,type:"primary",onClick:()=>window.open(r.link_url,"_blank")},{default:()=>"访问"}):""}},{title:"排序",key:"sort",width:80,sorter:(r,e)=>(r.sort||0)-(e.sort||0)},{title:"创建时间",key:"created_at",width:150,render(r){return r.created_at?new Date(r.created_at).toLocaleDateString():""}},{title:"角色",key:"role",width:150,render(r){if(!r.role)return"";const e={Professor:"Professor",Staff:"Staff",Student:"Student"};return c(ze,{type:"info"},{default:()=>e[r.role]||r.role})}},{title:"操作",key:"actions",width:150,render(r){return c(B,null,{default:()=>[c(R,{size:"small",type:"primary",onClick:()=>y(r)},{default:()=>"编辑"}),c(je,{onPositiveClick:()=>j(r.id)},{default:()=>"确认删除这个成员吗？",trigger:()=>c(R,{size:"small",type:"error"},{default:()=>"删除"})})]})}}],b=P(()=>d.value?x.value.filter(r=>{var e,a;return r.name.includes(d.value)||((e=r.description)==null?void 0:e.includes(d.value))||((a=r.age)==null?void 0:a.toString().includes(d.value))}):x.value);async function p(){i.value=!0;try{const r=await we.from("member").select("*").order("sort",{ascending:!0});console.log(r),x.value=r.data||[]}catch(r){console.error("加载成员数据失败:",r),m.error("加载数据失败")}finally{i.value=!1}}function S(){v.value=!1,Object.assign(t,{name:"",age:0,avatar:"",ct_avatar:"",description:"",link_url:"",role:"staff",sort:0}),f.value=!0}function y(r){v.value=!0,Object.assign(t,r),f.value=!0}async function k(){i.value=!0;try{const r={name:t.name,age:t.age,avatar:t.avatar,ct_avatar:t.ct_avatar,description:t.description,link_url:t.link_url,role:t.role,sort:t.sort};v.value&&t.id?await Oe(t.id,r):await Ne(r),f.value=!1,await p()}catch(r){console.error("保存成员失败:",r),m.error("保存失败")}finally{i.value=!1}}async function j(r){i.value=!0;try{await Re(r),await p()}catch(e){console.error("删除成员失败:",e),m.error("删除失败")}finally{i.value=!1}}q(()=>{p()});const z=()=>{console.log("出发删除",t.id),A(t.id,"member"),t.avatar=""},C=()=>{console.log("出发删除",t.id),A(t.id,"member"),t.ct_avatar=""};return(r,e)=>(ge(),pe("div",Ie,[l(o(he),{title:"成员管理",bordered:!1},{"header-extra":s(()=>[l(o(B),null,{default:s(()=>[l(o(L),{value:d.value,"onUpdate:value":e[0]||(e[0]=a=>d.value=a),placeholder:"搜索姓名、年龄或个人简介",clearable:"",style:{width:"250px"}},null,8,["value"]),l(o(R),{type:"primary",onClick:S},{default:s(()=>e[10]||(e[10]=[O(" 新增成员 ")])),_:1})]),_:1})]),default:s(()=>[l(o(_e),{loading:i.value,columns:_,data:b.value,pagination:{pageSize:10},"row-key":a=>a.id},null,8,["loading","data","row-key"])]),_:1}),l(o(ke),{show:f.value,"onUpdate:show":e[9]||(e[9]=a=>f.value=a),preset:"dialog",style:{width:"600px"}},{header:s(()=>[O(ye(v.value?"编辑成员":"新增成员"),1)]),action:s(()=>[l(o(B),null,{default:s(()=>[l(o(R),{onClick:e[8]||(e[8]=a=>f.value=!1)},{default:s(()=>e[14]||(e[14]=[O("取消")])),_:1}),l(o(R),{type:"primary",onClick:k},{default:s(()=>e[15]||(e[15]=[O("确定")])),_:1})]),_:1})]),default:s(()=>[l(o(Ee),{model:t,"label-placement":"left","label-width":"80px","require-mark-placement":"right-hanging"},{default:s(()=>[l(o(N),{label:"姓名",path:"name",required:""},{default:s(()=>[l(o(L),{value:t.name,"onUpdate:value":e[1]||(e[1]=a=>t.name=a),placeholder:"请输入姓名"},null,8,["value"])]),_:1}),l(o(N),{label:"头像链接",path:"avatar"},{default:s(()=>[l(V,{modelValue:t.avatar,"onUpdate:modelValue":e[2]||(e[2]=a=>t.avatar=a),prefix:"member/avatar/",onImageDelete:z},null,8,["modelValue"])]),_:1}),l(o(N),{label:"卡通头像",path:"ct_avatar"},{default:s(()=>[l(V,{modelValue:t.ct_avatar,"onUpdate:modelValue":e[3]||(e[3]=a=>t.ct_avatar=a),prefix:"member/ct_avatar/",onImageDelete:C},null,8,["modelValue"])]),_:1}),l(o(N),{label:"个人简介",path:"description"},{default:s(()=>[l(o(L),{value:t.description,"onUpdate:value":e[4]||(e[4]=a=>t.description=a),placeholder:"请输入个人简介 (可选)",type:"textarea",rows:3},null,8,["value"])]),_:1}),l(o(N),{label:"个人中心",path:"link_url"},{default:s(()=>[l(o(L),{value:t.link_url,"onUpdate:value":e[5]||(e[5]=a=>t.link_url=a),placeholder:"请输入外部个人中心链接 (可选)"},null,8,["value"])]),_:1}),l(o(N),{label:"排序",path:"sort"},{default:s(()=>[l(o(be),{value:t.sort,"onUpdate:value":e[6]||(e[6]=a=>t.sort=a),placeholder:"请输入排序值 (数字越小排序越前)",min:0,step:1,style:{width:"100%"}},null,8,["value"])]),_:1}),l(o(N),{label:"角色",path:"role"},{default:s(()=>[l(o(Se),{value:t.role,"onUpdate:value":e[7]||(e[7]=a=>t.role=a)},{default:s(()=>[l(o(T),{value:"Professor"},{default:s(()=>e[11]||(e[11]=[O("Professor")])),_:1}),l(o(T),{value:"Staff"},{default:s(()=>e[12]||(e[12]=[O("Staff")])),_:1}),l(o(T),{value:"Student"},{default:s(()=>e[13]||(e[13]=[O("Student")])),_:1})]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show"])]))}}),We=xe(Me,[["__scopeId","data-v-93bc0a93"]]);export{We as default};
