import{b as I,c as M,e as $,f as z,N as L}from"./supabaseAction-DTzG44gK.js";import{d as V,j,r as f,k as q,a as E,l as K,b as R,o as T,f as a,w as r,i as n,N as m,B as k,h as y,t as w,m as O,p as x,v as P,x as b,_ as A}from"./index-C5NNhcj1.js";import{N as U}from"./Space-B1Q4eXpn.js";import{N as G}from"./Form-Dwv7jmx4.js";function H(){return I().then(s=>s||[])}function J(s){return $(s)}function Q(s,i){return M(s,i)}function W(s){return z(s)}const X={class:"p-4"},Y=V({__name:"index",setup(s){const i=j(),u=f(!1),p=f(!1),v=f(!1),c=f(""),d=f([]),o=q({content:"",time:"",link:""}),h=f([]),N=[{title:"ID",key:"id",width:80,ellipsis:{tooltip:!0}},{title:"内容",key:"content",width:300,ellipsis:{tooltip:!0},render(e){if(!e)return"-";const t=e.content||"";return t.length>100?t.substring(0,100)+"...":t}},{title:"时间",key:"time",width:150,render(e){return(e==null?void 0:e.time)||"-"}},{title:"链接",key:"link",width:250,ellipsis:{tooltip:!0},render(e){return e&&e.link?b("a",{href:e.link,target:"_blank",style:"color: #18a058; text-decoration: none;"},e.link):"-"}},{title:"创建时间",key:"created_at",width:150,render(e){return e&&e.created_at?new Date(e.created_at).toLocaleDateString("zh-CN"):"-"}},{title:"操作",key:"actions",width:150,fixed:"right",render(e){return!e||!e.id?"-":b(U,null,{default:()=>[b(k,{size:"small",type:"primary",onClick:()=>F(e)},{default:()=>"编辑"})]})}}],D=E(()=>c.value?h.value.filter(e=>{var t,l,_;return e&&(((t=e.content)==null?void 0:t.includes(c.value))||((l=e.time)==null?void 0:l.includes(c.value))||((_=e.link)==null?void 0:_.includes(c.value)))}):h.value);async function g(){u.value=!0;try{const e=await H();h.value=(e||[]).filter(t=>t&&t.id)}catch(e){console.error("加载关注我们数据失败:",e),i.error("加载数据失败"),h.value=[]}finally{u.value=!1}}function F(e){v.value=!0,Object.assign(o,{id:e.id,content:e.content||"",time:e.time||"",link:e.link||""}),p.value=!0}async function C(){if(!o.content){i.error("请填写内容");return}u.value=!0;try{const e={content:o.content,time:o.time||"",link:o.link||""};v.value&&o.id?(await Q(o.id,e),i.success("更新成功")):(await J(e),i.success("新增成功")),p.value=!1,await g()}catch(e){console.error("保存关注我们失败:",e),i.error("保存失败")}finally{u.value=!1}}async function S(){if(d.value.length===0){i.warning("请选择要删除的项目");return}u.value=!0;try{await Promise.all(d.value.map(e=>W(e))),i.success(`成功删除 ${d.value.length} 个项目`),d.value=[],await g()}catch(e){console.error("批量删除失败:",e),i.error("批量删除失败")}finally{u.value=!1}}function B(e){d.value=e.map(t=>String(t))}return K(()=>{g()}),(e,t)=>(T(),R("div",X,[a(n(O),{title:"关注我们管理",bordered:!1},{"header-extra":r(()=>[a(n(U),null,{default:r(()=>[a(n(m),{value:c.value,"onUpdate:value":t[0]||(t[0]=l=>c.value=l),placeholder:"搜索内容、时间或链接",clearable:"",style:{width:"250px"}},null,8,["value"]),a(n(k),{type:"error",disabled:d.value.length===0,onClick:S},{default:r(()=>[y(" 批量删除 ("+w(d.value.length)+") ",1)]),_:1},8,["disabled"])]),_:1})]),default:r(()=>[a(n(L),{loading:u.value,columns:N,data:D.value,pagination:{pageSize:10},"row-key":l=>(l==null?void 0:l.id)||"","scroll-x":1e3,"checked-row-keys":d.value,"onUpdate:checkedRowKeys":B},null,8,["loading","data","row-key","checked-row-keys"])]),_:1}),a(n(P),{show:p.value,"onUpdate:show":t[5]||(t[5]=l=>p.value=l),preset:"dialog",style:{width:"600px"}},{header:r(()=>[y(w(v.value?"编辑关注我们":"新增关注我们"),1)]),action:r(()=>[a(n(U),null,{default:r(()=>[a(n(k),{onClick:t[4]||(t[4]=l=>p.value=!1)},{default:r(()=>t[6]||(t[6]=[y("取消")])),_:1}),a(n(k),{type:"primary",onClick:C,loading:u.value},{default:r(()=>[y(w(v.value?"更新":"创建"),1)]),_:1},8,["loading"])]),_:1})]),default:r(()=>[a(n(G),{model:o,"label-placement":"left","label-width":"80px","require-mark-placement":"right-hanging"},{default:r(()=>[a(n(x),{label:"内容",path:"content",required:""},{default:r(()=>[a(n(m),{value:o.content,"onUpdate:value":t[1]||(t[1]=l=>o.content=l),type:"textarea",placeholder:"请输入内容",rows:6,maxlength:"2000","show-count":""},null,8,["value"])]),_:1}),a(n(x),{label:"时间",path:"time"},{default:r(()=>[a(n(m),{value:o.time,"onUpdate:value":t[2]||(t[2]=l=>o.time=l),placeholder:"请输入时间，如：2024-01-01",maxlength:"50"},null,8,["value"])]),_:1}),a(n(x),{label:"链接",path:"link"},{default:r(()=>[a(n(m),{value:o.link,"onUpdate:value":t[3]||(t[3]=l=>o.link=l),placeholder:"请输入相关链接，如：https://example.com",maxlength:"500"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show"])]))}}),ae=A(Y,[["__scopeId","data-v-de0c86b7"]]);export{ae as default};
