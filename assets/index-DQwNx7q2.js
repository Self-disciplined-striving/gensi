import{_ as I}from"./CosUploader-CBPpBg4t.js";import{N as S,h as U,j as V,k as M,l as q,a as z}from"./supabaseAction-DFcaFEeP.js";import{d as B,j as P,r as c,k as F,a as $,l as E,b as L,o as O,f as l,w as o,i as r,N as f,B as p,h as m,m as T,n as w,t as A,q as G,s as y,_ as H}from"./index-Apu7kVcP.js";import{N as g}from"./Space-WTEmmK0-.js";import{N as J}from"./Form-CVh8uTru.js";import{N as K}from"./Image-D7ZpuiYc.js";import"./supabase-B8zUYn7B.js";const Q={class:"p-4"},R=B({__name:"index",setup(W){const n=P(),s=c(!1),d=c(!1),v=c(!1),u=c(""),t=F({title:"",cover:"",description:"",views:0}),h=c([]),N=[{title:"ID",key:"id",width:80,ellipsis:{tooltip:!0}},{title:"项目图片",key:"cover",width:120,render(e){return e.cover?y(K,{src:e.cover,width:60,height:40,objectFit:"cover",style:"border-radius: 4px;"}):"暂无图片"}},{title:"项目名称",key:"title",ellipsis:{tooltip:!0}},{title:"项目描述",key:"description",width:200,ellipsis:{tooltip:!0}},{title:"浏览量",key:"views",width:100,render(e){return e.views.toLocaleString()}},{title:"创建时间",key:"created_at",width:150,render(e){return e.created_at?new Date(e.created_at).toLocaleDateString("zh-CN"):"-"}},{title:"操作",key:"actions",width:150,render(e){return y(g,null,{default:()=>[y(p,{size:"small",type:"primary",onClick:()=>_(e)},{default:()=>"编辑"}),y(p,{size:"small",type:"error",onClick:()=>D(e.id)},{default:()=>"删除"})]})}}],b=$(()=>u.value?h.value.filter(e=>e.title.includes(u.value)||e.description.includes(u.value)):h.value);async function k(){s.value=!0;try{const e=await U();h.value=e||[]}catch(e){console.error("加载项目数据失败:",e),n.error("加载数据失败")}finally{s.value=!1}}function x(){v.value=!1,Object.assign(t,{title:"",cover:"",description:"",views:0}),d.value=!0}function _(e){v.value=!0,Object.assign(t,e),d.value=!0}async function j(){if(!t.title||!t.description){n.error("请填写必填项");return}s.value=!0;try{const e={title:t.title,cover:t.cover||"",description:t.description,views:Number(t.views)||0};v.value&&t.id?(await V(t.id,e),n.success("更新成功")):(await M(e),n.success("新增成功")),d.value=!1,await k()}catch(e){console.error("保存项目失败:",e),n.error("保存失败")}finally{s.value=!1}}async function D(e){s.value=!0;try{await q(e),n.success("删除成功"),await k()}catch(a){console.error("删除项目失败:",a),n.error("删除失败")}finally{s.value=!1}}E(()=>{k()});const C=()=>{console.log("出发删除",t.id),z(t.id,"project"),t.cover=""};return(e,a)=>(O(),L("div",Q,[l(r(T),{title:"项目管理",bordered:!1},{"header-extra":o(()=>[l(r(g),null,{default:o(()=>[l(r(f),{value:u.value,"onUpdate:value":a[0]||(a[0]=i=>u.value=i),placeholder:"搜索项目名称或描述",clearable:"",style:{width:"200px"}},null,8,["value"]),l(r(p),{type:"primary",onClick:x},{default:o(()=>a[7]||(a[7]=[m(" 新增项目 ")])),_:1})]),_:1})]),default:o(()=>[l(r(S),{loading:s.value,columns:N,data:b.value,pagination:{pageSize:10},"row-key":i=>i.id},null,8,["loading","data","row-key"])]),_:1}),l(r(G),{show:d.value,"onUpdate:show":a[6]||(a[6]=i=>d.value=i),preset:"dialog",style:{width:"600px"}},{header:o(()=>[m(A(v.value?"编辑项目":"新增项目"),1)]),action:o(()=>[l(r(g),null,{default:o(()=>[l(r(p),{onClick:a[5]||(a[5]=i=>d.value=!1)},{default:o(()=>a[8]||(a[8]=[m("取消")])),_:1}),l(r(p),{type:"primary",onClick:j,loading:s.value},{default:o(()=>a[9]||(a[9]=[m("确定")])),_:1},8,["loading"])]),_:1})]),default:o(()=>[l(r(J),{model:t,"label-placement":"left","label-width":"80px","require-mark-placement":"right-hanging"},{default:o(()=>[l(r(w),{label:"项目名称",path:"title",required:""},{default:o(()=>[l(r(f),{value:t.title,"onUpdate:value":a[1]||(a[1]=i=>t.title=i),placeholder:"请输入项目名称"},null,8,["value"])]),_:1}),l(r(w),{label:"项目图片",path:"cover"},{default:o(()=>[l(r(g),{vertical:"",style:{width:"100%"}},{default:o(()=>[l(I,{modelValue:t.cover,"onUpdate:modelValue":a[2]||(a[2]=i=>t.cover=i),prefix:"project/cover/",onImageDelete:C},null,8,["modelValue"])]),_:1})]),_:1}),l(r(w),{label:"项目描述",path:"description",required:""},{default:o(()=>[l(r(f),{value:t.description,"onUpdate:value":a[3]||(a[3]=i=>t.description=i),type:"textarea",placeholder:"请输入项目描述",rows:3},null,8,["value"])]),_:1}),l(r(w),{label:"浏览量",path:"views"},{default:o(()=>[l(r(f),{value:t.views,"onUpdate:value":a[4]||(a[4]=i=>t.views=i),type:"number",placeholder:"请输入浏览量",min:0},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show"])]))}}),re=H(R,[["__scopeId","data-v-3cf2e5a4"]]);export{re as default};
