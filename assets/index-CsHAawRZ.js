import{Q as M}from"./vue-quill.snow-CxdYYdF7.js";import{_ as B}from"./CosUploader-Bzc04wBn.js";import{N as O,t as j,v as z,w as F,x as Q,a as T}from"./supabaseAction-DTzG44gK.js";import{d as $,j as A,r as d,k as L,a as G,l as H,b as J,o as K,f as a,w as n,i as o,N as w,B as p,h,m as P,e as b,p as f,t as R,v as W,x as v,_ as X}from"./index-C5NNhcj1.js";import{N as y}from"./Space-B1Q4eXpn.js";import{N as Y}from"./Form-Dwv7jmx4.js";import{N as Z}from"./cos-js-sdk-v5-Ci1OAid3.js";const ee={class:"p-4"},te={style:{"max-height":"70vh","overflow-y":"auto","padding-right":"12px"}},le={class:"editor-container"},ae=$({__name:"index",setup(oe){const u=A(),r=d(!1),s=d(!1),m=d(!1),c=d(""),x=d(),t=L({title:"",content:"",cover:"",news_link:"",time:"",created_by:"",views:0}),g=d([]),N={theme:"snow",modules:{toolbar:[["bold","italic","underline","strike"],["blockquote","code-block"],[{header:1},{header:2}],[{list:"ordered"},{list:"bullet"}],[{script:"sub"},{script:"super"}],[{indent:"-1"},{indent:"+1"}],[{direction:"rtl"}],[{size:["small",!1,"large","huge"]}],[{header:[1,2,3,4,5,6,!1]}],[{color:[]},{background:[]}],[{font:[]}],[{align:[]}],["clean"],["link","image","video"]]},placeholder:"请输入新闻内容...",readOnly:!1},D=[{title:"ID",key:"id",width:80,ellipsis:{tooltip:!0}},{title:"标题",key:"title",ellipsis:{tooltip:!0}},{title:"封面图片",key:"cover",width:120,render(e){return e.cover?v(Z,{width:60,height:40,src:e.cover,style:"object-fit: cover; border-radius: 4px;"}):"无图片"}},{title:"新闻链接",key:"news_link",width:120,ellipsis:{tooltip:!0},render(e){return e.news_link?v("a",{href:e.news_link,target:"_blank",style:"color: #18a058; text-decoration: underline;"},"查看链接"):"无链接"}},{title:"时间",key:"time",width:120,ellipsis:{tooltip:!0}},{title:"创建人",key:"created_by",width:120},{title:"创建时间",key:"create_time",width:180,render(e){return e.create_time?new Date(e.create_time).toLocaleString():"-"}},{title:"操作",key:"actions",width:150,render(e){return v(y,null,{default:()=>[v(p,{size:"small",type:"primary",onClick:()=>U(e)},{default:()=>"编辑"}),v(p,{size:"small",type:"error",onClick:()=>q(e.id)},{default:()=>"删除"})]})}}],C=G(()=>c.value?g.value.filter(e=>e.title.includes(c.value)||e.created_by.includes(c.value)):g.value),I=e=>{t.content=e};async function _(){r.value=!0;try{const e=await j();g.value=e||[]}catch(e){console.error("加载新闻数据失败:",e),u.error("加载数据失败")}finally{r.value=!1}}function S(){m.value=!1,Object.assign(t,{title:"",content:"",cover:"",news_link:"",time:"",created_by:"",views:0}),s.value=!0}function U(e){m.value=!0,Object.assign(t,e),s.value=!0}async function V(){if(!t.content){u.error("请填写必填字段");return}r.value=!0;try{const e={title:t.title,content:t.content,cover:t.cover,news_link:t.news_link,time:t.time,created_by:"admin",views:0};m.value&&t.id?await z(t.id,e):await F({...e,create_time:new Date().toISOString()}),s.value=!1,await _()}catch(e){console.error("保存新闻失败:",e),u.error("保存失败")}finally{r.value=!1}}async function q(e){r.value=!0;try{await Q(e),await _(),u.success("删除成功")}catch(l){console.error("删除新闻失败:",l),u.error("删除失败")}finally{r.value=!1}}const k=()=>{s.value=!1};H(()=>{_()});const E=()=>{console.log("出发删除",t.id),T(t.id,"news"),t.cover=""};return(e,l)=>(K(),J("div",ee,[a(o(P),{title:"新闻管理",bordered:!1},{"header-extra":n(()=>[a(o(y),null,{default:n(()=>[a(o(w),{value:c.value,"onUpdate:value":l[0]||(l[0]=i=>c.value=i),placeholder:"搜索新闻标题或创建人",clearable:"",style:{width:"200px"}},null,8,["value"]),a(o(p),{type:"primary",onClick:S},{default:n(()=>l[7]||(l[7]=[h(" 新增新闻 ")])),_:1})]),_:1})]),default:n(()=>[a(o(O),{loading:r.value,columns:D,data:C.value,pagination:{pageSize:10},"row-key":i=>i.id},null,8,["loading","data","row-key"])]),_:1}),a(o(W),{show:s.value,"onUpdate:show":l[6]||(l[6]=i=>s.value=i),preset:"dialog",style:{width:"900px","max-height":"90vh"},onClose:k},{header:n(()=>[h(R(m.value?"编辑新闻":"新增新闻"),1)]),action:n(()=>[a(o(y),null,{default:n(()=>[a(o(p),{onClick:k},{default:n(()=>l[8]||(l[8]=[h("取消")])),_:1}),a(o(p),{type:"primary",onClick:V,loading:r.value},{default:n(()=>l[9]||(l[9]=[h("确定")])),_:1},8,["loading"])]),_:1})]),default:n(()=>[b("div",te,[a(o(Y),{model:t,"label-placement":"left","label-width":"80px","require-mark-placement":"right-hanging"},{default:n(()=>[a(o(f),{label:"标题",path:"title"},{default:n(()=>[a(o(w),{value:t.title,"onUpdate:value":l[1]||(l[1]=i=>t.title=i),placeholder:"请输入新闻标题"},null,8,["value"])]),_:1}),a(o(f),{label:"封面图片",path:"cover"},{default:n(()=>[a(o(y),{vertical:"",style:{width:"100%"}},{default:n(()=>[a(B,{modelValue:t.cover,"onUpdate:modelValue":l[2]||(l[2]=i=>t.cover=i),prefix:"news/cover/",onImageDelete:E},null,8,["modelValue"])]),_:1})]),_:1}),a(o(f),{label:"新闻链接",path:"news_link"},{default:n(()=>[a(o(w),{value:t.news_link,"onUpdate:value":l[3]||(l[3]=i=>t.news_link=i),placeholder:"请输入新闻链接 (可选)"},null,8,["value"])]),_:1}),a(o(f),{label:"时间",path:"time"},{default:n(()=>[a(o(w),{value:t.time,"onUpdate:value":l[4]||(l[4]=i=>t.time=i),placeholder:"请输入时间 (可选)"},null,8,["value"])]),_:1}),a(o(f),{label:"内容",path:"content",required:""},{default:n(()=>[b("div",le,[a(o(M),{ref_key:"quillEditor",ref:x,content:t.content,"onUpdate:content":[l[5]||(l[5]=i=>t.content=i),I],options:N,"content-type":"html",style:{height:"400px"}},null,8,["content"])])]),_:1})]),_:1},8,["model"])])]),_:1},8,["show"])]))}}),pe=X(ae,[["__scopeId","data-v-f6854c86"]]);export{pe as default};
