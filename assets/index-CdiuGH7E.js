import{Q as H}from"./vue-quill.snow-CxdYYdF7.js";import{_ as J}from"./CosUploader-Bzc04wBn.js";import{g as W,u as X,i as Y,d as Z,N as ee,a as te}from"./supabaseAction-DTzG44gK.js";import{N as _}from"./Space-B1Q4eXpn.js";import{d as le,j as ae,r as c,k as ne,a as N,l as re,b as ie,o as D,f as r,w as i,i as n,N as x,B as m,h,t as B,m as oe,c as V,n as I,p,q as ue,e as se,s as de,v as ce,x as f,y as U,_ as pe}from"./index-C5NNhcj1.js";import{N as fe}from"./Form-Dwv7jmx4.js";import{N as ye}from"./cos-js-sdk-v5-Ci1OAid3.js";function ve(){return W()}function me(y){return Y(y)}function ge(y,o){return X(y,o)}function S(y){return Z(y)}const he={class:"p-4"},ke={class:"editor-container"},be=le({__name:"index",setup(y){const o=ae(),u=c(!1),v=c(!1),g=c(!1),d=c(""),s=c([]),q=c(),z=[{label:"根思五分钟系列",value:"根思五分钟系列"},{label:"根思深度系列",value:"根思深度系列"}],l=ne({title:"",content:"",cover:"",create_by:"",time:null,link_url:"",type:"根思五分钟系列"}),k=c([]),M={theme:"snow",modules:{toolbar:[["bold","italic","underline","strike"],["blockquote","code-block"],[{header:1},{header:2}],[{list:"ordered"},{list:"bullet"}],[{script:"sub"},{script:"super"}],[{indent:"-1"},{indent:"+1"}],[{direction:"rtl"}],[{size:["small",!1,"large","huge"]}],[{header:[1,2,3,4,5,6,!1]}],[{color:[]},{background:[]}],[{font:[]}],[{align:[]}],["clean"],["link","image","video"]]},placeholder:"请输入博客内容...",readOnly:!1},O=[{title:"ID",key:"id",width:80,ellipsis:{tooltip:!0}},{title:"封面图片",key:"cover",width:120,render(e){return e?e.cover?f(ye,{src:e.cover,width:60,height:40,objectFit:"cover",style:"border-radius: 4px;"}):"暂无图片":"数据错误"}},{title:"标题",key:"title",width:200,ellipsis:{tooltip:!0},render(e){return(e==null?void 0:e.title)||"-"}},{title:"分区类型",key:"type",width:120,render(e){return!e||!e.type?"-":f(U,{type:e.type==="根思五分钟系列"?"success":"warning",size:"small"},{default:()=>e.type})}},{title:"内容/链接",key:"content_or_link",width:300,ellipsis:{tooltip:!0},render(e){if(!e)return"-";if(e.type==="根思五分钟系列"&&e.link_url)return f("a",{href:e.link_url,target:"_blank",style:"color: #2080f0; text-decoration: none;"},"查看外部链接");if(e.type==="根思深度系列"&&e.content){const t=e.content.replace(/<[^>]*>/g,"");return t.length>80?t.substring(0,80)+"...":t}return"-"}},{title:"创建者",key:"create_by",width:120,render(e){return e?f(U,{type:"info",size:"small"},{default:()=>e.create_by||"未知"}):"-"}},{title:"发布时间",key:"time",width:120,render(e){return(e==null?void 0:e.time)||"-"}},{title:"创建时间",key:"created_at",width:150,render(e){return e&&e.created_at?new Date(e.created_at).toLocaleDateString("zh-CN"):"-"}},{title:"操作",key:"actions",width:150,fixed:"right",render(e){return!e||!e.id?"-":f(_,null,{default:()=>[f(m,{size:"small",type:"primary",onClick:()=>L(e)},{default:()=>"编辑"}),f(m,{size:"small",type:"error",onClick:()=>P(e.id)},{default:()=>"删除"})]})}}],T=N(()=>d.value?k.value.filter(e=>{var t,a,C,w;return e&&(((t=e.title)==null?void 0:t.includes(d.value))||((a=e.content)==null?void 0:a.includes(d.value))||((C=e.create_by)==null?void 0:C.includes(d.value))||((w=e.type)==null?void 0:w.includes(d.value)))}):k.value),$=e=>{l.content=e},E=N(()=>l.type==="根思五分钟系列"),F=N(()=>l.type==="根思深度系列");async function b(){u.value=!0;try{const e=await ve();k.value=(e||[]).filter(t=>t&&t.id)}catch(e){console.error("加载博客数据失败:",e),o.error("加载数据失败"),k.value=[]}finally{u.value=!1}}function j(){g.value=!1,Object.assign(l,{title:"",content:"",cover:"",create_by:"",time:null,link_url:"",type:"根思五分钟系列"}),v.value=!0}function L(e){g.value=!0;let t=null;e.time&&R(e.time)&&(t=new Date(e.time).getTime()),Object.assign(l,{...e,time:t,type:e.type||"根思五分钟系列"}),v.value=!0}function R(e){if(!e||!/^\d{4}-\d{2}-\d{2}$/.test(e))return!1;const a=new Date(e);return a instanceof Date&&!isNaN(a.getTime())}async function K(){if(!l.title){o.error("请填写标题");return}if(l.type==="根思五分钟系列"&&!l.link_url){o.error("根思五分钟系列需要填写外部链接");return}if(l.type==="根思深度系列"&&!l.content){o.error("根思深度系列需要填写内容");return}u.value=!0;try{let e="";l.time?typeof l.time=="number"?e=new Date(l.time).toISOString().split("T")[0]:typeof l.time=="string"&&(e=l.time):e=new Date().toISOString().split("T")[0];const t={title:l.title,content:l.type==="根思深度系列"&&l.content||"",cover:l.cover||"",create_by:l.create_by||"管理员",time:e,link_url:l.type==="根思五分钟系列"&&l.link_url||"",type:l.type||"根思五分钟系列"};g.value&&l.id?(await ge(l.id,t),o.success("更新成功")):(await me(t),o.success("新增成功")),v.value=!1,await b()}catch(e){console.error("保存博客失败:",e),o.error("保存失败")}finally{u.value=!1}}async function P(e){u.value=!0;try{await S(e),o.success("删除成功"),await b()}catch(t){console.error("删除博客失败:",t),o.error("删除失败")}finally{u.value=!1}}async function Q(){if(s.value.length===0){o.warning("请选择要删除的博客");return}u.value=!0;try{await Promise.all(s.value.map(e=>S(e))),o.success(`成功删除 ${s.value.length} 篇博客`),s.value=[],await b()}catch(e){console.error("批量删除失败:",e),o.error("批量删除失败")}finally{u.value=!1}}function A(e){s.value=e.map(t=>String(t))}re(()=>{b()});const G=()=>{console.log("出发删除",l.id),te(l.id,"blog"),l.cover=""};return(e,t)=>(D(),ie("div",he,[r(n(oe),{title:"博客管理",bordered:!1},{"header-extra":i(()=>[r(n(_),null,{default:i(()=>[r(n(x),{value:d.value,"onUpdate:value":t[0]||(t[0]=a=>d.value=a),placeholder:"搜索标题、内容或创建者",clearable:"",style:{width:"250px"}},null,8,["value"]),r(n(m),{type:"error",disabled:s.value.length===0,onClick:Q},{default:i(()=>[h(" 批量删除 ("+B(s.value.length)+") ",1)]),_:1},8,["disabled"]),r(n(m),{type:"primary",onClick:j},{default:i(()=>t[10]||(t[10]=[h(" 新增博客 ")])),_:1})]),_:1})]),default:i(()=>[r(n(ee),{loading:u.value,columns:O,data:T.value,pagination:{pageSize:10},"row-key":a=>(a==null?void 0:a.id)||"","scroll-x":1400,"checked-row-keys":s.value,"onUpdate:checkedRowKeys":A},null,8,["loading","data","row-key","checked-row-keys"])]),_:1}),r(n(ce),{show:v.value,"onUpdate:show":t[9]||(t[9]=a=>v.value=a),preset:"dialog",style:{width:"900px"}},{header:i(()=>[h(B(g.value?"编辑博客":"新增博客"),1)]),action:i(()=>[r(n(_),null,{default:i(()=>[r(n(m),{onClick:t[8]||(t[8]=a=>v.value=!1)},{default:i(()=>t[11]||(t[11]=[h("取消")])),_:1}),r(n(m),{type:"primary",onClick:K,loading:u.value},{default:i(()=>[h(B(g.value?"更新":"创建"),1)]),_:1},8,["loading"])]),_:1})]),default:i(()=>[r(n(fe),{model:l,"label-placement":"left","label-width":"100px","require-mark-placement":"right-hanging"},{default:i(()=>[r(n(p),{label:"标题",path:"title",required:""},{default:i(()=>[r(n(x),{value:l.title,"onUpdate:value":t[1]||(t[1]=a=>l.title=a),placeholder:"请输入博客标题",maxlength:"200","show-count":""},null,8,["value"])]),_:1}),r(n(p),{label:"封面图片",path:"cover"},{default:i(()=>[r(n(_),{vertical:"",style:{width:"100%"}},{default:i(()=>[r(J,{modelValue:l.cover,"onUpdate:modelValue":t[2]||(t[2]=a=>l.cover=a),prefix:"blog/cover/",onImageDelete:G},null,8,["modelValue"])]),_:1})]),_:1}),r(n(p),{label:"分区类型",path:"type",required:""},{default:i(()=>[r(n(ue),{value:l.type,"onUpdate:value":t[3]||(t[3]=a=>l.type=a),options:z,placeholder:"请选择分区类型"},null,8,["value"])]),_:1}),F.value?(D(),V(n(p),{key:0,label:"内容",path:"content"},{default:i(()=>[se("div",ke,[r(n(H),{ref_key:"quillEditor",ref:q,content:l.content,"onUpdate:content":[t[4]||(t[4]=a=>l.content=a),$],options:M,"content-type":"html",style:{height:"400px"}},null,8,["content"])])]),_:1})):I("",!0),E.value?(D(),V(n(p),{key:1,label:"外部链接",path:"link_url"},{default:i(()=>[r(n(x),{value:l.link_url,"onUpdate:value":t[5]||(t[5]=a=>l.link_url=a),placeholder:"请输入外部链接，如：https://example.com",maxlength:"500"},null,8,["value"])]),_:1})):I("",!0),r(n(p),{label:"创建者",path:"create_by"},{default:i(()=>[r(n(x),{value:l.create_by,"onUpdate:value":t[6]||(t[6]=a=>l.create_by=a),placeholder:"请输入创建者姓名",maxlength:"50"},null,8,["value"])]),_:1}),r(n(p),{label:"发布时间",path:"time"},{default:i(()=>[r(n(de),{value:l.time,"onUpdate:value":t[7]||(t[7]=a=>l.time=a),"value-format":"yyyy-MM-dd",type:"date",placeholder:"请选择发布时间",style:{width:"100%"},clearable:""},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show"])]))}}),Ve=pe(be,[["__scopeId","data-v-203350fa"]]);export{Ve as default};
