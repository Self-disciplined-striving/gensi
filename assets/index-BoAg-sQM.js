import{Q as V}from"./vue-quill.snow-CxdYYdF7.js";import{_ as B}from"./CosUploader-Bzc04wBn.js";import{N as E,y as U,z as M,A as S,B as O,a as P}from"./supabaseAction-DTzG44gK.js";import{d as F,j as $,r as u,k as A,a as Q,l as T,b as L,o as G,f as a,w as o,i as r,N as _,B as c,h as m,m as H,p as h,e as J,t as K,v as R,x as f,_ as W}from"./index-C5NNhcj1.js";import{N as y}from"./Space-B1Q4eXpn.js";import{N as X}from"./Form-Dwv7jmx4.js";import{N as Y}from"./cos-js-sdk-v5-Ci1OAid3.js";const Z={class:"p-4"},ee={class:"editor-container"},te=F({__name:"index",setup(le){const s=$(),n=u(!1),d=u(!1),v=u(!1),p=u(""),w=u(),t=A({title:"",cover:"",description:"",views:0,link_url:""}),k=u([]),b=[{title:"ID",key:"id",width:80,ellipsis:{tooltip:!0}},{title:"项目图片",key:"cover",width:120,render(e){return e.cover?f(Y,{src:e.cover,width:60,height:40,objectFit:"cover",style:"border-radius: 4px;"}):"暂无图片"}},{title:"项目名称",key:"title",ellipsis:{tooltip:!0}},{title:"项目描述",key:"description",width:200,ellipsis:{tooltip:!0}},{title:"外部链接",key:"link_url",width:120,render(e){return e.link_url?f(c,{size:"small",tag:"a",href:e.link_url,target:"_blank",type:"primary",ghost:!0},{default:()=>"查看链接"}):"-"}},{title:"创建时间",key:"created_at",width:150,render(e){return e.created_at?new Date(e.created_at).toLocaleDateString("zh-CN"):"-"}},{title:"操作",key:"actions",width:150,render(e){return f(y,null,{default:()=>[f(c,{size:"small",type:"primary",onClick:()=>D(e)},{default:()=>"编辑"}),f(c,{size:"small",type:"error",onClick:()=>I(e.id)},{default:()=>"删除"})]})}}],N=Q(()=>p.value?k.value.filter(e=>e.title.includes(p.value)||e.description.includes(p.value)):k.value),x={theme:"snow",modules:{toolbar:[["bold","italic","underline","strike"],["blockquote","code-block"],[{header:1},{header:2}],[{list:"ordered"},{list:"bullet"}],[{script:"sub"},{script:"super"}],[{indent:"-1"},{indent:"+1"}],[{direction:"rtl"}],[{size:["small",!1,"large","huge"]}],[{header:[1,2,3,4,5,6,!1]}],[{color:[]},{background:[]}],[{font:[]}],[{align:[]}],["clean"],["link","image","video"]]},placeholder:"请输入项目描述...",readOnly:!1};async function g(){n.value=!0;try{const e=await U();k.value=e||[]}catch(e){console.error("加载项目数据失败:",e),s.error("加载数据失败")}finally{n.value=!1}}function j(){v.value=!1,Object.assign(t,{title:"",cover:"",description:"",views:0,link_url:""}),d.value=!0}function D(e){v.value=!0,Object.assign(t,e),d.value=!0}async function C(){if(!t.title||!t.description){s.error("请填写必填项");return}n.value=!0;try{const e={title:t.title,cover:t.cover||"",description:t.description,views:Number(t.views)||0,link_url:t.link_url||""};v.value&&t.id?(await M(t.id,e),s.success("更新成功")):(await S(e),s.success("新增成功")),d.value=!1,await g()}catch(e){console.error("保存项目失败:",e),s.error("保存失败")}finally{n.value=!1}}async function I(e){n.value=!0;try{await O(e),s.success("删除成功"),await g()}catch(l){console.error("删除项目失败:",l),s.error("删除失败")}finally{n.value=!1}}T(()=>{g()});const q=()=>{console.log("出发删除",t.id),P(t.id,"project"),t.cover=""},z=e=>{t.description=e};return(e,l)=>(G(),L("div",Z,[a(r(H),{title:"项目管理",bordered:!1},{"header-extra":o(()=>[a(r(y),null,{default:o(()=>[a(r(_),{value:p.value,"onUpdate:value":l[0]||(l[0]=i=>p.value=i),placeholder:"搜索项目名称或描述",clearable:"",style:{width:"200px"}},null,8,["value"]),a(r(c),{type:"primary",onClick:j},{default:o(()=>l[7]||(l[7]=[m(" 新增项目 ")])),_:1})]),_:1})]),default:o(()=>[a(r(E),{loading:n.value,columns:b,data:N.value,pagination:{pageSize:10},"row-key":i=>i.id},null,8,["loading","data","row-key"])]),_:1}),a(r(R),{show:d.value,"onUpdate:show":l[6]||(l[6]=i=>d.value=i),preset:"dialog",style:{width:"800px"}},{header:o(()=>[m(K(v.value?"编辑项目":"新增项目"),1)]),action:o(()=>[a(r(y),null,{default:o(()=>[a(r(c),{onClick:l[5]||(l[5]=i=>d.value=!1)},{default:o(()=>l[8]||(l[8]=[m("取消")])),_:1}),a(r(c),{type:"primary",onClick:C,loading:n.value},{default:o(()=>l[9]||(l[9]=[m("确定")])),_:1},8,["loading"])]),_:1})]),default:o(()=>[a(r(X),{model:t,"label-placement":"left","label-width":"80px","require-mark-placement":"right-hanging"},{default:o(()=>[a(r(h),{label:"项目名称",path:"title",required:""},{default:o(()=>[a(r(_),{value:t.title,"onUpdate:value":l[1]||(l[1]=i=>t.title=i),placeholder:"请输入项目名称"},null,8,["value"])]),_:1}),a(r(h),{label:"项目图片",path:"cover"},{default:o(()=>[a(r(y),{vertical:"",style:{width:"100%"}},{default:o(()=>[a(B,{modelValue:t.cover,"onUpdate:modelValue":l[2]||(l[2]=i=>t.cover=i),prefix:"project/cover/",onImageDelete:q},null,8,["modelValue"])]),_:1})]),_:1}),a(r(h),{label:"外部链接",path:"link_url"},{default:o(()=>[a(r(_),{value:t.link_url,"onUpdate:value":l[3]||(l[3]=i=>t.link_url=i),placeholder:"请输入外部链接地址 (如：https://example.com)"},null,8,["value"])]),_:1}),a(r(h),{label:"项目描述",path:"description",required:""},{default:o(()=>[J("div",ee,[a(r(V),{ref_key:"quillEditor",ref:w,content:t.description,"onUpdate:content":[l[4]||(l[4]=i=>t.description=i),z],options:x,"content-type":"html",style:{height:"300px"}},null,8,["content"])])]),_:1})]),_:1},8,["model"])]),_:1},8,["show"])]))}}),ue=W(te,[["__scopeId","data-v-419c1b6a"]]);export{ue as default};
