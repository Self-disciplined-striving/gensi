import{N as P,h as S,j as M,k as U,l as _}from"./supabaseAction-CsXWuVGY.js";import{d as H,j as L,r as c,k as V,a as Z,l as z,b,o as j,f as l,w as i,i as r,N as p,B as v,h as m,m as A,n as w,y as F,e as R,t as Q,q as T,s as y,_ as q}from"./index-C9izoxC8.js";import{N as g}from"./Space-DlBK14Y7.js";import{N as Y}from"./Form-PnC4zqqV.js";import{N as k}from"./Image-BIKV7t1q.js";import"./supabase-C7S-aqbW.js";const E={class:"p-4"},X={key:0,style:{"margin-top":"8px"}},G=H({__name:"index",setup(O){const n=L(),s=c(!1),d=c(!1),f=c(!1),u=c(""),a=V({title:"",cover:"",description:"",views:0}),I=c([]),x=[{title:"ID",key:"id",width:80,ellipsis:{tooltip:!0}},{title:"项目图片",key:"cover",width:120,render(e){return e.cover?y(k,{src:e.cover,width:60,height:40,objectFit:"cover",style:"border-radius: 4px;"}):"暂无图片"}},{title:"项目名称",key:"title",ellipsis:{tooltip:!0}},{title:"项目描述",key:"description",width:200,ellipsis:{tooltip:!0}},{title:"浏览量",key:"views",width:100,render(e){return e.views.toLocaleString()}},{title:"创建时间",key:"created_at",width:150,render(e){return e.created_at?new Date(e.created_at).toLocaleDateString("zh-CN"):"-"}},{title:"操作",key:"actions",width:150,render(e){return y(g,null,{default:()=>[y(v,{size:"small",type:"primary",onClick:()=>D(e)},{default:()=>"编辑"}),y(v,{size:"small",type:"error",onClick:()=>W(e.id)},{default:()=>"删除"})]})}}],N=Z(()=>u.value?I.value.filter(e=>e.title.includes(u.value)||e.description.includes(u.value)):I.value);async function h(){s.value=!0;try{const e=await S();I.value=e||[]}catch(e){console.error("加载项目数据失败:",e),n.error("加载数据失败")}finally{s.value=!1}}function B(){f.value=!1,Object.assign(a,{title:"",cover:"",description:"",views:0}),d.value=!0}function D(e){f.value=!0,Object.assign(a,e),d.value=!0}async function C(){if(!a.title||!a.description){n.error("请填写必填项");return}s.value=!0;try{const e={title:a.title,cover:a.cover||"",description:a.description,views:Number(a.views)||0};f.value&&a.id?(await M(a.id,e),n.success("更新成功")):(await U(e),n.success("新增成功")),d.value=!1,await h()}catch(e){console.error("保存项目失败:",e),n.error("保存失败")}finally{s.value=!1}}async function W(e){s.value=!0;try{await _(e),n.success("删除成功"),await h()}catch(t){console.error("删除项目失败:",t),n.error("删除失败")}finally{s.value=!1}}return z(()=>{h()}),(e,t)=>(j(),b("div",E,[l(r(A),{title:"项目管理",bordered:!1},{"header-extra":i(()=>[l(r(g),null,{default:i(()=>[l(r(p),{value:u.value,"onUpdate:value":t[0]||(t[0]=o=>u.value=o),placeholder:"搜索项目名称或描述",clearable:"",style:{width:"200px"}},null,8,["value"]),l(r(v),{type:"primary",onClick:B},{default:i(()=>t[7]||(t[7]=[m(" 新增项目 ")])),_:1})]),_:1})]),default:i(()=>[l(r(P),{loading:s.value,columns:x,data:N.value,pagination:{pageSize:10},"row-key":o=>o.id},null,8,["loading","data","row-key"])]),_:1}),l(r(T),{show:d.value,"onUpdate:show":t[6]||(t[6]=o=>d.value=o),preset:"dialog",style:{width:"600px"}},{header:i(()=>[m(Q(f.value?"编辑项目":"新增项目"),1)]),action:i(()=>[l(r(g),null,{default:i(()=>[l(r(v),{onClick:t[5]||(t[5]=o=>d.value=!1)},{default:i(()=>t[9]||(t[9]=[m("取消")])),_:1}),l(r(v),{type:"primary",onClick:C,loading:s.value},{default:i(()=>t[10]||(t[10]=[m("确定")])),_:1},8,["loading"])]),_:1})]),default:i(()=>[l(r(Y),{model:a,"label-placement":"left","label-width":"80px","require-mark-placement":"right-hanging"},{default:i(()=>[l(r(w),{label:"项目名称",path:"title",required:""},{default:i(()=>[l(r(p),{value:a.title,"onUpdate:value":t[1]||(t[1]=o=>a.title=o),placeholder:"请输入项目名称"},null,8,["value"])]),_:1}),l(r(w),{label:"项目图片",path:"cover"},{default:i(()=>[l(r(g),{vertical:"",style:{width:"100%"}},{default:i(()=>[l(r(p),{value:a.cover,"onUpdate:value":t[2]||(t[2]=o=>a.cover=o),placeholder:"请输入图片URL链接"},null,8,["value"]),a.cover?(j(),b("div",X,[t[8]||(t[8]=R("span",{style:{"font-size":"12px",color:"#666"}},"预览：",-1)),l(r(k),{src:a.cover,width:"100",height:"80","object-fit":"cover",style:{"border-radius":"4px","margin-top":"4px"},"fallback-src":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjgwIiB2aWV3Qm94PSIwIDAgMTAwIDgwIiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgo8cmVjdCB3aWR0aD0iMTAwIiBoZWlnaHQ9IjgwIiBmaWxsPSIjRjVGNUY1Ii8+Cjx0ZXh0IHg9IjUwIiB5PSI0NSIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjEyIiBmaWxsPSIjQ0NDIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj7lm77niYflpLHotKU8L3RleHQ+Cjwvc3ZnPgo="},null,8,["src"])])):F("",!0)]),_:1})]),_:1}),l(r(w),{label:"项目描述",path:"description",required:""},{default:i(()=>[l(r(p),{value:a.description,"onUpdate:value":t[3]||(t[3]=o=>a.description=o),type:"textarea",placeholder:"请输入项目描述",rows:3},null,8,["value"])]),_:1}),l(r(w),{label:"浏览量",path:"views"},{default:i(()=>[l(r(p),{value:a.views,"onUpdate:value":t[4]||(t[4]=o=>a.views=o),type:"number",placeholder:"请输入浏览量",min:0},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show"])]))}}),le=q(G,[["__scopeId","data-v-8ae56a20"]]);export{le as default};
