import{_ as B}from"./CosUploader-B-7czNlT.js";import{N as J,m as Q,n as I,o as ee,p as ae,q as te,r as re,a as $}from"./supabaseAction-CsXWuVGY.js";import{ac as le,W as H,ad as oe,ae as ne,af as T,X as U,d as q,ag as se,s as c,Y as ie,ah as de,Z as ue,r as h,ai as W,a as P,a0 as G,aj as ce,ak as fe,al as ve,a3 as me,am as pe,l as K,an as ge,ao as he,a7 as be,j as ye,k as ke,b as ze,o as _e,f as l,w as s,i as o,N as E,B as N,h as O,m as xe,n as R,t as we,q as Se,v as Oe,_ as Ne}from"./index-C9izoxC8.js";import{i as Re,o as Pe}from"./Image-BIKV7t1q.js";import{N as je}from"./Popconfirm-MRuTehCi.js";import{N as V}from"./Space-DlBK14Y7.js";import{N as Ce}from"./Form-PnC4zqqV.js";import"./supabase-C7S-aqbW.js";const Le=le("n-avatar-group"),Ee=H("avatar",`
 width: var(--n-merged-size);
 height: var(--n-merged-size);
 color: #FFF;
 font-size: var(--n-font-size);
 display: inline-flex;
 position: relative;
 overflow: hidden;
 text-align: center;
 border: var(--n-border);
 border-radius: var(--n-border-radius);
 --n-merged-color: var(--n-color);
 background-color: var(--n-merged-color);
 transition:
 border-color .3s var(--n-bezier),
 background-color .3s var(--n-bezier),
 color .3s var(--n-bezier);
`,[oe(T("&","--n-merged-color: var(--n-color-modal);")),ne(T("&","--n-merged-color: var(--n-color-popover);")),T("img",`
 width: 100%;
 height: 100%;
 `),U("text",`
 white-space: nowrap;
 display: inline-block;
 position: absolute;
 left: 50%;
 top: 50%;
 `),H("icon",`
 vertical-align: bottom;
 font-size: calc(var(--n-merged-size) - 6px);
 `),U("text","line-height: 1.25")]),Fe=Object.assign(Object.assign({},G.props),{size:[String,Number],src:String,circle:{type:Boolean,default:void 0},objectFit:String,round:{type:Boolean,default:void 0},bordered:{type:Boolean,default:void 0},onError:Function,fallbackSrc:String,intersectionObserverOptions:Object,lazy:Boolean,onLoad:Function,renderPlaceholder:Function,renderFallback:Function,imgProps:Object,color:String}),A=q({name:"Avatar",props:Fe,slots:Object,setup(n){const{mergedClsPrefixRef:m,inlineThemeDisabled:i}=ue(n),f=h(!1);let v=null;const d=h(null),t=h(null),x=()=>{const{value:e}=d;if(e&&(v===null||v!==e.innerHTML)){v=e.innerHTML;const{value:a}=t;if(a){const{offsetWidth:u,offsetHeight:_}=a,{offsetWidth:g,offsetHeight:F}=e,L=.9,D=Math.min(u/g*L,_/F*L,1);e.style.transform=`translateX(-50%) translateY(-50%) scale(${D})`}}},w=W(Le,null),b=P(()=>{const{size:e}=n;if(e)return e;const{size:a}=w||{};return a||"medium"}),p=G("Avatar","-avatar",Ee,ce,n,m),S=W(fe,null),y=P(()=>{if(w)return!0;const{round:e,circle:a}=n;return e!==void 0||a!==void 0?e||a:S?S.roundRef.value:!1}),k=P(()=>w?!0:n.bordered||!1),C=P(()=>{const e=b.value,a=y.value,u=k.value,{color:_}=n,{self:{borderRadius:g,fontSize:F,color:L,border:D,colorModal:X,colorPopover:Y},common:{cubicBezierEaseInOut:Z}}=p.value;let M;return typeof e=="number"?M=`${e}px`:M=p.value.self[ve("height",e)],{"--n-font-size":F,"--n-border":u?D:"none","--n-border-radius":a?"50%":g,"--n-color":_||L,"--n-color-modal":_||X,"--n-color-popover":_||Y,"--n-bezier":Z,"--n-merged-size":`var(--n-avatar-size-override, ${M})`}}),z=i?me("avatar",P(()=>{const e=b.value,a=y.value,u=k.value,{color:_}=n;let g="";return e&&(typeof e=="number"?g+=`a${e}`:g+=e[0]),a&&(g+="b"),u&&(g+="c"),_&&(g+=pe(_)),g}),C,n):void 0,j=h(!n.lazy);K(()=>{if(n.lazy&&n.intersectionObserverOptions){let e;const a=ge(()=>{e==null||e(),e=void 0,n.lazy&&(e=Pe(t.value,n.intersectionObserverOptions,j))});he(()=>{a(),e==null||e()})}}),be(()=>{var e;return n.src||((e=n.imgProps)===null||e===void 0?void 0:e.src)},()=>{f.value=!1});const r=h(!n.lazy);return{textRef:d,selfRef:t,mergedRoundRef:y,mergedClsPrefix:m,fitTextTransform:x,cssVars:i?void 0:C,themeClass:z==null?void 0:z.themeClass,onRender:z==null?void 0:z.onRender,hasLoadError:f,shouldStartLoading:j,loaded:r,mergedOnError:e=>{if(!j.value)return;f.value=!0;const{onError:a,imgProps:{onError:u}={}}=n;a==null||a(e),u==null||u(e)},mergedOnLoad:e=>{const{onLoad:a,imgProps:{onLoad:u}={}}=n;a==null||a(e),u==null||u(e),r.value=!0}}},render(){var n,m;const{$slots:i,src:f,mergedClsPrefix:v,lazy:d,onRender:t,loaded:x,hasLoadError:w,imgProps:b={}}=this;t==null||t();let p;const S=!x&&!w&&(this.renderPlaceholder?this.renderPlaceholder():(m=(n=this.$slots).placeholder)===null||m===void 0?void 0:m.call(n));return this.hasLoadError?p=this.renderFallback?this.renderFallback():se(i.fallback,()=>[c("img",{src:this.fallbackSrc,style:{objectFit:this.objectFit}})]):p=ie(i.default,y=>{if(y)return c(de,{onResize:this.fitTextTransform},{default:()=>c("span",{ref:"textRef",class:`${v}-avatar__text`},y)});if(f||b.src){const k=this.src||b.src;return c("img",Object.assign(Object.assign({},b),{loading:Re&&!this.intersectionObserverOptions&&d?"lazy":"eager",src:d&&this.intersectionObserverOptions?this.shouldStartLoading?k:void 0:k,"data-image-src":k,onLoad:this.mergedOnLoad,onError:this.mergedOnError,style:[b.style||"",{objectFit:this.objectFit},S?{height:"0",width:"0",visibility:"hidden",position:"absolute"}:""]}))}}),c("span",{ref:"selfRef",class:[`${v}-avatar`,this.themeClass],style:this.cssVars},p,d&&S)}}),De={class:"p-4"},Me=q({__name:"index",setup(n){const m=ye(),i=h(!1),f=h(!1),v=h(!1),d=h(""),t=ke({name:"",age:0,avatar:"",ct_avatar:"",description:"",link_url:"",role:"staff"}),x=h([]),w=[{title:"ID",key:"id",width:80,ellipsis:{tooltip:!0}},{title:"头像",key:"avatar",width:80,render(r){return c(A,{src:r.avatar,fallbackSrc:"https://avatar.vercel.sh/default",size:"small"})}},{title:"卡通头像",key:"ct_avatar",width:80,render(r){return c(A,{src:r.ct_avatar,fallbackSrc:"https://avatar.vercel.sh/cartoon",size:"small"})}},{title:"姓名",key:"name",width:100},{title:"个人简介",key:"description",width:200,ellipsis:{tooltip:!0}},{title:"个人中心链接",key:"link_url",width:150,render(r){return r.link_url?c(N,{size:"small",text:!0,type:"primary",onClick:()=>window.open(r.link_url,"_blank")},{default:()=>"访问"}):""}},{title:"创建时间",key:"created_at",width:150,render(r){return r.created_at?new Date(r.created_at).toLocaleDateString():""}},{title:"角色",key:"role",width:150,render(r){if(!r.role)return"";const e={Professor:"Professor",Staff:"Staff",Student:"Student"};return c(Oe,{type:"info"},{default:()=>e[r.role]||r.role})}},{title:"操作",key:"actions",width:150,render(r){return c(V,null,{default:()=>[c(N,{size:"small",type:"primary",onClick:()=>y(r)},{default:()=>"编辑"}),c(je,{onPositiveClick:()=>C(r.id)},{default:()=>"确认删除这个成员吗？",trigger:()=>c(N,{size:"small",type:"error"},{default:()=>"删除"})})]})}}],b=P(()=>d.value?x.value.filter(r=>{var e,a;return r.name.includes(d.value)||((e=r.description)==null?void 0:e.includes(d.value))||((a=r.age)==null?void 0:a.toString().includes(d.value))}):x.value);async function p(){i.value=!0;try{const r=await ee();x.value=r||[]}catch(r){console.error("加载成员数据失败:",r),m.error("加载数据失败")}finally{i.value=!1}}function S(){v.value=!1,Object.assign(t,{name:"",age:0,avatar:"",ct_avatar:"",description:"",link_url:"",role:"staff"}),f.value=!0}function y(r){v.value=!0,Object.assign(t,r),f.value=!0}async function k(){i.value=!0;try{const r={name:t.name,age:t.age,avatar:t.avatar,ct_avatar:t.ct_avatar,description:t.description,link_url:t.link_url,role:t.role};v.value&&t.id?await ae(t.id,r):await te(r),f.value=!1,await p()}catch(r){console.error("保存成员失败:",r),m.error("保存失败")}finally{i.value=!1}}async function C(r){i.value=!0;try{await re(r),await p()}catch(e){console.error("删除成员失败:",e),m.error("删除失败")}finally{i.value=!1}}K(()=>{p()});const z=()=>{console.log("出发删除",t.id),$(t.id,"member"),t.avatar=""},j=()=>{console.log("出发删除",t.id),$(t.id,"member"),t.ct_avatar=""};return(r,e)=>(_e(),ze("div",De,[l(o(xe),{title:"成员管理",bordered:!1},{"header-extra":s(()=>[l(o(V),null,{default:s(()=>[l(o(E),{value:d.value,"onUpdate:value":e[0]||(e[0]=a=>d.value=a),placeholder:"搜索姓名、年龄或个人简介",clearable:"",style:{width:"250px"}},null,8,["value"]),l(o(N),{type:"primary",onClick:S},{default:s(()=>e[9]||(e[9]=[O(" 新增成员 ")])),_:1})]),_:1})]),default:s(()=>[l(o(J),{loading:i.value,columns:w,data:b.value,pagination:{pageSize:10},"row-key":a=>a.id},null,8,["loading","data","row-key"])]),_:1}),l(o(Se),{show:f.value,"onUpdate:show":e[8]||(e[8]=a=>f.value=a),preset:"dialog",style:{width:"600px"}},{header:s(()=>[O(we(v.value?"编辑成员":"新增成员"),1)]),action:s(()=>[l(o(V),null,{default:s(()=>[l(o(N),{onClick:e[7]||(e[7]=a=>f.value=!1)},{default:s(()=>e[13]||(e[13]=[O("取消")])),_:1}),l(o(N),{type:"primary",onClick:k},{default:s(()=>e[14]||(e[14]=[O("确定")])),_:1})]),_:1})]),default:s(()=>[l(o(Ce),{model:t,"label-placement":"left","label-width":"80px","require-mark-placement":"right-hanging"},{default:s(()=>[l(o(R),{label:"姓名",path:"name",required:""},{default:s(()=>[l(o(E),{value:t.name,"onUpdate:value":e[1]||(e[1]=a=>t.name=a),placeholder:"请输入姓名"},null,8,["value"])]),_:1}),l(o(R),{label:"头像链接",path:"avatar"},{default:s(()=>[l(B,{modelValue:t.avatar,"onUpdate:modelValue":e[2]||(e[2]=a=>t.avatar=a),prefix:"member/avatar/",onImageDelete:z},null,8,["modelValue"])]),_:1}),l(o(R),{label:"卡通头像",path:"ct_avatar"},{default:s(()=>[l(B,{modelValue:t.ct_avatar,"onUpdate:modelValue":e[3]||(e[3]=a=>t.ct_avatar=a),prefix:"member/ct_avatar/",onImageDelete:j},null,8,["modelValue"])]),_:1}),l(o(R),{label:"个人简介",path:"description"},{default:s(()=>[l(o(E),{value:t.description,"onUpdate:value":e[4]||(e[4]=a=>t.description=a),placeholder:"请输入个人简介 (可选)",type:"textarea",rows:3},null,8,["value"])]),_:1}),l(o(R),{label:"个人中心",path:"link_url"},{default:s(()=>[l(o(E),{value:t.link_url,"onUpdate:value":e[5]||(e[5]=a=>t.link_url=a),placeholder:"请输入外部个人中心链接 (可选)"},null,8,["value"])]),_:1}),l(o(R),{label:"角色",path:"role"},{default:s(()=>[l(o(Q),{value:t.role,"onUpdate:value":e[6]||(e[6]=a=>t.role=a)},{default:s(()=>[l(o(I),{value:"Professor"},{default:s(()=>e[10]||(e[10]=[O("Professor")])),_:1}),l(o(I),{value:"Staff"},{default:s(()=>e[11]||(e[11]=[O("Staff")])),_:1}),l(o(I),{value:"Student"},{default:s(()=>e[12]||(e[12]=[O("Student")])),_:1})]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show"])]))}}),Ae=Ne(Me,[["__scopeId","data-v-f1c4addb"]]);export{Ae as default};
