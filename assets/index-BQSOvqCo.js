import{N as C,r as M,s as V}from"./supabaseAction-DTzG44gK.js";import{d as B,j as S,r as v,a as I,l as $,b as y,o as k,f as o,w as l,i,N as z,B as f,h as w,m as L,n as P,e as s,t as u,v as T,x as p,_ as U}from"./index-C5NNhcj1.js";import{N}from"./Space-B1Q4eXpn.js";import{N as j}from"./Popconfirm-BpPQQ0Dg.js";const E={class:"p-4"},q={key:0,class:"message-detail"},A={class:"message-info"},F={class:"info-row"},G={class:"info-row"},H={class:"info-row"},J={class:"info-row"},K={class:"content-section"},O={class:"content-box"},Q=B({__name:"index",setup(R){const m=S(),r=v(!1),c=v(!1),n=v(""),t=v(null),_=v([]),x=[{title:"ID",key:"id",width:80,ellipsis:{tooltip:!0}},{title:"姓名",key:"name",width:120,render(a){return`${a.first_name} ${a.last_name}`}},{title:"邮箱地址",key:"email_address",width:200,ellipsis:{tooltip:!0}},{title:"留言内容",key:"message",width:300,ellipsis:{tooltip:!0}},{title:"创建时间",key:"created_at",width:180,render(a){return a.created_at?new Date(a.created_at).toLocaleString():"-"}},{title:"操作",key:"actions",width:150,render(a){return p(N,null,{default:()=>[p(f,{size:"small",type:"primary",onClick:()=>D(a)},{default:()=>"查看详情"}),p(j,{onPositiveClick:()=>b(a.id)},{default:()=>"确认删除这条留言吗？",trigger:()=>p(f,{size:"small",type:"error"},{default:()=>"删除"})})]})}}],h=I(()=>n.value?_.value.filter(a=>a.first_name.includes(n.value)||a.last_name.includes(n.value)||a.email_address.includes(n.value)||a.message.includes(n.value)):_.value);async function g(){r.value=!0;try{const a=await M();_.value=a||[]}catch(a){console.error("加载留言数据失败:",a),m.error("加载数据失败")}finally{r.value=!1}}function D(a){t.value=a,c.value=!0}async function b(a){r.value=!0;try{await V(a),await g(),m.success("删除成功")}catch(e){console.error("删除留言失败:",e),m.error("删除失败")}finally{r.value=!1}}return $(()=>{g()}),(a,e)=>(k(),y("div",E,[o(i(L),{title:"留言管理",bordered:!1},{"header-extra":l(()=>[o(i(N),null,{default:l(()=>[o(i(z),{value:n.value,"onUpdate:value":e[0]||(e[0]=d=>n.value=d),placeholder:"搜索姓名、邮箱或留言内容",clearable:"",style:{width:"300px"}},null,8,["value"]),o(i(f),{onClick:g,loading:r.value},{default:l(()=>e[3]||(e[3]=[w("刷新")])),_:1},8,["loading"])]),_:1})]),default:l(()=>[o(i(C),{loading:r.value,columns:x,data:h.value,pagination:{pageSize:10},"row-key":d=>d.id},null,8,["loading","data","row-key"])]),_:1}),o(i(T),{show:c.value,"onUpdate:show":e[2]||(e[2]=d=>c.value=d),preset:"dialog",style:{width:"600px"}},{header:l(()=>e[4]||(e[4]=[w(" 留言详情 ")])),action:l(()=>[o(i(f),{onClick:e[1]||(e[1]=d=>c.value=!1)},{default:l(()=>e[10]||(e[10]=[w("关闭")])),_:1})]),default:l(()=>[t.value?(k(),y("div",q,[s("div",A,[s("div",F,[e[5]||(e[5]=s("span",{class:"label"},"ID：",-1)),s("span",null,u(t.value.id),1)]),s("div",G,[e[6]||(e[6]=s("span",{class:"label"},"姓名：",-1)),s("span",null,u(t.value.first_name)+" "+u(t.value.last_name),1)]),s("div",H,[e[7]||(e[7]=s("span",{class:"label"},"邮箱地址：",-1)),s("span",null,u(t.value.email_address),1)]),s("div",J,[e[8]||(e[8]=s("span",{class:"label"},"创建时间：",-1)),s("span",null,u(t.value.created_at?new Date(t.value.created_at).toLocaleString():"-"),1)])]),s("div",K,[e[9]||(e[9]=s("div",{class:"section-title"},"留言内容：",-1)),s("div",O,u(t.value.message),1)])])):P("",!0)]),_:1},8,["show"])]))}}),ee=U(Q,[["__scopeId","data-v-9f946103"]]);export{ee as default};
