import{_ as E}from"./CosUploader-CWsmLGcJ.js";import{z as K,A as G,B as H,C as J,N as X,a as Q}from"./supabaseAction-CtZEhjoC.js";import{d as W,j as Y,r as k,k as Z,a as ee,l as te,b as P,o as z,f as n,w as r,i as u,N as p,B as v,h as _,t as D,m as le,n as s,aT as ae,I as ne,J as ue,H as re,p as ie,q as oe,s as b,v as de,_ as se}from"./index-BX3CDTav.js";import{N as m}from"./Space-huVS_WJM.js";import{N as ce}from"./Form-DonZQ5aj.js";import{N as fe}from"./Image-C7prWbZ-.js";import"./supabase-CL7jMM04.js";function pe(){return K()}function ve(h){return H(h)}function be(h,i){return G(h,i)}function B(h){return J(h)}const he={class:"p-4"},ge=W({__name:"index",setup(h){const i=Y(),d=k(!1),g=k(!1),y=k(!1),o=k(""),f=k([]),S=[{label:"Mol",value:"Mol"},{label:"LLM",value:"LLM"},{label:"BFN",value:"BFN"},{label:"Diffusion",value:"Diffusion"}],a=Z({title:"",content:"",cover:"",tags:[],link_url:"",author:"",booktitle:"",code_url:"",bib:"",date:null}),x=k([]),T=[{title:"ID",key:"id",width:80,ellipsis:{tooltip:!0}},{title:"封面图片",key:"cover",width:120,render(e){return e?e.cover?b(fe,{src:e.cover,width:60,height:40,objectFit:"cover",style:"border-radius: 4px;"}):"暂无图片":"数据错误"}},{title:"标题",key:"title",width:200,ellipsis:{tooltip:!0},render(e){return(e==null?void 0:e.title)||"-"}},{title:"作者",key:"author",width:120,ellipsis:{tooltip:!0},render(e){return(e==null?void 0:e.author)||"-"}},{title:"内容",key:"content",width:250,ellipsis:{tooltip:!0},render(e){if(!e)return"-";const t=e.content||"";return t.length>50?t.substring(0,50)+"...":t}},{title:"标签",key:"tag",width:150,render(e){if(!e||!e.tag)return"-";const t=e.tag.split(",").filter(l=>l.trim());return b(m,{size:"small"},{default:()=>t.map(l=>b(de,{type:"info",size:"small",key:l},{default:()=>l.trim()}))})}},{title:"代码链接",key:"code_url",width:120,render(e){return!e||!e.code_url?"-":b(v,{text:!0,type:"primary",size:"small",onClick:()=>window.open(e.code_url,"_blank")},{default:()=>"查看代码"})}},{title:"文章链接",key:"link_url",width:120,render(e){return!e||!e.link_url?"-":b(v,{text:!0,type:"primary",size:"small",onClick:()=>window.open(e.link_url,"_blank")},{default:()=>"查看文章"})}},{title:"发布日期",key:"date",width:120,render(e){return(e==null?void 0:e.date)||"-"}},{title:"创建时间",key:"created_at",width:150,render(e){return e&&e.created_at?new Date(e.created_at).toLocaleDateString("zh-CN"):"-"}},{title:"操作",key:"actions",width:150,fixed:"right",render(e){return!e||!e.id?"-":b(m,null,{default:()=>[b(v,{size:"small",type:"primary",onClick:()=>$(e)},{default:()=>"编辑"}),b(v,{size:"small",type:"error",onClick:()=>O(e.id)},{default:()=>"删除"})]})}}],V=ee(()=>o.value?x.value.filter(e=>{var t,l,c,w,C,U,I,M;return e&&(((t=e.title)==null?void 0:t.includes(o.value))||((l=e.content)==null?void 0:l.includes(o.value))||((c=e.tag)==null?void 0:c.includes(o.value))||((w=e.link_url)==null?void 0:w.includes(o.value))||((C=e.author)==null?void 0:C.includes(o.value))||((U=e.booktitle)==null?void 0:U.includes(o.value))||((I=e.code_url)==null?void 0:I.includes(o.value))||((M=e.bib)==null?void 0:M.includes(o.value)))}):x.value);async function N(){d.value=!0;try{const e=await pe();x.value=(e||[]).filter(t=>t&&t.id)}catch(e){console.error("加载发布数据失败:",e),i.error("加载数据失败"),x.value=[]}finally{d.value=!1}}function L(){y.value=!1,Object.assign(a,{title:"",content:"",cover:"",tags:[],link_url:"",author:"",booktitle:"",code_url:"",bib:"",date:null}),g.value=!0}function $(e){y.value=!0;let t=null;e.date&&F(e.date)&&(t=new Date(e.date).getTime());const l=e.tag?e.tag.split(",").filter(c=>c.trim()).map(c=>c.trim()):[];Object.assign(a,{...e,tags:l,link_url:e.link_url||"",author:e.author||"",booktitle:e.booktitle||"",code_url:e.code_url||"",bib:e.bib||"",date:t}),g.value=!0}function F(e){if(!e||!/^\d{4}-\d{2}-\d{2}$/.test(e))return!1;const l=new Date(e);return l instanceof Date&&!isNaN(l.getTime())}async function j(){var e;if(!a.title||!a.content){i.error("请填写标题和内容");return}d.value=!0;try{let t="";a.date?typeof a.date=="number"?t=new Date(a.date).toISOString().split("T")[0]:typeof a.date=="string"&&(t=a.date):t=new Date().toISOString().split("T")[0];const l=((e=a.tags)==null?void 0:e.join(","))||"",c={title:a.title,content:a.content,cover:a.cover||"",tag:l,link_url:a.link_url||"",author:a.author||"",booktitle:a.booktitle||"",code_url:a.code_url||"",bib:a.bib||"",date:t};y.value&&a.id?(await be(a.id,c),i.success("更新成功")):(await ve(c),i.success("新增成功")),g.value=!1,await N()}catch(t){console.error("保存发布失败:",t),i.error("保存失败")}finally{d.value=!1}}async function O(e){d.value=!0;try{await B(e),i.success("删除成功"),await N()}catch(t){console.error("删除发布失败:",t),i.error("删除失败")}finally{d.value=!1}}async function q(){if(f.value.length===0){i.warning("请选择要删除的项目");return}d.value=!0;try{await Promise.all(f.value.map(e=>B(e))),i.success(`成功删除 ${f.value.length} 个项目`),f.value=[],await N()}catch(e){console.error("批量删除失败:",e),i.error("批量删除失败")}finally{d.value=!1}}function R(e){f.value=e.map(t=>String(t))}te(()=>{N()});const A=()=>{Q(a.id,"publications"),a.cover=""};return(e,t)=>(z(),P("div",he,[n(u(le),{title:"发布管理",bordered:!1},{"header-extra":r(()=>[n(u(m),null,{default:r(()=>[n(u(p),{value:o.value,"onUpdate:value":t[0]||(t[0]=l=>o.value=l),placeholder:"搜索标题、作者、内容、标签、链接等",clearable:"",style:{width:"300px"}},null,8,["value"]),n(u(v),{type:"error",disabled:f.value.length===0,onClick:q},{default:r(()=>[_(" 批量删除 ("+D(f.value.length)+") ",1)]),_:1},8,["disabled"]),n(u(v),{type:"primary",onClick:L},{default:r(()=>t[13]||(t[13]=[_(" 新增发布 ")])),_:1})]),_:1})]),default:r(()=>[n(u(X),{loading:d.value,columns:T,data:V.value,pagination:{pageSize:10},"row-key":l=>(l==null?void 0:l.id)||"","scroll-x":1440,"checked-row-keys":f.value,"onUpdate:checkedRowKeys":R},null,8,["loading","data","row-key","checked-row-keys"])]),_:1}),n(u(oe),{show:g.value,"onUpdate:show":t[12]||(t[12]=l=>g.value=l),preset:"dialog",style:{width:"800px"}},{header:r(()=>[_(D(y.value?"编辑发布":"新增发布"),1)]),action:r(()=>[n(u(m),null,{default:r(()=>[n(u(v),{onClick:t[11]||(t[11]=l=>g.value=!1)},{default:r(()=>t[14]||(t[14]=[_("取消")])),_:1}),n(u(v),{type:"primary",onClick:j,loading:d.value},{default:r(()=>[_(D(y.value?"更新":"创建"),1)]),_:1},8,["loading"])]),_:1})]),default:r(()=>[n(u(ce),{model:a,"label-placement":"left","label-width":"100px","require-mark-placement":"right-hanging"},{default:r(()=>[n(u(s),{label:"标题",path:"title",required:""},{default:r(()=>[n(u(p),{value:a.title,"onUpdate:value":t[1]||(t[1]=l=>a.title=l),placeholder:"请输入发布标题",maxlength:"200","show-count":""},null,8,["value"])]),_:1}),n(u(s),{label:"封面图片",path:"cover"},{default:r(()=>[n(u(m),{vertical:"",style:{width:"100%"}},{default:r(()=>[n(E,{modelValue:a.cover,"onUpdate:modelValue":t[2]||(t[2]=l=>a.cover=l),prefix:"publish/cover/",onImageDelete:A},null,8,["modelValue"])]),_:1})]),_:1}),n(u(s),{label:"内容",path:"content",required:""},{default:r(()=>[n(u(p),{value:a.content,"onUpdate:value":t[3]||(t[3]=l=>a.content=l),type:"textarea",placeholder:"请输入发布内容",rows:6,maxlength:"2000","show-count":""},null,8,["value"])]),_:1}),n(u(s),{label:"标签",path:"tags"},{default:r(()=>[n(u(ae),{value:a.tags,"onUpdate:value":t[4]||(t[4]=l=>a.tags=l)},{default:r(()=>[n(u(m),null,{default:r(()=>[(z(),P(ne,null,ue(S,l=>n(u(re),{key:l.value,value:l.value,label:l.label},null,8,["value","label"])),64))]),_:1})]),_:1},8,["value"])]),_:1}),n(u(s),{label:"书籍标题/会议名称",path:"booktitle"},{default:r(()=>[n(u(p),{value:a.booktitle,"onUpdate:value":t[5]||(t[5]=l=>a.booktitle=l),placeholder:"请输入书籍标题或会议名称",maxlength:"500","show-count":""},null,8,["value"])]),_:1}),n(u(s),{label:"代码链接",path:"code_url"},{default:r(()=>[n(u(p),{value:a.code_url,"onUpdate:value":t[6]||(t[6]=l=>a.code_url=l),placeholder:"请输入代码链接",maxlength:"500","show-count":""},null,8,["value"])]),_:1}),n(u(s),{label:"参考文献引用",path:"bib"},{default:r(()=>[n(u(p),{value:a.bib,"onUpdate:value":t[7]||(t[7]=l=>a.bib=l),type:"textarea",placeholder:"请输入参考文献引用（支持BibTeX格式）",rows:6,maxlength:"2000","show-count":""},null,8,["value"])]),_:1}),n(u(s),{label:"文章链接",path:"link_url"},{default:r(()=>[n(u(p),{value:a.link_url,"onUpdate:value":t[8]||(t[8]=l=>a.link_url=l),placeholder:"请输入文章链接",maxlength:"500","show-count":""},null,8,["value"])]),_:1}),n(u(s),{label:"作者",path:"author"},{default:r(()=>[n(u(p),{value:a.author,"onUpdate:value":t[9]||(t[9]=l=>a.author=l),placeholder:"请输入作者",maxlength:"200","show-count":""},null,8,["value"])]),_:1}),n(u(s),{label:"发布日期",path:"date"},{default:r(()=>[n(u(ie),{value:a.date,"onUpdate:value":t[10]||(t[10]=l=>a.date=l),"value-format":"yyyy-MM-dd",type:"date",placeholder:"请选择发布日期",style:{width:"100%"},clearable:""},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show"])]))}}),we=se(ge,[["__scopeId","data-v-5d4512ee"]]);export{we as default};
